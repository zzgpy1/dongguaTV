<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <!-- æ ¸å¿ƒï¼šä¸å‘é€ Referrer -->
    <meta name="referrer" content="no-referrer">
    <title>Eè§†ç•Œ - å…è´¹åœ¨çº¿è§‚çœ‹ç”µå½±ç”µè§†å‰§ | é«˜æ¸…å½±è§†èšåˆæ’­æ”¾å™¨</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Eè§†ç•Œæ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æµåª’ä½“èšåˆæ’­æ”¾å™¨ï¼Œå…è´¹åœ¨çº¿è§‚çœ‹æœ€æ–°ç”µå½±ã€ç”µè§†å‰§ã€ç»¼è‰ºã€åŠ¨æ¼«ã€‚æ”¯æŒå¤šçº¿è·¯åˆ‡æ¢ã€æ™ºèƒ½æµ‹é€Ÿã€4Ké«˜æ¸…æ’­æ”¾ã€‚">
    <meta name="keywords" content="åœ¨çº¿è§‚çœ‹,å…è´¹ç”µå½±,ç”µè§†å‰§,ç»¼è‰º,åŠ¨æ¼«,é«˜æ¸…è§†é¢‘,æµåª’ä½“,å½±è§†èšåˆ,Eè§†ç•Œ">
    <meta name="author" content="Eè§†ç•Œ">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://ednovas.video/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://ednovas.video/">
    <meta property="og:title" content="Eè§†ç•Œ - å…è´¹åœ¨çº¿è§‚çœ‹ç”µå½±ç”µè§†å‰§">
    <meta property="og:description" content="ç°ä»£åŒ–æµåª’ä½“èšåˆæ’­æ”¾å™¨ï¼Œå…è´¹è§‚çœ‹æœ€æ–°ç”µå½±ã€ç”µè§†å‰§ã€ç»¼è‰ºã€åŠ¨æ¼«ã€‚">
    <meta property="og:image" content="https://ednovas.video/icons/icon-512.png">
    <meta property="og:locale" content="zh_CN">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Eè§†ç•Œ - å…è´¹åœ¨çº¿è§‚çœ‹ç”µå½±ç”µè§†å‰§">
    <meta name="twitter:description" content="ç°ä»£åŒ–æµåª’ä½“èšåˆæ’­æ”¾å™¨ï¼Œå…è´¹è§‚çœ‹æœ€æ–°ç”µå½±ã€ç”µè§†å‰§ã€ç»¼è‰ºã€åŠ¨æ¼«ã€‚">
    <meta name="twitter:image" content="https://ednovas.video/icons/icon-512.png">

    <!-- å…¼å®¹æ€§æ£€æµ‹ (å¿…é¡»åœ¨æ‰€æœ‰è„šæœ¬ä¹‹å‰) -->
    <script>
        (function () {
            var missing = [];
            // Vue 3 æ ¸å¿ƒä¾èµ–
            if (typeof Proxy === 'undefined') missing.push('Proxy');
            // ç°ä»£ç½‘ç»œè¯·æ±‚ä¾èµ–
            if (typeof fetch === 'undefined') missing.push('fetch');
            if (typeof Promise === 'undefined') missing.push('Promise');

            if (missing.length > 0) {
                // é˜»æ­¢åç»­è„šæœ¬æ‰§è¡Œï¼Œé˜²æ­¢æ§åˆ¶å°åˆ·å±æŠ¥é”™
                if (window.stop) window.stop();

                // æ˜¾ç¤ºå…¨å±é”™è¯¯æç¤º
                document.write(
                    '<div style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:2147483647;background:#000;color:#fff;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:40px;text-align:center;font-family:sans-serif;">' +
                    '<div style="font-size:48px;margin-bottom:20px;">âš ï¸</div>' +
                    '<h2 style="color:#e50914;font-size:24px;margin-bottom:20px;">è®¾å¤‡ç³»ç»Ÿç‰ˆæœ¬è¿‡ä½</h2>' +
                    '<p style="font-size:16px;line-height:1.6;color:#ccc;">æ‚¨çš„ç”µè§†/ç›’å­ç³»ç»Ÿ WebView å†…æ ¸ç‰ˆæœ¬å¤ªæ—§ï¼Œä¸æ”¯æŒæœ¬åº”ç”¨æ‰€éœ€çš„ç°ä»£ç‰¹æ€§ã€‚<br>ç¼ºå°‘æ ¸å¿ƒç»„ä»¶: ' + missing.join(', ') + '</p>' +
                    '<p style="color:#666;margin-top:40px;font-size:14px;">å»ºè®®ï¼š<br>1. å°è¯•å‡çº§ Android System WebView<br>2. ä½¿ç”¨æ›´æ–°çš„ç”µè§†ç›’å­æˆ–æ‰‹æœºæŠ•å±</p>' +
                    '</div>'
                );
            }
        })();
    </script>


    <!-- SW ç‰ˆæœ¬æ£€æµ‹å’Œå¼ºåˆ¶æ›´æ–°ï¼ˆå¿…é¡»åœ¨æœ€å¼€å¤´ï¼‰ -->
    <script data-cfasync="false">
        (function () {
            var REQUIRED_SW_VERSION = 'v20';
            var STORAGE_KEY = 'sw_cleared_' + REQUIRED_SW_VERSION;

            // å¦‚æœå·²ç»ä¸ºè¿™ä¸ªç‰ˆæœ¬æ¸…ç†è¿‡ï¼Œä¸å†é‡å¤
            if (localStorage.getItem(STORAGE_KEY)) return;

            if ('serviceWorker' in navigator && 'caches' in window) {
                // è·å–å½“å‰ SW ç‰ˆæœ¬
                fetch('./sw.js?check=' + Date.now(), { cache: 'no-store' })
                    .then(function (res) { return res.text(); })
                    .then(function (text) {
                        var match = text.match(/CACHE_VERSION\s*=\s*['"]([^'"]+)['"]/);
                        var serverVersion = match ? match[1] : 'unknown';
                        // var serverVersion logged for debug

                        // å¦‚æœæœåŠ¡å™¨ç‰ˆæœ¬æ˜¯æœ€æ–°çš„ï¼Œæ£€æŸ¥æœ¬åœ° SW
                        if (serverVersion === REQUIRED_SW_VERSION) {
                            navigator.serviceWorker.getRegistrations().then(function (regs) {
                                if (regs.length > 0) {
                                    // å¼ºåˆ¶æ›´æ–° SW
                                    regs.forEach(function (reg) {
                                        reg.update();
                                    });
                                }
                            });

                            // æ¸…é™¤æ—§ç‰ˆæœ¬ç¼“å­˜
                            caches.keys().then(function (names) {
                                names.forEach(function (name) {
                                    if (name.indexOf(REQUIRED_SW_VERSION) === -1) {
                                        // console.log('[SW Check] Deleting old cache:', name);
                                        caches.delete(name);
                                    }
                                });
                            });

                            // æ ‡è®°å·²æ¸…ç†
                            try { localStorage.setItem(STORAGE_KEY, '1'); } catch (e) { }
                        }
                    })
                    .catch(function (e) { /* SW Check error handled silently */ });
            }
        })();
    </script>

    <!-- æ€§èƒ½ä¼˜åŒ–ï¼šDNS é¢„è§£æå’Œé¢„è¿æ¥ -->
    <link rel="dns-prefetch" href="//api.themoviedb.org">
    <link rel="dns-prefetch" href="//image.tmdb.org">
    <link rel="preconnect" href="https://api.themoviedb.org" crossorigin>
    <link rel="preconnect" href="https://image.tmdb.org" crossorigin>

    <!-- PWA Setup -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon.png" type="image/png">
    <meta name="theme-color" content="#141414">

    <!-- å…³é”® CSS (ä¼˜å…ˆåŠ è½½) -->
    <link href="libs/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="libs/css/fontawesome.min.css">

    <!-- éå…³é”® CSS (å»¶è¿ŸåŠ è½½) -->
    <link href="libs/css/animate.min.css" rel="stylesheet" media="print" onload="this.media='all'">

    <!-- å…³é”®è„šæœ¬ (ç«‹å³åŠ è½½) -->
    <script data-cfasync="false" src="libs/js/vue.global.prod.min.js"></script>

    <!-- éå…³é”®è„šæœ¬ (å»¶è¿ŸåŠ è½½) -->
    <script data-cfasync="false" src="libs/js/hls.min.js" defer></script>
    <script data-cfasync="false" src="libs/js/ad-filter.js" defer></script>
    <script data-cfasync="false" src="libs/js/DPlayer.min.js" defer></script>
    <script data-cfasync="false" src="libs/js/bootstrap.bundle.min.js" defer></script>

    <style>
        :root {
            --bg-color: #141414;
            --panel-bg: #1f1f1f;
            --accent: #e50914;
            --text-main: #ffffff;
            --text-sub: #b3b3b3;
            --border: rgba(255, 255, 255, 0.1);
        }

        [v-cloak] {
            display: none !important;
        }

        /* æ€§èƒ½ä¼˜åŒ–ï¼šå¹³æ»‘æ»šåŠ¨ */
        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            min-height: 100vh;
            padding-bottom: 60px;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            /* æ–‡å­—æ¸²æŸ“ä¼˜åŒ– */
            text-rendering: optimizeSpeed;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ğŸ“± ç§»åŠ¨ç«¯ hover æ®‹ç•™ä¿®å¤ */
        /* åœ¨è§¦æ‘¸è®¾å¤‡ä¸Šç¦ç”¨ DPlayer æ§åˆ¶æŒ‰é’®çš„ hover æ•ˆæœ */
        @media (hover: none) and (pointer: coarse) {

            .dplayer-icons .dplayer-icon:hover,
            .dplayer-icon:hover,
            .dplayer-icon.dplayer-play-icon:hover,
            .dplayer-icon.dplayer-volume-icon:hover,
            .dplayer-icon.dplayer-setting-icon:hover,
            .dplayer-icon.dplayer-full-icon:hover,
            .dplayer-icon.dplayer-full-in-icon:hover,
            .dplayer-setting-box .dplayer-setting-item:hover,
            .dplayer-menu-item:hover,
            .dplayer-bezel-icon:hover,
            .dplayer-setting-speed-item:hover {
                /* é‡ç½® hover çŠ¶æ€çš„æ ·å¼ */
                transform: none !important;
                background: inherit !important;
                box-shadow: none !important;
            }

            .dplayer-icon:hover svg,
            .dplayer-icons .dplayer-icon:hover svg {
                transform: none !important;
                filter: none !important;
            }

            .dplayer-icon:hover svg path,
            .dplayer-icons .dplayer-icon:hover svg path {
                fill: rgba(255, 255, 255, 0.9) !important;
            }
        }

        /* ğŸ“º TV é¥æ§å™¨ç„¦ç‚¹å¯¼èˆªæ ·å¼ */
        /* è®©æ‰€æœ‰å¯äº¤äº’å…ƒç´ åœ¨è·å¾—ç„¦ç‚¹æ—¶æ˜¾ç¤ºé«˜äº®è¾¹æ¡† */
        .close-btn:focus,
        .btn-cast:focus,
        .source-pill:focus,
        .ep-item:focus,
        .card:focus,
        .info-modal-close:focus,
        button:focus,
        a:focus,
        [tabindex]:focus {
            outline: 3px solid #e50914 !important;
            outline-offset: 2px !important;
            box-shadow: 0 0 0 6px rgba(229, 9, 20, 0.3) !important;
        }

        /* æ’­æ”¾å™¨æ§åˆ¶æŒ‰é’®ç„¦ç‚¹æ ·å¼ */
        .dplayer-icon:focus {
            outline: 2px solid #fff !important;
            outline-offset: 2px !important;
            background: rgba(255, 255, 255, 0.2) !important;
            border-radius: 4px !important;
        }

        /* ç¡®ä¿æ‰€æœ‰å¯ç‚¹å‡»å…ƒç´ å¯ä»¥è·å¾—ç„¦ç‚¹ */
        .source-pill,
        .ep-item,
        .close-btn,
        .btn-cast,
        .card {
            cursor: pointer;
        }

        /* ğŸ“º TV æ¨¡å¼ä¸“ç”¨æ ·å¼ - è®©æ§åˆ¶æŒ‰é’®å¯ä»¥è·å¾—ç„¦ç‚¹ */
        .dplayer-icon {
            outline: none;
        }

        .dplayer-icon:focus {
            outline: 3px solid #e50914 !important;
            outline-offset: 2px !important;
            background: rgba(229, 9, 20, 0.3) !important;
            border-radius: 4px !important;
        }

        /* ğŸ“º TV æ¨¡å¼è‡ªå®šä¹‰æŒ‰é’®æ ·å¼ */
        #tv-switch-source:hover,
        #tv-select-episode:hover,
        #tv-switch-source:focus,
        #tv-select-episode:focus {
            background: rgba(229, 9, 20, 0.5) !important;
        }


        /* ğŸ“± å…¨å±æ’­æ”¾æ¨¡å¼ï¼šç§»é™¤çŠ¶æ€æ  paddingï¼Œè®©è§†é¢‘å æ»¡å…¨å± */
        body.dplayer-fullscreen-active {
            padding-top: 0 !important;
        }

        /* ğŸ“± DPlayer å…¨å±å®¹å™¨æ ·å¼ä¼˜åŒ– */
        .dplayer-fulled,
        .dplayer-web-fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 2147483647 !important;
            background: #000 !important;
        }

        /* ğŸ“± ä¿®å¤å…¨å±æ¨¡å¼ä¸‹è¿›åº¦æ¡ä¸æ˜¾ç¤ºçš„é—®é¢˜ */
        /* è¦†ç›–å¯èƒ½å­˜åœ¨çš„éšè—è§„åˆ™ï¼Œç¡®ä¿è¿›åº¦æ¡åœ¨å…¨å±æ—¶å¯è§ */
        .dplayer-fulled .dplayer-bar-wrap,
        .dplayer-full .dplayer-bar-wrap,
        .dplayer-web-fullscreen .dplayer-bar-wrap {
            opacity: 1 !important;
            visibility: visible !important;
            pointer-events: auto !important;
        }

        .dplayer-fulled .dplayer-bar,
        .dplayer-full .dplayer-bar,
        .dplayer-web-fullscreen .dplayer-bar {
            opacity: 1 !important;
            visibility: visible !important;
            pointer-events: auto !important;
        }

        .dplayer-fulled .dplayer-thumb,
        .dplayer-full .dplayer-thumb,
        .dplayer-web-fullscreen .dplayer-thumb {
            opacity: 1 !important;
            visibility: visible !important;
            pointer-events: auto !important;
        }

        .dplayer-fulled .dplayer-bar-time,
        .dplayer-full .dplayer-bar-time,
        .dplayer-web-fullscreen .dplayer-bar-time {
            opacity: 1 !important;
            visibility: visible !important;
        }

        /* å…¨å±æ—¶éšè—å¯¼èˆªæ  */
        body.dplayer-fullscreen-active .navbar-custom {
            display: none !important;
        }

        /* æ€§èƒ½ä¼˜åŒ–ï¼šå›¾ç‰‡é»˜è®¤ä¼˜åŒ– */
        img {
            content-visibility: auto;
            /* å›¾ç‰‡å ä½èƒŒæ™¯ */
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
        }

        /* æ€§èƒ½ä¼˜åŒ–ï¼šæ‡’åŠ è½½åŒºåŸŸ */
        .section-container {
            content-visibility: auto;
            contain-intrinsic-size: auto 350px;
        }

        /* ä¿®å¤ Firefox æ»šåŠ¨æ—¶çš„é»‘è‰²æ–¹å— */
        * {
            scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
            scrollbar-width: thin;
            /* ç¦ç”¨ç‚¹å‡»é«˜äº®èƒŒæ™¯ */
            -webkit-tap-highlight-color: transparent;
        }

        /* ========== ğŸ¬ DPlayer é«˜çº§ç¾åŒ–æ ·å¼ ========== */

        /* å±è”½ DPlayer é»˜è®¤æç¤º */
        .dplayer-notice,
        .dplayer-notice-list {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }

        /* æ’­æ”¾å™¨å®¹å™¨åœ†è§’ */
        #dplayer {
            border-radius: 12px;
            overflow: hidden;
        }

        /* 1. æ¯›ç»ç’ƒæ§åˆ¶æ æ•ˆæœ */
        .dplayer-controller {
            background: linear-gradient(to top, rgba(0, 0, 0, 0.85) 0%, rgba(0, 0, 0, 0.4) 60%, transparent 100%) !important;
            backdrop-filter: blur(10px) saturate(150%) !important;
            -webkit-backdrop-filter: blur(10px) saturate(150%) !important;
        }

        /* 2. è¿›åº¦æ¡ç¾åŒ– - æ¸å˜æ•ˆæœ */
        .dplayer-bar-wrap .dplayer-played {
            background: linear-gradient(90deg, #e50914, #ff4757, #ff6b81) !important;
        }

        /* è¿›åº¦æ¡é«˜åº¦ */
        .dplayer-bar-wrap {
            height: 4px !important;
            transition: none !important;
        }

        /* 3. è¿›åº¦æ¡æ‹–åŠ¨ç‚¹ - å‘å…‰æ•ˆæœ */
        .dplayer-bar-wrap .dplayer-thumb {
            background: #fff !important;
            box-shadow: 0 0 12px rgba(229, 9, 20, 0.9), 0 0 25px rgba(229, 9, 20, 0.5) !important;
            transform: scale(1.3) !important;
            border: 2px solid rgba(255, 255, 255, 0.9) !important;
        }

        /* 4. æ§åˆ¶æŒ‰é’®ç¾åŒ– */
        .dplayer-icons .dplayer-icon {
            transition: all 0.2s ease !important;
        }

        .dplayer-icons .dplayer-icon:hover {
            transform: scale(1.15) !important;
            background: rgba(255, 255, 255, 0.1) !important;
            border-radius: 6px !important;
        }

        /* 5. å¤§æ’­æ”¾æŒ‰é’®ç¾åŒ– */
        .dplayer-bezel-icon {
            background: rgba(229, 9, 20, 0.9) !important;
            border-radius: 50% !important;
            box-shadow: 0 0 40px rgba(229, 9, 20, 0.6) !important;
        }

        /* 6. éŸ³é‡æ¡ç¾åŒ– */
        .dplayer-volume-bar-wrap .dplayer-volume-bar .dplayer-volume-bar-inner {
            background: linear-gradient(90deg, #e50914, #ff6b81) !important;
        }

        /* 7. è®¾ç½®é¢æ¿æ¯›ç»ç’ƒæ•ˆæœ */
        .dplayer-setting-box {
            background: rgba(20, 20, 20, 0.95) !important;
            backdrop-filter: blur(20px) !important;
            -webkit-backdrop-filter: blur(20px) !important;
            border-radius: 12px !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6) !important;
            overflow: hidden !important;
        }

        .dplayer-setting-box .dplayer-setting-item {
            transition: background 0.2s ease !important;
        }

        .dplayer-setting-box .dplayer-setting-item:hover {
            background: rgba(229, 9, 20, 0.3) !important;
        }

        /* 8. åŠ è½½åŠ¨ç”»ç¾åŒ– */
        .dplayer-loading-icon {
            filter: drop-shadow(0 0 15px rgba(229, 9, 20, 0.6));
        }

        .dplayer-loading-icon svg path {
            fill: #e50914 !important;
        }

        /* 9. é¡¶éƒ¨ä¿¡æ¯æ æ¸å˜ */
        .dplayer-info-panel {
            background: rgba(20, 20, 20, 0.95) !important;
            backdrop-filter: blur(15px) !important;
            border-radius: 10px !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        /* 10. å³é”®èœå•ç¾åŒ– */
        .dplayer-menu {
            background: rgba(20, 20, 20, 0.95) !important;
            backdrop-filter: blur(20px) !important;
            border-radius: 10px !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5) !important;
            overflow: hidden !important;
        }

        .dplayer-menu-item:hover {
            background: rgba(229, 9, 20, 0.4) !important;
        }

        /* éšè—å…³äºä½œè€…åŠç‰ˆæœ¬å· (é€šå¸¸æ˜¯æœ€åä¸¤é¡¹) */
        .dplayer-menu .dplayer-menu-item:nth-last-child(-n+2) {
            display: none !important;
        }

        /* 11. æ—¶é—´æ˜¾ç¤ºç¾åŒ– */
        .dplayer-ptime,
        .dplayer-dtime {
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5) !important;
        }

        /* 12. åŒå‡»å¿«è¿›/å¿«é€€åŒºåŸŸæ ·å¼ */
        .dplayer-seek-hint {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            color: #fff;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
            z-index: 100;
        }

        .dplayer-seek-hint.show {
            opacity: 1;
            animation: seekPulse 0.4s ease;
        }

        .dplayer-seek-hint.left {
            left: 15%;
        }

        .dplayer-seek-hint.right {
            right: 15%;
        }

        .dplayer-seek-hint i {
            font-size: 28px;
        }

        @keyframes seekPulse {
            0% {
                transform: translateY(-50%) scale(0.8);
                opacity: 0;
            }

            50% {
                transform: translateY(-50%) scale(1.1);
                opacity: 1;
            }

            100% {
                transform: translateY(-50%) scale(1);
                opacity: 1;
            }
        }

        /* 13. å€é€ŸæŒ‡ç¤ºå™¨ */
        .dplayer-speed-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(229, 9, 20, 0.9);
            color: #fff;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 50;
        }

        .dplayer-speed-indicator.show {
            opacity: 1;
        }

        /* é•¿æŒ‰å¿«è¿›è„‰å†²åŠ¨ç”» */
        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                opacity: 0.8;
                transform: translate(-50%, -50%) scale(1.05);
            }
        }

        /* 14. å…¨å±æ—¶çš„æ ·å¼è°ƒæ•´ */
        .dplayer-fulled #dplayer,
        .dplayer-full #dplayer {
            border-radius: 0 !important;
        }

        /* ========== ğŸ¨ DPlayer å›¾æ ‡ç°ä»£åŒ–ç¾åŒ– ========== */

        /* 15. æ‰€æœ‰ SVG å›¾æ ‡åŸºç¡€æ ·å¼ */
        .dplayer-icon svg {
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .dplayer-icon svg path {
            fill: rgba(255, 255, 255, 0.9) !important;
            transition: fill 0.2s ease !important;
        }

        .dplayer-icon:hover svg path {
            fill: #ff6b81 !important;
        }

        /* 16. æ’­æ”¾/æš‚åœæŒ‰é’®ç‰¹æ®Šé«˜äº®ä¸åŠ¨æ•ˆ */
        .dplayer-icon.dplayer-play-icon {
            background: linear-gradient(135deg, rgba(229, 9, 20, 0.4), rgba(255, 107, 129, 0.2)) !important;
            border-radius: 50% !important;
            padding: 8px !important;
            margin: 0 5px !important;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
        }

        .dplayer-icon.dplayer-play-icon:hover {
            background: linear-gradient(135deg, rgba(229, 9, 20, 0.8), rgba(255, 107, 129, 0.6)) !important;
            box-shadow: 0 0 20px rgba(229, 9, 20, 0.6) !important;
            transform: scale(1.15) !important;
        }

        .dplayer-icon.dplayer-play-icon svg {
            width: 22px !important;
            height: 22px !important;
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.2));
        }

        /* 30. æ‰‹æœºç«¯ä¸­å¤®äº¤äº’æŒ‰é’® (è‡ªå®šä¹‰è¦†ç›–å±‚) - ä¸ç”µè„‘ç«¯ç»Ÿä¸€æ ·å¼ */
        .mobile-play-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 75px;
            height: 75px;
            background: linear-gradient(135deg, rgba(229, 9, 20, 0.9), rgba(180, 0, 15, 0.85));
            backdrop-filter: blur(12px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow:
                0 0 40px rgba(229, 9, 20, 0.5),
                0 0 80px rgba(229, 9, 20, 0.25),
                inset 0 2px 12px rgba(255, 255, 255, 0.2),
                0 8px 30px rgba(0, 0, 0, 0.4);
        }

        .mobile-play-overlay.show {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
            animation: mobileOverlayAppear 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* å½“æ§åˆ¶æ éšè—æ—¶ï¼Œè¿™ä¸ªæŒ‰é’®ä¹Ÿå¼ºåˆ¶éšè— */
        .dplayer-hide-controller .mobile-play-overlay {
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }

        .mobile-play-overlay i {
            color: #fff;
            font-size: 30px;
            filter: drop-shadow(0 3px 5px rgba(0, 0, 0, 0.4));
            margin-left: 5px;
            /* æ’­æ”¾å›¾æ ‡è§†è§‰ä¿®æ­£ */
        }

        .mobile-play-overlay.pause-state i {
            margin-left: 0;
        }

        .mobile-play-overlay:active {
            transform: translate(-50%, -50%) scale(0.92);
        }

        /* è„‰å†²å…‰ç¯æ•ˆæœ */
        .mobile-play-overlay::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(229, 9, 20, 0.5);
            animation: mobilePulse 1.8s ease-out infinite;
            pointer-events: none;
        }

        @keyframes mobileOverlayAppear {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }

            60% {
                transform: translate(-50%, -50%) scale(1.08);
            }

            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes mobilePulse {
            0% {
                transform: scale(1);
                opacity: 0.7;
            }

            100% {
                transform: scale(1.5);
                opacity: 0;
            }
        }

        /* 31. ç”µè„‘ç«¯ä¸­å¤®æ’­æ”¾/æš‚åœæŒ‰é’® (è‡ªå®šä¹‰è¦†ç›–å±‚) */
        .desktop-play-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, rgba(229, 9, 20, 0.9), rgba(180, 0, 15, 0.85));
            backdrop-filter: blur(12px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            pointer-events: none;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow:
                0 0 50px rgba(229, 9, 20, 0.5),
                0 0 100px rgba(229, 9, 20, 0.3),
                inset 0 2px 15px rgba(255, 255, 255, 0.2),
                0 10px 40px rgba(0, 0, 0, 0.4);
            cursor: pointer;
        }

        .desktop-play-overlay.show {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
            animation: desktopOverlayAppear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .desktop-play-overlay:hover {
            transform: translate(-50%, -50%) scale(1.1);
            box-shadow:
                0 0 70px rgba(229, 9, 20, 0.7),
                0 0 140px rgba(229, 9, 20, 0.4),
                inset 0 2px 20px rgba(255, 255, 255, 0.3);
        }

        .desktop-play-overlay:active {
            transform: translate(-50%, -50%) scale(0.95);
        }

        .desktop-play-overlay i {
            color: #fff;
            font-size: 36px;
            filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.4));
            margin-left: 6px;
            /* æ’­æ”¾å›¾æ ‡è§†è§‰ä¿®æ­£ */
        }

        .desktop-play-overlay.pause-state i {
            margin-left: 0;
        }

        /* è„‰å†²å…‰ç¯æ•ˆæœ */
        .desktop-play-overlay::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(229, 9, 20, 0.6);
            animation: desktopPulse 2s ease-out infinite;
            pointer-events: none;
        }

        @keyframes desktopOverlayAppear {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }

            60% {
                transform: translate(-50%, -50%) scale(1.1);
            }

            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes desktopPulse {
            0% {
                transform: scale(1);
                opacity: 0.8;
            }

            100% {
                transform: scale(1.6);
                opacity: 0;
            }
        }

        /* ä»…åœ¨ç”µè„‘ç«¯æ˜¾ç¤º */
        @media (max-width: 768px) {
            .desktop-play-overlay {
                display: none !important;
            }
        }

        /* 17. éŸ³é‡æŒ‰é’®ç¾åŒ– */
        .dplayer-icon.dplayer-volume-icon {
            padding: 6px !important;
            border-radius: 8px !important;
        }

        .dplayer-icon.dplayer-volume-icon:hover {
            background: rgba(255, 255, 255, 0.15) !important;
        }

        /* 18. è®¾ç½®æŒ‰é’®é½¿è½®æ—‹è½¬åŠ¨ç”» */
        .dplayer-icon.dplayer-setting-icon svg {
            transition: transform 0.4s ease !important;
        }

        .dplayer-icon.dplayer-setting-icon:hover svg {
            transform: rotate(60deg) !important;
        }

        /* 19. å…¨å±æŒ‰é’®æ”¾å¤§åŠ¨ç”» */
        .dplayer-icon.dplayer-full-icon,
        .dplayer-icon.dplayer-full-in-icon {
            padding: 6px !important;
            border-radius: 8px !important;
        }

        .dplayer-icon.dplayer-full-icon:hover,
        .dplayer-icon.dplayer-full-in-icon:hover {
            background: rgba(255, 255, 255, 0.15) !important;
        }

        /* 20. å›¾æ ‡é¢œè‰²æ¸å˜æ•ˆæœ */
        .dplayer-icons .dplayer-icon:hover svg path {
            fill: #ff6b81 !important;
            transition: fill 0.2s ease;
        }

        /* 21. æ§åˆ¶æ¡æŒ‰é’®é—´è·ä¼˜åŒ– */
        .dplayer-icons.dplayer-icons-right .dplayer-icon {
            margin: 0 3px !important;
        }

        /* 22. ä¸­å¤®å¤§æ’­æ”¾æŒ‰é’® */
        .dplayer-bezel-icon {
            width: 70px !important;
            height: 70px !important;
            background: linear-gradient(135deg, rgba(229, 9, 20, 0.95), rgba(180, 0, 15, 0.9)) !important;
            border-radius: 50% !important;
            box-shadow:
                0 0 40px rgba(229, 9, 20, 0.6),
                0 0 80px rgba(229, 9, 20, 0.3),
                inset 0 2px 10px rgba(255, 255, 255, 0.2) !important;
            border: 2px solid rgba(255, 255, 255, 0.2) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            transition: all 0.3s ease !important;
        }

        .dplayer-bezel-icon:hover {
            transform: scale(1.1) !important;
            box-shadow:
                0 0 60px rgba(229, 9, 20, 0.8),
                0 0 100px rgba(229, 9, 20, 0.4) !important;
        }

        .dplayer-bezel-icon svg {
            width: 32px !important;
            height: 32px !important;
        }

        .dplayer-bezel-icon svg path {
            fill: #fff !important;
        }

        /* 23. å€é€Ÿé€‰æ‹©å™¨æ ·å¼ */
        .dplayer-setting-speed-item {
            transition: all 0.2s ease !important;
            border-radius: 6px !important;
            margin: 2px 5px !important;
        }

        .dplayer-setting-speed-item:hover {
            background: rgba(229, 9, 20, 0.4) !important;
            transform: translateX(5px) !important;
        }

        .dplayer-setting-speed-item.dplayer-setting-speed-current {
            background: linear-gradient(90deg, rgba(229, 9, 20, 0.6), transparent) !important;
            color: #ff6b81 !important;
            font-weight: bold !important;
            border-left: 3px solid #e50914 !important;
        }

        /* 24. åŠ è½½åŠ¨ç”»è‡ªå®šä¹‰ */
        .dplayer-loading-icon svg {
            width: 60px !important;
            height: 60px !important;
        }

        .dplayer-loading-icon svg circle {
            stroke: #e50914 !important;
            stroke-width: 3 !important;
        }

        /* 25. è¿›åº¦æ¡æ—¶é—´é¢„è§ˆ */
        .dplayer-bar-time {
            background: rgba(20, 20, 20, 0.95) !important;
            backdrop-filter: blur(10px) !important;
            border-radius: 8px !important;
            padding: 6px 12px !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5) !important;
            font-weight: 600 !important;
            color: #fff !important;
        }

        /* 26. è®¾ç½®é¢æ¿æ ·å¼ä¿®å¤ - ä»…ä¿®å¤ç‚¹å‡»é—®é¢˜ï¼Œä¸æ”¹å˜å¸ƒå±€ */
        /* è®¾ç½®èœå•å±‚çº§ - ç¡®ä¿åœ¨é®ç½©å±‚ä¹‹ä¸Š */
        .dplayer-setting-box {
            z-index: 30000 !important;
        }

        /* è®¾ç½®èœå•å†…éƒ¨å…ƒç´ å¯ç‚¹å‡» */
        .dplayer-setting-box * {
            pointer-events: auto !important;
        }

        /* âœ… ä¿®å¤åï¼šä»…åœ¨æ§åˆ¶å™¨è¢«è‡ªåŠ¨éšè—æ—¶æ‰éšè—ï¼ˆç§»é™¤äº† .dplayer-fulled å’Œ .dplayer-fullï¼‰ */
        .dplayer-hide-controller .dplayer-controller {
            opacity: 0 !important;
            visibility: hidden !important;
            transform: translateY(100%) !important;
            bottom: -50px !important;
            transition: all 0.3s ease !important;
            pointer-events: none !important;
        }

        /* âœ… ä¿®å¤åï¼šä»…åœ¨æ§åˆ¶å™¨è¢«è‡ªåŠ¨éšè—æ—¶æ‰éšè—è¿›åº¦æ¡ */
        .dplayer-hide-controller .dplayer-bar-wrap,
        .dplayer-hide-controller .dplayer-bar-time,
        .dplayer-hide-controller .dplayer-thumb {
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }

        /* å•å‡»è§¦å‘æ˜¾ç¤ºæ§åˆ¶æ  */
        .dplayer-controller.dplayer-controller-show {
            opacity: 1 !important;
            visibility: visible !important;
            transform: translateY(0) !important;
            bottom: 0 !important;
            pointer-events: auto !important;
        }

        .dplayer-controller-show .dplayer-bar-wrap {
            opacity: 1 !important;
            visibility: visible !important;
        }

        /* DPlayer ç”µè„‘ç«¯ä¸­å¤®æ’­æ”¾/æš‚åœæŒ‰é’® - ç°ä»£åŒ–åŠ¨æ•ˆ */
        @media (min-width: 769px) {
            .dplayer-bezel-icon {
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                width: 80px !important;
                height: 80px !important;
                background: linear-gradient(135deg, rgba(229, 9, 20, 0.9), rgba(180, 0, 15, 0.85)) !important;
                backdrop-filter: blur(10px) !important;
                border-radius: 50% !important;
                border: 3px solid rgba(255, 255, 255, 0.25) !important;
                box-shadow:
                    0 0 40px rgba(229, 9, 20, 0.6),
                    0 0 80px rgba(229, 9, 20, 0.3),
                    inset 0 2px 15px rgba(255, 255, 255, 0.2),
                    0 8px 32px rgba(0, 0, 0, 0.4) !important;
                animation: bezelAppear 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
                cursor: pointer !important;
                transition: all 0.3s ease !important;
            }

            .dplayer-bezel-icon:hover {
                transform: scale(1.1) !important;
                box-shadow:
                    0 0 60px rgba(229, 9, 20, 0.8),
                    0 0 120px rgba(229, 9, 20, 0.4),
                    inset 0 2px 20px rgba(255, 255, 255, 0.3) !important;
            }

            .dplayer-bezel-icon:active {
                transform: scale(0.95) !important;
            }

            .dplayer-bezel-icon svg {
                width: 36px !important;
                height: 36px !important;
                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3)) !important;
            }

            .dplayer-bezel-icon svg path {
                fill: #fff !important;
            }

            /* å‡ºç°åŠ¨ç”» */
            @keyframes bezelAppear {
                0% {
                    opacity: 0;
                    transform: scale(0.5);
                }

                50% {
                    opacity: 1;
                    transform: scale(1.1);
                }

                100% {
                    opacity: 1;
                    transform: scale(1);
                }
            }

            /* è„‰å†²å‘å…‰æ•ˆæœ */
            .dplayer-bezel-icon::before {
                content: '';
                position: absolute;
                width: 100%;
                height: 100%;
                border-radius: 50%;
                background: transparent;
                border: 2px solid rgba(229, 9, 20, 0.5);
                animation: bezelPulse 1.5s ease-out infinite;
                pointer-events: none;
            }

            @keyframes bezelPulse {
                0% {
                    transform: scale(1);
                    opacity: 0.8;
                }

                100% {
                    transform: scale(1.5);
                    opacity: 0;
                }
            }
        }

        /* éšè—çŠ¶æ€ */
        .dplayer-bezel-icon.dplayer-bezel-icon-hide {
            display: none !important;
            animation: none !important;
        }

        /* 27. éšè—é»˜è®¤å›¾æ ‡ï¼Œä½¿ç”¨è‡ªå®šä¹‰è¦†ç›–å±‚ */
        /* éšè— DPlayer é»˜è®¤çš„ç§»åŠ¨ç«¯æ’­æ”¾æŒ‰é’® */
        .dplayer-mobile-play {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }

        /* å®Œå…¨éšè—åŸç”Ÿ Bezel å›¾æ ‡ (æ‰€æœ‰å°ºå¯¸)ï¼Œä½¿ç”¨è‡ªå®šä¹‰è¦†ç›–å±‚ */
        .dplayer-bezel-icon {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
            pointer-events: none !important;
        }

        @media (max-width: 768px) {
            .dplayer-icon {
                padding: 10px !important;
                min-width: 44px !important;
                min-height: 44px !important;
            }
        }

        /* å…¨å±€æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #141414;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* å¯¼èˆª */
        .navbar-custom {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            padding: 15px 4%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.9) 0%, transparent 100%);
            transition: 0.3s;
        }

        .navbar-custom.scrolled {
            background: #141414;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
        }

        .brand {
            font-size: 26px;
            font-weight: 800;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
        }

        /* Hero */
        .carousel-item {
            height: 70vh;
            background-color: #000;
        }

        .hero-bg {
            position: absolute;
            inset: 0;
            background-size: cover;
            background-position: center top;
            /* æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ GPU åŠ é€Ÿçš„ transform */
            transition: transform 10s cubic-bezier(0.25, 0.1, 0.25, 1);
            transform: translateZ(0);
            will-change: transform;
            mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
        }

        .carousel-item.active .hero-bg {
            transform: scale(1.05) translateZ(0);
        }

        .hero-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, #141414 0%, transparent 60%), linear-gradient(to right, rgba(0, 0, 0, 0.8) 0%, transparent 50%);
            display: flex;
            align-items: center;
            padding-left: 5%;
        }

        .hero-content {
            max-width: 600px;
            margin-top: 60px;
            animation: fadeInUp 0.8s;
        }

        .hero-tag {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            display: inline-block;
            margin-bottom: 15px;
            backdrop-filter: blur(5px);
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 900;
            line-height: 1.1;
            margin-bottom: 15px;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
        }

        .hero-desc {
            font-size: 1.1rem;
            color: #ddd;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            margin-bottom: 25px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .btn-play {
            background: #fff;
            color: #000;
            border: none;
            padding: 10px 30px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-play:hover {
            transform: scale(1.05);
        }

        .btn-info {
            background: rgba(109, 109, 110, 0.7);
            color: #fff;
            border: none;
            padding: 10px 30px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: 0.2s;
            backdrop-filter: blur(5px);
        }

        .btn-info:hover {
            background: rgba(109, 109, 110, 0.5);
        }

        @media(max-width: 768px) {
            .carousel-item {
                height: 55vh;
            }

            .hero-title {
                font-size: 2.2rem;
            }

            .btn-play,
            .btn-info {
                padding: 8px 20px;
                font-size: 1rem;
            }
        }

        /* æœç´¢æ¡† */
        .search-section {
            position: sticky;
            top: 10px;
            /* å¸é¡¶æ—¶ä½äº Navbar å†…éƒ¨ */
            margin-top: -35px;
            z-index: 1001;
            /* é«˜äº Navbar */
            padding: 0 4%;
            /* å¯¹é½ Navbar Padding */
            margin-bottom: 30px;
            pointer-events: none;
        }

        .search-box-wrapper {
            pointer-events: auto;
            background: rgba(20, 20, 20, 0.95);
            /* åŠ æ·±èƒŒæ™¯ï¼Œé˜²æ­¢é€è§†å¹²æ‰° */
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 50px;
            /* æ›´åœ†æ¶¦ */
            display: flex;
            align-items: center;
            transition: 0.3s;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 100%;
            /* æ’‘æ»¡ */
            max-width: none;
            margin: 0 auto;
        }

        .search-box-wrapper.compact {
            max-width: 280px;
            height: 40px;
            margin-right: 0;
            /* å³å¯¹é½ */
            margin-left: auto;
            background: rgba(40, 40, 40, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .search-box-wrapper.compact .search-input {
            height: 40px;
            font-size: 14px;
        }

        .search-box-wrapper.compact .search-icon {
            font-size: 14px;
            padding: 0 12px;
        }

        .btn-top {
            position: fixed;
            bottom: 40px;
            right: 40px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #e50914, #b20710);
            color: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            cursor: pointer;
            z-index: 1000;
            border: none;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
        }

        .btn-top.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .btn-top:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 0 15px 30px rgba(229, 9, 20, 0.5);
        }



        .search-box-wrapper:focus-within {
            border-color: var(--accent);
            background: #000;
        }

        .search-icon {
            padding: 0 20px;
            color: #888;
            font-size: 18px;
            cursor: pointer;
        }

        .search-input {
            width: 100%;
            height: 60px;
            background: transparent;
            border: none;
            color: #fff;
            font-size: 18px;
            outline: none;
        }

        /* åˆ†ç±»å¯¼èˆªæ  */
        .category-nav-container {
            display: flex;
            overflow-x: auto;
            padding: 20px 4%;
            gap: 20px;
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE/Edge */
        }

        .category-nav-container::-webkit-scrollbar {
            display: none;
            /* Chrome/Safari */
        }

        .category-item {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            width: 70px;
            transition: transform 0.2s;
        }

        .category-item:hover {
            transform: translateY(-5px);
        }

        .category-item span {
            font-size: 12px;
            color: #aaa;
            font-weight: 500;
        }

        .category-item:hover span {
            color: #fff;
        }

        .cat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* åˆ—è¡¨é€šç”¨ */
        .section-container {
            padding: 0 5%;
            margin-bottom: 40px;
            min-height: 100px;
            /* ä½¿ç”¨ isolation åˆ›å»ºç‹¬ç«‹çš„å±‚å ä¸Šä¸‹æ–‡ */
            isolation: isolate;
        }

        /* åˆ†ç±»æ ‡é¢˜ä¸æ’åºåˆ‡æ¢ */
        .section-title i.sort-toggle-icon {
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin-right: 12px;
            color: var(--accent);
            display: inline-block;
        }

        .section-title i.sort-toggle-icon:active {
            transform: scale(0.85);
        }

        .section-title i.sort-toggle-icon.popular {
            color: #ffaa00;
            /* çƒ­é—¨ä½¿ç”¨é‡‘è‰²/æ©™è‰²æç¤º */
            text-shadow: 0 0 10px rgba(255, 170, 0, 0.3);
        }

        .sort-indicator {
            font-size: 10px;
            font-weight: 900;
            padding: 1px 4px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.4);
            margin-left: 8px;
            vertical-align: middle;
            letter-spacing: 0.5px;
            pointer-events: none;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
            padding: 0 10px;
            /* ç¡®ä¿å±•å¼€æŒ‰é’®ä¸è¢«ä¸Šæ–¹åŒºåŸŸçš„å¡ç‰‡é®ç›– */
            position: relative;
            z-index: 20;
        }

        .section-line {
            width: 4px;
            height: 22px;
            background: var(--accent);
            border-radius: 2px;
            margin-right: 12px;
        }

        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #fff;
            margin: 0;
            line-height: 1;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            font-size: 1.1rem;
            opacity: 0.7;
        }

        /* æ»šåŠ¨å®¹å™¨ */
        .scroll-container {
            position: relative;
            z-index: 0;
            /* é™åˆ¶å†…éƒ¨å…ƒç´ çš„å±‚å èŒƒå›´ */
            overflow: visible;
            /* å…è®¸å¡ç‰‡ hover æ•ˆæœ */
        }

        .hot-row {
            display: flex;
            gap: 14px;
            overflow-x: auto;
            padding-bottom: 20px;
            scroll-behavior: smooth;
            /* æ·»åŠ æ»šåŠ¨æ•æ‰ï¼Œè®©æ»šåŠ¨æ›´è‡ªç„¶ */
            scroll-snap-type: x proximity;
            -webkit-overflow-scrolling: touch;
            /* Firefox Mobile é—ªçƒä¿®å¤ */
            will-change: scroll-position;
            /* å‘ŠçŸ¥æµè§ˆå™¨æ­¤å…ƒç´ æ»šåŠ¨ä½ç½®ä¼šå˜åŒ– */
            transform: translateZ(0);
            /* å¼ºåˆ¶ GPU å±‚ */
            background-color: transparent;
            /* é¿å…èƒŒæ™¯é‡ç»˜ */
        }

        .hot-row>.hot-card,
        .hot-row>.history-card {
            scroll-snap-align: start;
        }

        .hot-row::-webkit-scrollbar {
            height: 0px;
        }

        /* æ»šåŠ¨æŒ‰é’® */
        .scroll-btn {
            position: absolute;
            top: 35%;
            transform: translateY(-50%);
            width: 36px;
            height: 80px;
            background: linear-gradient(135deg, rgba(30, 30, 30, 0.95) 0%, rgba(50, 50, 50, 0.9) 100%);
            border: none;
            border-radius: 8px;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s ease;
            opacity: 0.6;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .scroll-btn:hover {
            background: linear-gradient(135deg, rgba(229, 9, 20, 0.9) 0%, rgba(180, 0, 15, 0.85) 100%);
            opacity: 1;
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 6px 20px rgba(229, 9, 20, 0.4);
        }

        .scroll-btn.left {
            left: -5px;
            border-radius: 0 8px 8px 0;
        }

        .scroll-btn.right {
            right: -5px;
            border-radius: 8px 0 0 8px;
        }

        @media (max-width: 768px) {
            .scroll-btn {
                display: none;
                /* ç§»åŠ¨ç«¯éšè—ï¼Œä½¿ç”¨æ‰‹æŒ‡æ»‘åŠ¨ */
            }
        }

        .hot-card {
            min-width: 150px;
            width: 150px;
            cursor: pointer;
            position: relative;
            /* æ€§èƒ½ä¼˜åŒ–ï¼šåªåœ¨ hover æ—¶æ·»åŠ  transform */
            transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            /* å¸ƒå±€ä¼˜åŒ– */
            contain: layout style;
        }

        .hot-card:hover {
            transform: scale(1.08) translateZ(0);
            z-index: 10;
            /* ä¼˜åŒ–ï¼šä»…åœ¨ hover æ—¶å¯ç”¨ will-change */
            will-change: transform;
        }

        /* å†å²å¡ç‰‡ - ä¸éš hover ç¼©æ”¾ï¼Œåªæœ‰å†…å®¹ç¼©æ”¾ */
        .history-card {
            min-width: 150px;
            width: 150px;
            cursor: pointer;
            position: relative;
            padding: 3px;
        }

        .history-card .poster-wrap {
            transition: transform 0.3s;
        }

        .history-card:hover .poster-wrap {
            transform: scale(1.05);
        }

        /* åˆ é™¤æŒ‰é’®å›ºå®šåœ¨å¡ç‰‡å³ä¸Šè§’ */
        .history-delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            z-index: 20;
            width: 22px;
            height: 22px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s, background 0.2s;
        }

        .history-delete-btn i {
            color: #fff;
            font-size: 10px;
        }

        .history-card:hover .history-delete-btn {
            opacity: 1;
        }

        .history-delete-btn:hover {
            background: rgba(229, 9, 20, 0.9) !important;
        }

        /* ç§»åŠ¨ç«¯ï¼šå§‹ç»ˆæ˜¾ç¤ºåˆ é™¤æŒ‰é’® */
        @media (max-width: 768px),
        (hover: none) {
            .history-delete-btn {
                opacity: 0.8 !important;
            }
        }

        /* æ’­æ”¾å›¾æ ‡è¦†ç›–å±‚ */
        .play-icon-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: rgba(229, 9, 20, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .play-icon-overlay i {
            color: #fff;
            font-size: 14px;
            margin-left: 3px;
        }

        .history-card:hover .play-icon-overlay {
            opacity: 1;
        }

        /* æ‚¬åœæ—¶æ˜¾ç¤ºåˆ é™¤æŒ‰é’®å’Œæ’­æ”¾å›¾æ ‡ (hot-card å…¼å®¹) */
        .hot-card:hover .history-delete-btn {
            opacity: 1 !important;
        }

        .hot-card:hover .play-icon-overlay {
            opacity: 1 !important;
        }

        .poster-wrap {
            width: 100%;
            aspect-ratio: 2/3;
            border-radius: 6px;
            overflow: hidden;
            background: linear-gradient(110deg, #1a1a1a 8%, #2a2a2a 18%, #1a1a1a 33%);
            background-size: 200% 100%;
            animation: skeleton-shimmer 1.5s infinite ease-in-out;
            position: relative;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border);
        }

        /* éª¨æ¶å±é—ªçƒåŠ¨ç”» */
        @keyframes skeleton-shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        /* å›¾ç‰‡åŠ è½½å®Œæˆååœæ­¢åŠ¨ç”» */
        .poster-wrap:has(img.loaded),
        .poster-wrap.img-loaded {
            animation: none;
            background: #222;
        }

        .poster-wrap img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* æ€§èƒ½ä¼˜åŒ–ï¼šå›¾ç‰‡åŠ è½½åŠ¨ç”» */
            transition: opacity 0.4s ease;
            opacity: 0;
            /* å›¾ç‰‡è§£ç ä¼˜åŒ– */
            image-rendering: -webkit-optimize-contrast;
        }

        /* å›¾ç‰‡åŠ è½½å®Œæˆ */
        .poster-wrap img.loaded {
            opacity: 1;
        }

        /* å…œåº•ï¼šåŠ è½½å¤±è´¥æˆ–æ— srcæ—¶éšè— */
        .poster-wrap img[src=""],
        .poster-wrap img:not([src]) {
            opacity: 0;
        }

        .rank-badge {
            position: absolute;
            top: -12px;
            left: -8px;
            font-size: 64px;
            font-weight: 900;
            color: #141414;
            -webkit-text-stroke: 2px #666;
            font-family: impact, sans-serif;
            text-shadow: 2px 2px 0px #eee;
            z-index: 10;
            pointer-events: none;
            line-height: 1;
        }

        .rating-badge {
            position: absolute;
            top: 6px;
            right: 6px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            color: #46d369;
            font-weight: bold;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid rgba(70, 211, 105, 0.3);
        }

        .poster-fallback {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #333 0%, #111 100%);
            padding: 5px;
            text-align: center;
        }

        .fallback-text {
            font-size: 12px;
            color: #999;
        }

        .movie-name {
            margin-top: 10px;
            font-size: 14px;
            color: #eee;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            text-align: center;
            font-weight: 500;
        }

        .movie-date {
            font-size: 12px;
            color: #666;
            text-align: center;
            margin-top: 2px;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            min-height: 300px;
        }

        .result-card {
            cursor: pointer;
            transition: 0.2s;
        }

        .result-card:hover {
            transform: translateY(-5px);
        }

        /* â˜…â˜…â˜… æ’­æ”¾é¡µé‡æ„ï¼šå½±é™¢æ¨¡å¼ â˜…â˜…â˜… */
        .detail-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #141414;
            z-index: 9999;
            display: none;
            overflow-y: auto;
        }

        .detail-overlay.active {
            display: block;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        .close-btn {
            position: fixed;
            top: 25px;
            right: 30px;
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            cursor: pointer;
            z-index: 10005;
            backdrop-filter: blur(10px);
            transition: 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: rotate(90deg);
        }

        /* å¸ƒå±€å®¹å™¨ */
        .player-layout {
            max-width: 1200px;
            margin: 0 auto;
            padding: 90px 4% 50px;
        }

        /* è§†é¢‘åŒºåŸŸ */
        .player-box {
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
            border: 1px solid #333;
        }

        /* è§†é¢‘ä¿¡æ¯æ  */
        .video-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .video-title {
            font-size: 2.2rem;
            font-weight: 800;
            color: #fff;
            margin-bottom: 5px;
            line-height: 1.2;
        }

        .video-meta {
            color: #888;
            font-size: 14px;
        }

        /* æŠ•å±æŒ‰é’® */
        .btn-cast {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            color: #fff;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: 0.2s;
            font-size: 14px;
        }

        .btn-cast:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* æ§åˆ¶åŒºåŸŸ (ä¸‹åŠéƒ¨åˆ†) */
        .controls-area {
            background: #1f1f1f;
            border-radius: 12px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* çº¿è·¯é€‰æ‹© (æ¨ªå‘æ»šåŠ¨) */
        .panel-title {
            font-size: 14px;
            color: #888;
            font-weight: 700;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .source-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .source-pill {
            padding: 8px 16px;
            border-radius: 6px;
            background: #2a2a2a;
            border: 1px solid #333;
            color: #ccc;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
        }

        .source-pill:hover {
            background: #333;
            border-color: #666;
            color: #fff;
        }

        .source-pill.active {
            background: var(--accent);
            border-color: var(--accent);
            color: #fff;
            box-shadow: 0 4px 15px rgba(229, 9, 20, 0.3);
        }

        /* é€‰é›† (å¤§ç½‘æ ¼) */
        .ep-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            /* è‡ªé€‚åº”å®½åº¦ï¼Œæœ€å°100px */
            gap: 12px;
        }

        .ep-btn {
            background: #2a2a2a;
            border: 1px solid transparent;
            color: #ddd;
            padding: 12px 5px;
            text-align: center;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ep-btn:hover {
            background: #333;
            color: #fff;
            border-color: #555;
        }

        .ep-btn.active {
            background: #fff;
            color: #000;
            font-weight: bold;
            border-color: #fff;
        }

        /* çŠ¶æ€ç¯ */
        .latency-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .dot-green {
            background: #46d369;
            box-shadow: 0 0 5px #46d369;
        }

        .dot-yellow {
            background: #ffcc00;
        }

        .dot-red {
            background: #ff453a;
        }

        /* å±•å¼€/æ”¶èµ·æŒ‰é’® */
        .expand-toggle {
            font-size: 12px;
            font-weight: 500;
            color: #aaa;
            cursor: pointer;
            margin-left: auto;
            white-space: nowrap;
            padding: 6px 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .expand-toggle:hover {
            color: #fff;
            background: rgba(229, 9, 20, 0.15);
            border-color: rgba(229, 9, 20, 0.4);
            box-shadow: 0 4px 12px rgba(229, 9, 20, 0.2);
            z-index: 10;
            position: relative;
        }

        .expand-toggle:active {
            transform: scale(0.98);
        }

        .expand-toggle i {
            font-size: 10px;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .expand-toggle.expanded {
            background: rgba(229, 9, 20, 0.1);
            border-color: rgba(229, 9, 20, 0.3);
            color: #ff6b6b;
        }

        .expand-toggle.expanded i {
            transform: rotate(180deg);
        }

        .expand-toggle.expanded:hover {
            background: rgba(229, 9, 20, 0.2);
        }

        /* ç½‘æ ¼å±•å¼€å¸ƒå±€ - ä½¿ç”¨ flexbox ä¿æŒå›ºå®šå¡ç‰‡å®½åº¦ */
        .grid-expanded {
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
            /* ä¸å•è¡Œæ»šåŠ¨å®¹å™¨çš„ gap ä¸€è‡´ */
        }

        .grid-expanded .hot-card {
            /* ä¿æŒä¸å•è¡Œæ»šåŠ¨æ—¶ç›¸åŒçš„å›ºå®šå®½åº¦ */
            min-width: 150px;
            width: 150px;
            flex-shrink: 0;
        }

        /* åˆ†é¡µæ§åˆ¶ */
        .pagination-controls {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 25px 0;
        }

        .page-btn {
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: #fff;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .page-btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .page-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }

        .page-info {
            color: #888;
            font-size: 13px;
            min-width: 100px;
            text-align: center;
        }

        .page-info .page-num {
            color: #fff;
            font-weight: 600;
            font-size: 15px;
        }

        .footer {
            text-align: center;
            font-size: 12px;
            color: #444;
            margin-top: 80px;
            padding-bottom: 20px;
        }

        /* TV æ¨¡å¼åˆ‡æ¢æŒ‰é’® (Footer) - ç¾åŒ–ç‰ˆ */
        .tv-mode-toggle {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            margin-bottom: 12px;
            background: linear-gradient(135deg, rgba(229, 9, 20, 0.1) 0%, rgba(139, 0, 0, 0.15) 100%);
            border: 1px solid rgba(229, 9, 20, 0.3);
            border-radius: 25px;
            color: #e50914;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        .tv-mode-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .tv-mode-toggle:hover::before {
            left: 100%;
        }

        .tv-mode-toggle:hover {
            background: linear-gradient(135deg, rgba(229, 9, 20, 0.25) 0%, rgba(139, 0, 0, 0.3) 100%);
            border-color: rgba(229, 9, 20, 0.6);
            box-shadow: 0 0 20px rgba(229, 9, 20, 0.3), 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }

        .tv-mode-toggle:active {
            transform: translateY(0);
        }

        .tv-mode-toggle i {
            font-size: 16px;
            filter: drop-shadow(0 0 3px rgba(229, 9, 20, 0.5));
        }

        /* è®¾ç½®å¼€å…³æ ·å¼ */
        .settings-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
            flex-shrink: 0;
        }

        .settings-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .settings-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: 0.3s;
            border-radius: 26px;
        }

        .settings-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .settings-switch input:checked+.settings-slider {
            background: linear-gradient(135deg, #e50914, #ff4757);
        }

        .settings-switch input:checked+.settings-slider:before {
            transform: translateX(24px);
        }

        /* ç”µå½±è¯¦æƒ…å¼¹çª— */
        .info-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .info-modal {
            position: relative;
            max-width: 800px;
            width: 100%;
            background: #181818;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .info-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.6);
            border: none;
            color: #fff;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            font-size: 16px;
        }

        .info-modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .info-modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 250px;
            background-size: cover;
            background-position: center;
            opacity: 0.4;
        }

        .info-modal-backdrop::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, transparent, #181818);
        }

        .info-modal-content {
            position: relative;
            display: flex;
            gap: 25px;
            padding: 30px;
            padding-top: 180px;
        }

        .info-modal-poster {
            flex-shrink: 0;
            width: 180px;
        }

        .info-modal-poster img {
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
        }

        .info-modal-details {
            flex: 1;
        }

        .info-modal-details h2 {
            font-size: 1.8rem;
            margin-bottom: 12px;
            color: #fff;
        }

        .info-modal-meta {
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: #aaa;
            margin-bottom: 15px;
        }

        .info-rating {
            color: #ffc107;
            font-weight: bold;
        }

        .info-overview {
            color: #bbb;
            font-size: 14px;
            line-height: 1.7;
            max-height: 120px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .info-modal-btns {
            display: flex;
            gap: 12px;
        }

        @media (max-width: 600px) {
            .info-modal-content {
                flex-direction: column;
                padding-top: 200px;
                text-align: center;
            }

            .info-modal-poster {
                width: 120px;
                margin: 0 auto;
            }

            .info-modal-meta {
                justify-content: center;
            }

            .info-modal-btns {
                justify-content: center;
            }
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Loading Screen */
        .app-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a0a;
            /* Deep dark background */
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.6s ease-out, visibility 0.6s;
        }

        .app-loader.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .loader-logo {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(45deg, #e50914, #ff5151);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
            letter-spacing: 2px;
            animation: pulse 2s infinite;
        }

        .loader-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top-color: #e50914;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.8;
            }
        }

        /* Password Protection Screen */
        .password-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .password-screen.hidden {
            opacity: 0;
            transform: scale(1.1);
            pointer-events: none;
        }

        .password-container {
            background: rgba(30, 30, 40, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 50px 40px;
            width: 100%;
            max-width: 420px;
            margin: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 100px rgba(229, 9, 20, 0.1);
            animation: floatIn 0.8s ease-out;
        }

        @keyframes floatIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .password-logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .password-logo-text {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, #e50914, #ff5151);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
        }

        .password-logo-subtitle {
            color: rgba(255, 255, 255, 0.5);
            font-size: 14px;
            margin-top: 10px;
        }

        .password-input-group {
            position: relative;
            margin-bottom: 25px;
        }

        .password-input {
            width: 100%;
            padding: 18px 50px 18px 20px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s ease;
            outline: none;
        }

        .password-input:focus {
            border-color: #e50914;
            box-shadow: 0 0 20px rgba(229, 9, 20, 0.2);
        }

        .password-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            font-size: 18px;
            transition: color 0.2s;
        }

        .password-toggle:hover {
            color: #fff;
        }

        .password-submit {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #e50914 0%, #b20710 100%);
            border: none;
            border-radius: 12px;
            color: #fff;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .password-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(229, 9, 20, 0.4);
        }

        .password-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .password-error {
            background: rgba(229, 9, 20, 0.2);
            border: 1px solid rgba(229, 9, 20, 0.4);
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 20px;
            color: #ff6b6b;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: shake 0.5s ease;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            20%,
            60% {
                transform: translateX(-5px);
            }

            40%,
            80% {
                transform: translateX(5px);
            }
        }

        .password-remember {
            display: flex;
            align-items: center;
            gap: 10px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            margin-bottom: 25px;
            cursor: pointer;
        }

        .password-remember input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #e50914;
            cursor: pointer;
        }

        /* ========== Firefox Android é—ªçƒä¿®å¤ ========== */
        /* åœ¨ç§»åŠ¨ç«¯ç¦ç”¨å¯èƒ½å¯¼è‡´æ¸²æŸ“é—®é¢˜çš„æ•ˆæœ */
        @media (max-width: 768px),
        (hover: none) {

            /* ç¦ç”¨æ¯›ç»ç’ƒæ•ˆæœ */
            .dplayer-controller,
            .dplayer-setting-box,
            .search-form,
            .detail-overlay .detail-container {
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
            }

            /* å‡å°‘ box-shadow å¤æ‚åº¦ */
            .dplayer-bar-wrap .dplayer-thumb,
            .dplayer-bezel-icon {
                box-shadow: none !important;
            }

            /* ç¦ç”¨ filter æ•ˆæœ */
            .search-icon,
            .hero-search button {
                filter: none !important;
            }

            /* ç¡®ä¿æ‰€æœ‰å…ƒç´ æœ‰æ˜ç¡®èƒŒæ™¯ï¼Œé˜²æ­¢é€æ˜å±‚é—ªçƒ */
            .hot-card img,
            .history-card img {
                background-color: var(--panel-bg);
            }

            /* ç¦ç”¨ hover åŠ¨ç”»ï¼ˆç§»åŠ¨ç«¯ä¸éœ€è¦ï¼‰ */
            .hot-card:hover,
            .history-card:hover {
                transform: none !important;
            }
        }

        /* ğŸ“± Android/Capacitor Fullscreen: åªå¤„ç†å¿…è¦çš„å…¨å±é€‚é… */
        /* DPlayer å…¨å±æ¨¡å¼ - ç¡®ä¿è¦†ç›–æ•´ä¸ªå±å¹• */
        .dplayer-fulled {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 2147483647 !important;
            background: #000 !important;
        }

        /* ç¡®ä¿ body å’Œ html åœ¨å…¨å±æ—¶ä¸ä¼šæ»šåŠ¨ï¼Œå¹¶ç§»é™¤å®‰å…¨åŒºåŸŸ padding */
        html:has(.dplayer-fulled),
        body:has(.dplayer-fulled) {
            overflow: hidden !important;
            padding-top: 0 !important;
        }

        /* éšè—å¯¼èˆªæ  */
        html:has(.dplayer-fulled) .navbar-custom,
        body:has(.dplayer-fulled) .navbar-custom,
        html:has(.dplayer-web-fullscreen) .navbar-custom,
        body:has(.dplayer-web-fullscreen) .navbar-custom {
            display: none !important;
        }

        /* ğŸ“º ç½‘é¡µå…¨å±æ¨¡å¼ - åªéšè—å¯¼èˆªæ ï¼Œä¸è¦†ç›– DPlayer åŸç”Ÿæ ·å¼ */
        /* DPlayer è‡ªå·±ä¼šå¤„ç†ç½‘é¡µå…¨å±çš„å¸ƒå±€ */
        /* ========== ğŸ“º TV æ¨¡å¼æ‚¬æµ®æŒ‰é’®ç¾åŒ– ========== */
        .tv-mode-float-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            /* å·¦ä¸‹è§’ï¼Œé¿å…ä¸è¿”å›é¡¶éƒ¨æŒ‰é’®é‡å  */
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 18px;
            background: rgba(30, 30, 30, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            user-select: none;
            outline: none;
        }

        /* ç„¦ç‚¹çŠ¶æ€ (é¥æ§å™¨é€‰ä¸­) */
        .tv-mode-float-btn:focus {
            border-color: #fff;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.5), 0 8px 32px rgba(0, 0, 0, 0.3);
            transform: scale(1.05);
        }

        /* æ‚¬åœæ•ˆæœ */
        .tv-mode-float-btn:hover {
            background: rgba(40, 40, 40, 0.8);
            transform: translateY(-2px) scale(1.05);
            border-color: rgba(229, 9, 20, 0.5);
            box-shadow: 0 15px 40px rgba(229, 9, 20, 0.2);
        }

        /* æ¿€æ´»çŠ¶æ€ (TV æ¨¡å¼å¼€å¯) */
        .tv-mode-float-btn.tv-active {
            background: rgba(229, 9, 20, 0.15);
            border-color: #e50914;
            box-shadow: 0 0 20px rgba(229, 9, 20, 0.4), inset 0 0 10px rgba(229, 9, 20, 0.2);
        }

        .tv-mode-float-btn.tv-active .tv-icon-wrapper i {
            color: #e50914;
            text-shadow: 0 0 10px rgba(229, 9, 20, 0.8);
        }

        .tv-mode-float-btn.tv-active .tv-text {
            color: #fff;
            text-shadow: 0 0 8px rgba(229, 9, 20, 0.6);
        }

        /* å›¾æ ‡åŒ…è£… */
        .tv-icon-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
        }

        .tv-icon-wrapper i {
            font-size: 18px;
            color: #ccc;
            transition: all 0.3s ease;
        }

        /* æ–‡å­— */
        .tv-text {
            font-size: 14px;
            font-weight: 600;
            color: #ccc;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        /* å…‰æ™•åŠ¨ç”» */
        .tv-glow {
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: skewX(-25deg);
            transition: left 0.5s;
            pointer-events: none;
        }

        .tv-mode-float-btn:hover .tv-glow {
            left: 150%;
            transition: left 0.8s ease-in-out;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .tv-mode-float-btn {
                bottom: 80px;
                /* é¿å¼€åº•éƒ¨å¯¼èˆªæ æˆ–æ’­æ”¾å™¨ */
                right: 15px;
                padding: 8px 14px;
            }

            .tv-text {
                display: none;
                /* ç§»åŠ¨ç«¯åªæ˜¾ç¤ºå›¾æ ‡ï¼Œæ›´ç®€æ´ */
            }

            .tv-mode-float-btn.tv-active .tv-text {
                display: block;
                /* æ¿€æ´»æ—¶æ˜¾ç¤ºæ–‡å­— */
                font-size: 12px;
            }
        }
    </style>
</head>

<body>
    <!-- Initial Loading Screen (Buffer) -->
    <div id="app-loader" class="app-loader">
        <div class="loader-logo" style="display: flex; align-items: center; justify-content: center;"><img
                src="icon.png" style="height: 42px; margin-right: 8px; border-radius: 10px;">è§†ç•Œ
            <span style="font-size:1.2rem; -webkit-text-fill-color: #fff; opacity:0.8;">MAX</span>
        </div>
        <div class="loader-spinner"></div>
        <div id="loader-status" style="margin-top: 20px; color: #666; font-size: 13px; text-align: center;">æ­£åœ¨åˆå§‹åŒ–...
        </div>
    </div>

    <!-- Password Protection Screen -->
    <div id="password-screen" class="password-screen" style="display: none;">
        <div class="password-container">
            <div class="password-logo">
                <div class="password-logo-text" style="display: flex; align-items: center; justify-content: center;">
                    <img src="icon.png" style="height: 32px; margin-right: 8px; border-radius: 8px;">è§†ç•Œ <span
                        style="font-size:1rem; -webkit-text-fill-color: #fff; opacity:0.8;">MAX</span>
                </div>
                <div class="password-logo-subtitle"><i class="fas fa-lock"></i> éœ€è¦å¯†ç æ‰èƒ½è®¿é—®</div>
            </div>

            <div id="password-error" class="password-error" style="display: none;">
                <i class="fas fa-exclamation-circle"></i>
                <span id="password-error-text">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</span>
            </div>

            <form id="password-form" onsubmit="return handlePasswordSubmit(event);">
                <div class="password-input-group">
                    <input type="password" id="password-input" class="password-input" placeholder="è¯·è¾“å…¥è®¿é—®å¯†ç "
                        autocomplete="current-password" required>
                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility()">
                        <i id="password-eye" class="fas fa-eye"></i>
                    </button>
                </div>

                <label class="password-remember">
                    <input type="checkbox" id="remember-password" checked>
                    <span>è®°ä½ç™»å½•çŠ¶æ€ (1å¹´)</span>
                </label>

                <button type="submit" class="password-submit" id="password-submit-btn">
                    <i class="fas fa-unlock"></i>
                    <span>éªŒè¯å¯†ç </span>
                </button>
            </form>
        </div>
    </div>

    <div id="app" v-cloak>

        <nav class="navbar-custom" :class="{ 'scrolled': scrollY > 50 }" v-show="!searched">
            <div class="brand" @click="goHome" style="cursor: pointer; display: flex; align-items: center;"><img
                    src="icon.png" style="height: 28px; margin-right: 6px; border-radius: 6px;">è§†ç•Œ <span
                    style="font-size:12px; color:#666; font-weight:normal; margin-left: 2px;">MAX</span></div>
        </nav>

        <!-- Back to Top Button -->
        <button class="btn-top" :class="{ show: scrollY > 500 }" @click="scrollToTop">
            <i class="fas fa-arrow-up"></i>
        </button>

        <!-- 1. Hero Carousel -->
        <div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="6000"
            v-if="!searched">
            <div class="carousel-inner" v-if="heroList.length > 0">
                <div class="carousel-item" v-for="(item, index) in heroList" :key="index"
                    :class="{ active: index === 0 }">
                    <div class="hero-bg" :style="{ backgroundImage: 'url(' + item.backdrop + ')' }"></div>
                    <div class="hero-overlay">
                        <div class="hero-content">
                            <div class="hero-tag">æœ¬å‘¨ TOP {{ index + 1 }}</div>
                            <h1 class="hero-title">{{ item.title }}</h1>
                            <p class="hero-desc">{{ item.overview }}</p>
                            <div class="hero-btns" style="display: flex; gap: 15px; flex-wrap: wrap;">
                                <button class="btn-play" @click="autoSearch(item.title, item.originalTitle)"><i
                                        class="fas fa-play"></i>
                                    æ’­æ”¾</button>
                                <button class="btn-info" @click="showMovieInfo(item.rawData)"><i
                                        class="fas fa-info-circle"></i> æ›´å¤šä¿¡æ¯</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. Search -->
        <div class="search-section"
            :style="{ marginTop: searched ? '60px' : '-35px', position: searched ? 'relative' : 'sticky' }">
            <div class="search-box-wrapper" :class="{ 'compact': !searched && scrollY > 400 }">
                <i class="fas fa-search search-icon" @click="doSearch"></i>
                <input type="text" v-model="keyword" @keyup.enter="doSearch" @input="debouncedSearch"
                    class="search-input" placeholder="è¾“å…¥ç‰‡åæˆ–å‰§é›†åç§°...">
            </div>
        </div>

        <div v-if="!searched">
            <!-- ğŸ• è§‚çœ‹å†å² (æœ€ä¸Šæ–¹) -->
            <div class="section-container animate__animated animate__fadeInUp" v-if="watchHistory.length > 0"
                style="margin-top: 60px; margin-bottom: 10px;">
                <div class="section-header" style="display: flex; align-items: center;">
                    <div class="section-line" style="background: linear-gradient(135deg, #667eea, #764ba2);"></div>
                    <div class="section-title"><i class="fas fa-history"></i> ç»§ç»­è§‚çœ‹</div>
                    <!-- åŒæ­¥çŠ¶æ€å›¾æ ‡ (åŒå‡»é€€å‡ºç™»å½•) -->
                    <span v-if="syncEnabled" style="margin-left: 8px; font-size: 12px; opacity: 0.6; cursor: pointer;"
                        :title="syncStatus === 'syncing' ? 'æ­£åœ¨åŒæ­¥...' : syncStatus === 'success' ? 'å·²åŒæ­¥' : syncStatus === 'error' ? 'åŒæ­¥å¤±è´¥' : 'äº‘åŒæ­¥å·²å¯ç”¨ (åŒå‡»é€€å‡º)'"
                        @dblclick="confirmLogout">
                        <i v-if="syncStatus === 'syncing'" class="fas fa-sync-alt fa-spin" style="color: #60a5fa;"></i>
                        <i v-else-if="syncStatus === 'success'" class="fas fa-cloud-upload-alt"
                            style="color: #46d369;"></i>
                        <i v-else-if="syncStatus === 'error'" class="fas fa-exclamation-triangle"
                            style="color: #ef4444;"></i>
                        <i v-else class="fas fa-cloud" style="color: #888;"></i>
                    </span>
                    <span class="expand-toggle" @click="clearWatchHistory"
                        style="margin-left: auto; color: #888; font-size: 12px;">
                        <i class="fas fa-trash-alt"></i> æ¸…é™¤å…¨éƒ¨
                    </span>
                </div>

                <!-- æ¨ªå‘æ»šåŠ¨ -->
                <div class="scroll-container">
                    <button class="scroll-btn left" v-show="historyCanScrollLeft" @click="scrollHistoryRow(-1)"><i
                            class="fas fa-chevron-left"></i></button>
                    <div class="hot-row" ref="watchHistoryRow" @scroll="onHistoryScroll">
                        <div class="history-card" v-for="(item, index) in watchHistory" :key="item.name + index">
                            <!-- åˆ é™¤æŒ‰é’® (æ”¾åœ¨ card å¤–å±‚é¿å…éšç¼©æ”¾ç§»åŠ¨) -->
                            <div class="history-delete-btn" @click.stop="removeFromHistory(index)">
                                <i class="fas fa-times"></i>
                            </div>
                            <div class="poster-wrap" @click="playFromHistory(item)">
                                <img :src="item.poster" :alt="item.name"
                                    @load="$event.target.classList.add('loaded'); $event.target.parentElement && $event.target.parentElement.classList.add('img-loaded')"
                                    @error="$event.target.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27150%27 height=%27225%27%3E%3Crect fill=%27%23333%27 width=%27150%27 height=%27225%27/%3E%3C/svg%3E'; $event.target.classList.add('loaded'); $event.target.parentElement && $event.target.parentElement.classList.add('img-loaded')"
                                    loading="lazy">
                                <!-- è¿›åº¦æ¡ -->
                                <div
                                    style="position: absolute; bottom: 0; left: 0; right: 0; height: 4px; background: rgba(0,0,0,0.5);">
                                    <div
                                        :style="{ width: item.progress + '%', height: '100%', background: 'linear-gradient(90deg, #e50914, #ff4757)' }">
                                    </div>
                                </div>
                                <!-- é›†æ•°æ ‡ç­¾ -->
                                <div v-if="item.episode"
                                    style="position: absolute; top: 6px; left: 6px; background: rgba(0,0,0,0.8); color: #fff; font-size: 10px; padding: 2px 6px; border-radius: 4px;">
                                    {{ item.episode }}
                                </div>
                                <!-- æ’­æ”¾å›¾æ ‡ -->
                                <div class="play-icon-overlay">
                                    <i class="fas fa-play"></i>
                                </div>
                            </div>
                            <div class="movie-name" @click="playFromHistory(item)">{{ item.name }}</div>
                            <div class="movie-date" style="font-size: 11px;">{{ formatWatchTime(item.watchedAt) }}</div>
                        </div>
                    </div>
                    <button class="scroll-btn right" v-show="historyCanScrollRight" @click="scrollHistoryRow(1)"><i
                            class="fas fa-chevron-right"></i></button>
                </div>
            </div>

            <!-- åˆ†ç±»å¯¼èˆªæ  -->
            <div class="category-nav-container animate__animated animate__fadeInUp" style="margin-bottom: 40px;">
                <div class="category-item" v-for="item in categories" :key="item.name" @click="handleCatClick(item)">
                    <div class="cat-icon" :style="{ background: item.color }">
                        <i :class="['fas', item.icon]"></i>
                    </div>
                    <span>{{ item.name }}</span>
                </div>
            </div>
            <!-- åŠ¨æ€ç”Ÿæˆçš„æ¦œå• Rows -->
            <div class="section-container animate__animated animate__fadeInUp"
                v-for="(config, key, index) in rowConfigs" :key="key" :ref="key + '-section'" :data-row-key="key"
                v-show="!(key === 'randomRow' && hideRandomRow)">
                <!-- æ ‡é¢˜åŒºï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼Œç”¨äºæ‡’åŠ è½½è§¦å‘ï¼‰ -->
                <div class="section-header" style="display: flex; align-items: center;">
                    <div class="section-line"></div>
                    <div class="section-title">
                        <!-- ä»…å¯¹å¸¦ sortMode çš„ discover åˆ†ç±»æ˜¾ç¤ºåˆ‡æ¢å›¾æ ‡ -->
                        <i :class="['fas', config.icon, config.sortMode ? 'sort-toggle-icon' : '', config.sortMode]"
                            @click.stop="config.sortMode ? toggleSortMode(key) : null"
                            :style="{ cursor: config.sortMode ? 'pointer' : 'default' }"
                            :title="config.sortMode ? 'ç‚¹å‡»åˆ‡æ¢æ’åº (å½“å‰: ' + (config.sortMode === 'newest' ? 'æœ€æ–°' : 'çƒ­é—¨') + ')' : ''"></i>
                        {{ config.title }}
                        <!-- ä»…å¯¹ discover åˆ†ç±»æ˜¾ç¤ºæ’åºè§’æ ‡ -->
                        <span v-if="config.sortMode && config.path.includes('/discover/')" class="sort-indicator">
                            {{ config.sortMode === 'newest' ? 'NEW' : 'HOT' }}
                        </span>
                    </div>
                    <span class="expand-toggle" :class="{ expanded: expandedRows[key] }" @click="toggleRowExpand(key)"
                        v-show="rowLists[key] && rowLists[key].length > 0">
                        {{ expandedRows[key] ? 'æ”¶èµ·' : 'å±•å¼€' }}
                        <i class="fas fa-chevron-down"></i>
                    </span>
                    <!-- åŠ è½½ä¸­æç¤º -->
                    <span v-if="!rowLists[key]" style="margin-left: 15px; color: #666; font-size: 12px;">
                        <i class="fas fa-spinner fa-spin"></i> åŠ è½½ä¸­...
                    </span>
                </div>
                <!-- å†…å®¹åŒºï¼ˆæœ‰æ•°æ®æ—¶æ˜¾ç¤ºï¼‰ -->
                <template v-if="rowLists[key] && rowLists[key].length > 0">
                    <!-- æ”¶èµ·çŠ¶æ€ï¼šæ¨ªå‘æ»šåŠ¨ -->
                    <div class="scroll-container" v-show="!expandedRows[key]">
                        <button class="scroll-btn left" @click="scrollRow(key, -1)" v-show="rowLeftButtons[key]"><i
                                class="fas fa-chevron-left"></i></button>
                        <div class="hot-row" :ref="key" @scroll="onRowScroll(key)">
                            <div class="hot-card" v-for="item in rowLists[key]" :key="item.id"
                                @click="autoSearch(item.title || item.name, item.original_title || item.original_name)">
                                <div class="poster-wrap">
                                    <img :src="getPosterUrl(item.poster_path)" loading="lazy"
                                        @load="$event.target.classList.add('loaded'); $event.target.parentElement.classList.add('img-loaded')">
                                    <div class="rating-badge"><i class="fas fa-star text-warning"></i> {{
                                        item.vote_average
                                        ? item.vote_average.toFixed(1) : 'N/A' }}</div>
                                </div>
                                <div class="movie-name">{{ item.title || item.name }}</div>
                                <div class="movie-date">{{ (item.release_date || item.first_air_date ||
                                    '').split('-')[0] }}
                                </div>
                            </div>
                        </div>
                        <button class="scroll-btn right" @click="scrollRow(key, 1)"><i
                                class="fas fa-chevron-right"></i></button>
                    </div>
                    <!-- å±•å¼€çŠ¶æ€ï¼šåˆ†é¡µç½‘æ ¼å¸ƒå±€ -->
                    <div class="grid-expanded" v-show="expandedRows[key]">
                        <div class="hot-card" v-for="item in getPagedItems(key)" :key="'grid-' + item.id"
                            @click="autoSearch(item.title || item.name, item.original_title || item.original_name)">
                            <div class="poster-wrap">
                                <img :src="getPosterUrl(item.poster_path)"
                                    @load="$event.target.classList.add('loaded'); $event.target.parentElement.classList.add('img-loaded')">
                                <div class="rating-badge"><i class="fas fa-star text-warning"></i> {{ item.vote_average
                                    ? item.vote_average.toFixed(1) : 'N/A' }}</div>
                            </div>
                            <div class="movie-name">{{ item.title || item.name }}</div>
                            <div class="movie-date">{{ (item.release_date || item.first_air_date || '').split('-')[0] }}
                            </div>
                        </div>
                        <!-- åˆ†é¡µæ§åˆ¶åŒº -->
                        <div class="pagination-controls">
                            <button class="page-btn" @click="changeViewPage(key, -1)"
                                :disabled="(viewPages[key] || 1) <= 1">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <div class="page-info">
                                <span class="page-num">{{ viewPages[key] || 1 }}</span> é¡µ
                            </div>
                            <button class="page-btn" @click="changeViewPage(key, 1)"
                                :disabled="(viewPages[key] || 1) >= getTotalViewPages(key) && rowConfigs[key].page >= (rowConfigs[key].totalPages || 999)">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Search Results -->
        <div id="search-result-anchor" class="section-container" v-if="searched">
            <div class="d-flex align-items-center gap-2 mb-5 mt-2">
                <button class="btn btn-outline-secondary rounded-pill px-3 px-md-4 py-2" @click="goHome"
                    style="color: #fff; border-color: rgba(255,255,255,0.3);">
                    <i class="fas fa-arrow-left me-0 me-md-2"></i><span class="d-none d-md-inline">è¿”å›é¦–é¡µ</span>
                </button>
                <div class="section-header mb-0 ms-3 ms-md-4">
                    <div class="section-line"></div>
                    <div class="section-title">æ­£åœ¨æœç´¢: "{{ keyword }}"</div>
                </div>
            </div>

            <!-- æœç´¢ç»“æœç½‘æ ¼ (å³ä½¿åœ¨ loading ä¹Ÿå¯ä»¥æ˜¾ç¤º) -->
            <div class="result-grid" v-if="groupedList.length > 0">
                <div class="result-card" v-for="group in groupedList" :key="group.name" @click="openDetail(group)">
                    <div class="poster-wrap">
                        <img v-if="!isFallback(group.name)" :src="finalPoster(group)" :key="finalPoster(group)"
                            referrerpolicy="no-referrer" loading="lazy"
                            @load="$event.target.classList.add('loaded'); $event.target.parentElement && $event.target.parentElement.classList.add('img-loaded')"
                            @error="handleImgError(group.name); $event.target.classList.add('loaded'); $event.target.parentElement && $event.target.parentElement.classList.add('img-loaded')">
                        <div v-else class="poster-fallback">
                            <i class="fas fa-film mb-2 opacity-50"></i>
                            <div style="font-size:12px; color:#999">{{ group.name }}</div>
                        </div>
                        <div class="rating-badge" style="background:var(--accent); color:#fff; border:none;">
                            {{ group.sources.length }} æº
                        </div>
                    </div>
                    <div class="movie-name">{{ group.name }}</div>
                </div>
            </div>

            <!-- åŠ è½½ä¸­æç¤º (å¦‚æœæ²¡ç»“æœå±…ä¸­ï¼Œæœ‰ç»“æœåœ¨åº•éƒ¨) -->
            <div v-if="loading" class="text-center py-4">
                <div class="spinner-border text-danger" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <div class="mt-2 text-muted small" v-if="groupedList.length > 0">æ­£åœ¨æœç´¢æ›´å¤šèµ„æº...</div>
                <div class="mt-2 text-muted small" v-else>æ­£åœ¨å…¨ç½‘æœç´¢...</div>
            </div>

            <div v-if="!loading && groupedList.length === 0" class="text-center"
                style="padding: 60px 20px; margin-top: -20px;">
                <i class="fas fa-search" style="font-size: 48px; color: #444; margin-bottom: 20px;"></i>
                <h4 style="color: #888; margin-bottom: 15px;">æš‚æœªæ‰¾åˆ°ã€Œ{{ keyword }}ã€çš„ç›¸å…³èµ„æº</h4>
                <div style="color: #666; font-size: 14px; line-height: 1.8; max-width: 400px; margin: 0 auto;">
                    <p style="margin-bottom: 8px;">ğŸ“Œ æ–°ä¸Šæ˜ çš„ç”µå½±/å‰§é›†å¯èƒ½éœ€è¦ç­‰å¾…1-2å‘¨æ‰æœ‰èµ„æº</p>
                    <p style="margin-bottom: 8px;">ğŸ’¡ å°è¯•æœç´¢ç”µå½±çš„ä¸­æ–‡å</p>
                    <p>ğŸ” æˆ–å°è¯•æœç´¢å…¶ä»–çƒ­é—¨å½±ç‰‡</p>
                </div>
                <button class="btn btn-outline-danger mt-4" @click="clearSearch"
                    style="border-radius: 20px; padding: 8px 25px;">
                    <i class="fas fa-home"></i> è¿”å›é¦–é¡µ
                </button>
            </div>
        </div>

        <!-- å…³é—­ TV æ¨¡å¼æµ®çª— (ä»… TV æ¨¡å¼æ—¶æ˜¾ç¤ºï¼Œé¥æ§å™¨ä¸å¯é€‰ä¸­é˜²æ­¢è¯¯è§¦) -->
        <div v-if="isTVMode" class="tv-mode-float-btn tv-active" tabindex="-1" @click="toggleTVMode" title="ç‚¹å‡»å…³é—­TVæ¨¡å¼">
            <div class="tv-icon-wrapper">
                <i class="fas fa-times"></i>
            </div>
            <span class="tv-text">å…³é—­ TV</span>
            <div class="tv-glow"></div>
        </div>

        <div class="footer">
            <!-- TV æ¨¡å¼å¼€å…³ (é TV æ¨¡å¼æ—¶æ˜¾ç¤ºï¼Œç”¨äºå¼€å¯) -->
            <div v-if="!isTVMode" class="tv-mode-toggle" @click="toggleTVMode" title="åˆ‡æ¢åˆ°TVæ¨¡å¼ï¼ˆé¥æ§å™¨å¯¼èˆªï¼‰">
                <i class="fas fa-tv"></i>
                <span>å¼€å¯ TV æ¨¡å¼</span>
            </div>
            <!-- è®¾ç½®æŒ‰é’® -->
            <div class="tv-mode-toggle" @click="showSettingsModal = true" style="margin-top: 10px;" title="åå¥½è®¾ç½®">
                <i class="fas fa-cog"></i>
                <span>åå¥½è®¾ç½®</span>
            </div>
            <!-- éšè—çš„é€€å‡ºç™»å½•æŒ‰é’®ï¼šè¿ç»­ç‚¹å‡»3æ¬¡é€€å‡º -->
            <div style="font-size:10px; margin-top:5px; opacity:0.5; cursor: default; user-select: none;"
                @click="handleFooterClick" :title="footerClickCount >= 2 ? 'å†ç‚¹å‡»1æ¬¡é€€å‡ºç™»å½•' : ''">
                Data provided by TMDb & Maccms APIs
            </div>
        </div>

        <!-- è®¾ç½®å¼¹çª— -->
        <div class="info-modal-overlay" v-if="showSettingsModal" @click.self="showSettingsModal = false">
            <div class="info-modal" style="max-width: 450px;">
                <button class="info-modal-close" @click="showSettingsModal = false"><i
                        class="fas fa-times"></i></button>
                <div style="padding: 30px;">
                    <h2 style="color: #fff; margin-bottom: 25px; font-size: 1.5rem;">
                        <i class="fas fa-cog" style="margin-right: 10px; color: #e50914;"></i>åå¥½è®¾ç½®
                    </h2>

                    <!-- éšæœºç›²ç›’å¼€å…³ -->
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <div>
                            <div style="color: #fff; font-size: 15px; font-weight: 500;">éšè—éšæœºç›²ç›’</div>
                            <div style="color: #888; font-size: 12px; margin-top: 4px;">å…³é—­é¦–é¡µçš„éšæœºæ¨èæ¿å—</div>
                        </div>
                        <label class="settings-switch">
                            <input type="checkbox" v-model="hideRandomRow" @change="saveSettings('hideRandomRow')">
                            <span class="settings-slider"></span>
                        </label>
                    </div>

                    <!-- NSFW è¿‡æ»¤å¼€å…³ -->
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <div>
                            <div style="color: #fff; font-size: 15px; font-weight: 500;">è¿‡æ»¤æˆäººå†…å®¹</div>
                            <div style="color: #888; font-size: 12px; margin-top: 4px;">è¿‡æ»¤éšæœºç›²ç›’ä¸­çš„ä¸é€‚å®œå†…å®¹</div>
                        </div>
                        <label class="settings-switch">
                            <input type="checkbox" v-model="filterNsfw" @change="saveSettings('filterNsfw')">
                            <span class="settings-slider"></span>
                        </label>
                    </div>

                    <!-- æç¤ºä¿¡æ¯ -->
                    <div
                        style="margin-top: 20px; padding: 15px; background: rgba(229, 9, 20, 0.1); border-radius: 10px; border: 1px solid rgba(229, 9, 20, 0.2);">
                        <div style="color: #ff6b6b; font-size: 13px;">
                            <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                            è®¾ç½®ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œåˆ·æ–°é¡µé¢åç”Ÿæ•ˆå®Œæ•´çš„è¿‡æ»¤æ•ˆæœ
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- â˜…â˜…â˜… TMDb ç”µå½±è¯¦æƒ…å¼¹çª— â˜…â˜…â˜… -->
        <div class="info-modal-overlay" v-if="showInfoModal" @click.self="showInfoModal = false">
            <div class="info-modal">
                <button class="info-modal-close" @click="showInfoModal = false"><i class="fas fa-times"></i></button>
                <div class="info-modal-backdrop"
                    :style="{ backgroundImage: infoModalData ? 'url(' + TMDB_BACKDROP_URL + infoModalData.backdrop_path + ')' : '' }">
                </div>
                <div class="info-modal-content" v-if="infoModalData">
                    <div class="info-modal-poster">
                        <img :src="TMDB_IMG_URL + infoModalData.poster_path"
                            :alt="infoModalData.title || infoModalData.name">
                    </div>
                    <div class="info-modal-details">
                        <h2>{{ infoModalData.title || infoModalData.name }}</h2>
                        <div class="info-modal-meta">
                            <span class="info-rating"><i class="fas fa-star text-warning"></i> {{
                                infoModalData.vote_average ? infoModalData.vote_average.toFixed(1) : 'N/A' }}</span>
                            <span>{{ (infoModalData.release_date || infoModalData.first_air_date || '').split('-')[0]
                                }}</span>
                            <span v-if="infoModalData.runtime">{{ infoModalData.runtime }} åˆ†é’Ÿ</span>
                        </div>
                        <p class="info-overview">{{ infoModalData.overview || 'æš‚æ— ç®€ä»‹' }}</p>
                        <div class="info-modal-btns">
                            <button class="btn-play"
                                @click="showInfoModal = false; autoSearch(infoModalData.title || infoModalData.name, infoModalData.original_title || infoModalData.original_name)">
                                <i class="fas fa-play"></i> ç«‹å³æ’­æ”¾
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- â˜…â˜…â˜… æ’­æ”¾è¯¦æƒ…é¡µ (å½±é™¢å¸ƒå±€) â˜…â˜…â˜… -->
        <div class="detail-overlay" :class="{ active: showDetail }">
            <div class="close-btn" tabindex="1" @click="closeDetail" @keydown.enter="closeDetail"><i
                    class="fas fa-times"></i></div>

            <div class="player-layout" v-if="currentGroup">

                <!-- 1. é¡¶éƒ¨ï¼šæ ‡é¢˜æ  + æŠ•å± -->
                <div class="video-header">
                    <div>
                        <h1 class="video-title">{{ currentGroup.name }}</h1>
                        <div class="video-meta">
                            æ­£åœ¨æ’­æ”¾: <span class="text-white fw-bold">{{ currentSource && currentSource.site_name }}</span>
                        </div>
                    </div>
                    <button class="btn-cast" tabindex="2" @click="castVideo">
                        <i class="fas fa-tv"></i> ä¸€é”®æŠ•å±
                    </button>
                </div>

                <!-- 2. ä¸­éƒ¨ï¼šè¶…å¤§æ’­æ”¾å™¨ -->
                <div class="player-box" style="position: relative;">
                    <div id="dplayer" style="width: 100%; height: 100%;"></div>
                    <!-- è‡ªåŠ¨åˆ‡æ¢çº¿è·¯æç¤º -->
                    <div v-if="autoRetryMessage" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                               background: rgba(0,0,0,0.9); padding: 20px 30px; border-radius: 10px; 
                               text-align: center; z-index: 100; border: 1px solid rgba(255,255,255,0.1);">
                        <i class="fas fa-sync-alt fa-spin"
                            style="font-size: 24px; color: #e50914; margin-bottom: 10px;"></i>
                        <div style="color: #fff; font-weight: bold;">{{ autoRetryMessage }}</div>
                        <div style="color: #888; font-size: 12px; margin-top: 5px;">æ­£åœ¨è‡ªåŠ¨åˆ‡æ¢...</div>
                    </div>
                </div>

                <!-- 3. åº•éƒ¨ï¼šæ§åˆ¶é¢æ¿ -->
                <div class="controls-area">
                    <!-- å‰§é›†ç®€ä»‹ -->
                    <div class="mb-4" v-if="currentSource">
                        <div class="panel-title">å‰§æƒ…ç®€ä»‹</div>
                        <p
                            style="color: #999; font-size: 13px; line-height: 1.7; max-height: 80px; overflow-y: auto; margin: 0;">
                            <span v-if="loadingDetail"><i class="fas fa-spinner fa-spin"></i> åŠ è½½ä¸­...</span>
                            <span v-else>{{ stripHtml(currentSource.vod_content) || 'æš‚æ— ç®€ä»‹ä¿¡æ¯' }}</span>
                        </p>
                    </div>

                    <!-- çº¿è·¯é€‰æ‹© -->
                    <div class="mb-4">
                        <div class="panel-title">
                            åˆ‡æ¢çº¿è·¯
                            <span v-if="isTestingSources" style="font-size: 12px; color: #888; font-weight: normal;">
                                <i class="fas fa-spinner fa-spin"></i> æ­£åœ¨æµ‹é€Ÿ...
                            </span>
                        </div>

                        <!-- æµ‹é€Ÿç±»å‹å›¾ä¾‹ -->
                        <div v-if="!isTestingSources && (fastSources.length > 0 || slowSources.length > 0)"
                            style="font-size: 11px; color: #666; margin-bottom: 10px; display: flex; gap: 15px; align-items: center;">
                            <span style="display: flex; align-items: center; gap: 4px;">
                                <span
                                    style="background: linear-gradient(135deg, #10b981, #059669); color: #fff; padding: 1px 5px; border-radius: 3px; font-size: 9px;">ç›´è¿</span>
                                ç”¨æˆ·ç«¯ç›´æ¥è®¿é—®
                            </span>
                            <span style="display: flex; align-items: center; gap: 4px;">
                                <span
                                    style="background: linear-gradient(135deg, #f59e0b, #d97706); color: #fff; padding: 1px 5px; border-radius: 3px; font-size: 9px;">ä¸­è½¬</span>
                                é€šè¿‡ä»£ç†è®¿é—®
                            </span>
                            <span style="display: flex; align-items: center; gap: 4px;">
                                <span
                                    style="background: linear-gradient(135deg, #6366f1, #4f46e5); color: #fff; padding: 1px 5px; border-radius: 3px; font-size: 9px;">æœåŠ¡</span>
                                æœåŠ¡å™¨ç«¯æµ‹é€Ÿ
                            </span>
                        </div>

                        <!-- å¿«é€Ÿçº¿è·¯åˆ—è¡¨ (< 600ms) -->
                        <div class="source-list" v-if="fastSources.length > 0 || slowSources.length > 0">
                            <!-- å¿«é€Ÿçº¿è·¯ -->
                            <div v-for="(source, index) in fastSources" class="source-pill"
                                :class="{ active: currentSource?.site_key === source.site_key }" :tabindex="10 + index"
                                @click="switchSource(source)" @keydown.enter="switchSource(source)">
                                <span>{{ source.site_name }}</span>
                                <span class="latency-dot" :class="getLatencyClass(source.latency)"></span>
                                <span style="font-size:10px; opacity:0.6;">{{source.latency}}ms</span>
                                <span v-if="source._testType === 'direct'"
                                    style="background: linear-gradient(135deg, #10b981, #059669); color: #fff; padding: 1px 5px; border-radius: 3px; font-size: 9px; margin-left: 4px;">
                                    ç›´è¿
                                </span>
                                <span v-else-if="source._testType === 'proxy'"
                                    style="background: linear-gradient(135deg, #f59e0b, #d97706); color: #fff; padding: 1px 5px; border-radius: 3px; font-size: 9px; margin-left: 4px;">
                                    ä¸­è½¬
                                </span>
                                <span v-else
                                    style="background: linear-gradient(135deg, #6366f1, #4f46e5); color: #fff; padding: 1px 5px; border-radius: 3px; font-size: 9px; margin-left: 4px;">
                                    æœåŠ¡
                                </span>
                            </div>
                            <!-- æ…¢é€Ÿçº¿è·¯åˆ†éš”ç¬¦ -->
                            <div v-if="slowSources.length > 0 && fastSources.length > 0"
                                style="width: 100%; font-size: 11px; color: #666; padding: 8px 0; border-top: 1px solid #333; margin-top: 5px;">
                                <i class="fas fa-hourglass-half"></i> è¾ƒæ…¢çº¿è·¯ ({{ slowSources.length }})
                            </div>
                            <!-- æ…¢é€Ÿçº¿è·¯ -->
                            <div v-for="(source, index) in slowSources" class="source-pill"
                                :class="{ active: currentSource?.site_key === source.site_key }" style="opacity: 0.7;"
                                :tabindex="100 + index" @click="switchSource(source)"
                                @keydown.enter="switchSource(source)">
                                <span>{{ source.site_name }}</span>
                                <span class="latency-dot" :class="getLatencyClass(source.latency)"></span>
                                <span style="font-size:10px; opacity:0.6;">{{source.latency}}ms</span>
                                <span v-if="source._testType === 'direct'"
                                    style="background: linear-gradient(135deg, #10b981, #059669); color: #fff; padding: 1px 5px; border-radius: 3px; font-size: 9px; margin-left: 4px;">
                                    ç›´è¿
                                </span>
                                <span v-else-if="source._testType === 'proxy'"
                                    style="background: linear-gradient(135deg, #f59e0b, #d97706); color: #fff; padding: 1px 5px; border-radius: 3px; font-size: 9px; margin-left: 4px;">
                                    ä¸­è½¬
                                </span>
                                <span v-else
                                    style="background: linear-gradient(135deg, #6366f1, #4f46e5); color: #fff; padding: 1px 5px; border-radius: 3px; font-size: 9px; margin-left: 4px;">
                                    æœåŠ¡
                                </span>
                            </div>
                        </div>

                        <!-- å…¨éƒ¨ä¸å¯ç”¨æç¤º -->
                        <div v-else-if="!isTestingSources && fastSources.length === 0 && slowSources.length === 0"
                            class="text-center py-4"
                            style="background: rgba(255,0,0,0.1); border-radius: 8px; border: 1px solid rgba(255,0,0,0.2);">
                            <i class="fas fa-exclamation-triangle text-warning" style="font-size: 24px;"></i>
                            <div class="mt-2" style="color: #ff6b6b;">æ‰€æœ‰é‡‡é›†ç«™å‡ä¸å¯ç”¨</div>
                            <div class="mt-1" style="font-size: 12px; color: #888;">è¯·ç¨åé‡è¯•æˆ–å°è¯•æœç´¢å…¶ä»–èµ„æº</div>
                        </div>
                    </div>

                    <!-- é€‰é›†åˆ—è¡¨ (å…¨å®½ç½‘æ ¼) -->
                    <div>
                        <div class="panel-title">é€‰é›†æ’­æ”¾</div>
                        <div v-if="loadingDetail" class="text-center py-5 text-muted"><i
                                class="fas fa-spinner fa-spin"></i>
                            åŠ è½½ä¸­...</div>
                        <div v-else class="ep-grid">
                            <div v-for="ep in episodeList" class="ep-btn" :class="{ active: currentUrl === ep.url }"
                                @click="play(ep.url)">
                                {{ ep.name }}
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <!-- Password Verification Script (runs before Vue) -->
    <script data-cfasync="false">
        // SHA256 Hash Function (Pure JS implementation)
        // SHA256 Hash Function (No longer used on client-side to avoid browser compat issues)
        // async function sha256(message) {
        //     const msgBuffer = new TextEncoder().encode(message);
        //     const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
        //     const hashArray = Array.from(new Uint8Array(hashBuffer));
        //     return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        // }

        // Storage Keys
        const AUTH_STORAGE_KEY = 'emax_auth_hash';
        const AUTH_EXPIRY_KEY = 'emax_auth_expiry';

        // Check if already authenticated
        function isAuthenticated() {
            const storedHash = localStorage.getItem(AUTH_STORAGE_KEY);
            const expiry = localStorage.getItem(AUTH_EXPIRY_KEY);

            if (!storedHash || !expiry) return false;

            // Check if expired
            if (Date.now() > parseInt(expiry)) {
                localStorage.removeItem(AUTH_STORAGE_KEY);
                localStorage.removeItem(AUTH_EXPIRY_KEY);
                return false;
            }

            return storedHash;
        }

        // Toggle password visibility
        function togglePasswordVisibility() {
            const input = document.getElementById('password-input');
            const eye = document.getElementById('password-eye');

            if (input.type === 'password') {
                input.type = 'text';
                eye.classList.remove('fa-eye');
                eye.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                eye.classList.remove('fa-eye-slash');
                eye.classList.add('fa-eye');
            }
        }

        // Show error message
        function showPasswordError(message) {
            const errorDiv = document.getElementById('password-error');
            const errorText = document.getElementById('password-error-text');
            errorText.textContent = message;
            errorDiv.style.display = 'flex';
        }

        // Handle password submit
        async function handlePasswordSubmit(event) {
            event.preventDefault();

            const input = document.getElementById('password-input');
            const submitBtn = document.getElementById('password-submit-btn');
            const remember = document.getElementById('remember-password').checked;
            const errorDiv = document.getElementById('password-error');

            // Hide previous error
            errorDiv.style.display = 'none';

            // Disable button
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>éªŒè¯ä¸­...</span>';

            try {
                // Skip client-side hashing to avoid browser compatibility issues
                // const passwordHash = await sha256(input.value);

                // Verify with server (send plain password)
                const res = await fetch('/api/auth/verify', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password: input.value })
                });

                const data = await res.json();

                if (data.success) {
                    // å§‹ç»ˆä¿å­˜ Token ç”¨äºåŒæ­¥åŠŸèƒ½
                    localStorage.setItem(AUTH_STORAGE_KEY, data.passwordHash);

                    // å¦‚æœå‹¾é€‰äº†"è®°ä½ç™»å½•"ï¼Œè®¾ç½®é•¿æœŸæœ‰æ•ˆæœŸ
                    if (remember) {
                        const expiry = Date.now() + (365 * 24 * 60 * 60 * 1000); // 365 days
                        localStorage.setItem(AUTH_EXPIRY_KEY, expiry.toString());
                    } else {
                        // ä¸è®°ä½ç™»å½•ï¼šè®¾ç½®ä¼šè¯æœ‰æ•ˆæœŸï¼ˆæµè§ˆå™¨å…³é—­åï¼‰- ä½¿ç”¨ sessionStorage æ ‡è®°
                        sessionStorage.setItem('emax_session_only', 'true');
                        // è®¾ç½®çŸ­æœŸæœ‰æ•ˆæœŸï¼ˆ1å¤©ï¼‰ï¼Œä¸‹æ¬¡æ‰“å¼€é¡µé¢æ—¶ä¼šé‡æ–°éªŒè¯
                        const expiry = Date.now() + (24 * 60 * 60 * 1000);
                        localStorage.setItem(AUTH_EXPIRY_KEY, expiry.toString());
                    }

                    // Start App and wait for data
                    if (window.startApp) {
                        await window.startApp();
                    }

                    // Hide password screen with animation
                    const screen = document.getElementById('password-screen');
                    screen.classList.add('hidden');

                    setTimeout(() => {
                        screen.style.display = 'none';
                    }, 500);
                } else {
                    showPasswordError('å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•');
                    input.value = '';
                    input.focus();
                }
            } catch (e) {
                showPasswordError('éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
                console.error('Auth error:', e);
            }

            // Re-enable button
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="fas fa-unlock"></i><span>éªŒè¯å¯†ç </span>';

            return false;
        }

        // Check auth status on page load
        async function checkAuthStatus() {
            try {
                const res = await fetch('/api/auth/check');
                const data = await res.json();

                if (!data.requirePassword) {
                    // No password required, start app directly
                    window.startApp && window.startApp();
                    return;
                }

                // Password required, check if already authenticated
                const storedHash = isAuthenticated();
                if (storedHash) {
                    // Verify stored hash is still valid
                    const verifyRes = await fetch('/api/auth/verify', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ passwordHash: storedHash })
                    });
                    const verifyData = await verifyRes.json();

                    if (verifyData.success) {
                        // Stored auth is valid, start app
                        window.startApp && window.startApp();
                        return;
                    } else {
                        // Stored auth is invalid, clear it
                        localStorage.removeItem(AUTH_STORAGE_KEY);
                        localStorage.removeItem(AUTH_EXPIRY_KEY);
                    }
                }

                // Show password screen
                const loader = document.getElementById('app-loader');
                const screen = document.getElementById('password-screen');

                // Hide loader, show password screen
                if (loader) loader.classList.add('hidden');
                screen.style.display = 'flex';

                // Focus input
                setTimeout(() => {
                    document.getElementById('password-input').focus();
                }, 100);

            } catch (e) {
                console.error('Auth check error:', e);
                // On error, try to start app anyway
                window.startApp && window.startApp();
            }
        }

        // Run check when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthStatus();
        });
    </script>

    <script data-cfasync="false">
        const { createApp, reactive } = Vue;
        // TMDb API é…ç½® (ä»æœåŠ¡ç«¯è·å–)
        let TMDB_API_KEY = "";

        // TMDb URL é…ç½® (ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨ç¼“å­˜åä»£)
        let TMDB_BASE_URL = "https://api.themoviedb.org/3";
        // ä½¿ç”¨æœ¬åœ° API ç¼“å­˜å›¾ç‰‡
        let TMDB_IMG_URL = "/api/tmdb-image/w342";
        let TMDB_BACKDROP_URL = "/api/tmdb-image/original";

        // TMDB åä»£é…ç½®ç°åœ¨é€šè¿‡ç¯å¢ƒå˜é‡ TMDB_PROXY_URL é…ç½®
        // è¯¦è§ .env.example å’Œ cloudflare-tmdb-proxy.js

        // å®¢æˆ·ç«¯å…¬ç½‘ IPï¼ˆç”¨äºå¸®åŠ©æœåŠ¡ç«¯åˆ¤æ–­æ˜¯å¦éœ€è¦ä»£ç†ï¼‰
        let clientPublicIP = null;

        /**
         * è·å–å®¢æˆ·ç«¯å…¬ç½‘ IP (ç”¨äºå†…ç½‘éƒ¨ç½²åœºæ™¯)
         * åœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨ä¸€æ¬¡ï¼Œç»“æœç¼“å­˜åˆ° clientPublicIP
         */
        async function fetchClientPublicIP() {
            try {
                const response = await fetch('https://api.ip.sb/ip', {
                    timeout: 5000,
                    cache: 'no-store'
                });
                if (response.ok) {
                    const ip = (await response.text()).trim();
                    if (ip && /^[\d\.]+$/.test(ip)) {  // ç®€å•æ ¡éªŒ IPv4 æ ¼å¼
                        clientPublicIP = ip;
                        console.log('[IP Detection] Client public IP:', ip);
                    }
                }
            } catch (e) {
                console.warn('[IP Detection] Failed to get public IP:', e.message);
                // å¤±è´¥ä¸é˜»å¡ï¼ŒæœåŠ¡ç«¯ä¼šæ ¹æ®ç§æœ‰ IP å›é€€å¤„ç†
            }
        }

        /**
         * TMDB ä¸“ç”¨ fetch åŒ…è£…å™¨ï¼Œè‡ªåŠ¨æ³¨å…¥ X-Client-Public-IP å¤´
         * @param {string} url - è¯·æ±‚ URL
         * @param {object} options - fetch é€‰é¡¹
         * @returns {Promise<Response>}
         */
        function tmdbFetch(url, options = {}) {
            const headers = new Headers(options.headers || {});
            if (clientPublicIP) {
                headers.set('X-Client-Public-IP', clientPublicIP);
            }
            return fetch(url, { ...options, headers });
        }

        // é¡µé¢åŠ è½½æ—¶è·å–å…¬ç½‘ IPï¼ˆåå°æ‰§è¡Œï¼Œä¸é˜»å¡ï¼‰
        fetchClientPublicIP();

        let dp = null;

        createApp({
            data() {
                return {
                    searchTimer: null,  // é˜²æŠ–æœç´¢å®šæ—¶å™¨
                    isTestingSources: false,  // æ­£åœ¨æµ‹é€ŸçŠ¶æ€
                    showInfoModal: false,  // ç”µå½±è¯¦æƒ…å¼¹çª—
                    infoModalData: null,   // å¼¹çª—æ•°æ®
                    TMDB_IMG_URL: TMDB_IMG_URL,  // æ¨¡æ¿ä¸­ä½¿ç”¨
                    TMDB_BACKDROP_URL: TMDB_BACKDROP_URL,

                    // æ¢å¤ç¼ºå¤±çš„çŠ¶æ€å˜é‡
                    keyword: '', loading: false, searched: false, rawList: [],
                    showDetail: false, currentGroup: null, currentSource: null,
                    episodeList: [], currentUrl: '', loadingDetail: false,
                    imageMap: {}, fallbackMap: {}, heroList: [], scrollY: 0,
                    hotList: [],
                    sitesMap: {},  // ç¼“å­˜ç«™ç‚¹ä¿¡æ¯ï¼ˆç”¨äºå®¢æˆ·ç«¯æµ‹é€Ÿï¼‰
                    corsProxyUrl: null,  // CORS ä»£ç† URLï¼ˆç”¨äºä¸­è½¬æ— æ³•ç›´æ¥è®¿é—®çš„èµ„æºç«™ APIï¼‰
                    playbackErrorCount: 0,  // æ’­æ”¾å¤±è´¥è®¡æ•°
                    isAutoRetrying: false,  // æ˜¯å¦æ­£åœ¨è‡ªåŠ¨é‡è¯•
                    autoRetryMessage: '',  // è‡ªåŠ¨åˆ‡æ¢æç¤ºä¿¡æ¯
                    watchHistory: [],  // ç”¨æˆ·è§‚çœ‹å†å²è®°å½•
                    wakeLock: null,  // Screen Wake Lock å¯¹è±¡ï¼ˆç”¨äºä¿æŒå±å¹•å¸¸äº®ï¼‰

                    // ğŸ›ï¸ ç”¨æˆ·åå¥½è®¾ç½®
                    showSettingsModal: false,  // è®¾ç½®å¼¹çª—æ˜¾ç¤ºçŠ¶æ€
                    hideRandomRow: (function () { try { return localStorage.getItem('donggua_hide_random') === 'true'; } catch (e) { return false; } })(),  // éšè—éšæœºç›²ç›’
                    filterNsfw: (function () { try { return localStorage.getItem('donggua_filter_nsfw') !== 'false'; } catch (e) { return true; } })(),  // è¿‡æ»¤ NSFW å†…å®¹ï¼ˆé»˜è®¤å¼€å¯ï¼‰

                    // ğŸ“± åŸç”Ÿ App æ£€æµ‹ (Capacitor)
                    isNativeApp: !!(window.Capacitor && window.Capacitor.isNativePlatform && window.Capacitor.isNativePlatform()),

                    // ğŸ“º TV æ¨¡å¼æ£€æµ‹
                    // åŸç”Ÿ App é»˜è®¤å¼€å¯ï¼Œç½‘é¡µç«¯æ™ºèƒ½æ£€æµ‹
                    isTVMode: (function () {
                        const isNative = !!(window.Capacitor && window.Capacitor.isNativePlatform && window.Capacitor.isNativePlatform());

                        // 1. æ£€æŸ¥ URL å‚æ•° ?tv=1 æˆ– ?tv=0 æ‰‹åŠ¨æ§åˆ¶
                        const urlParams = new URLSearchParams(window.location.search);
                        if (urlParams.get('tv') === '1') {
                            try { localStorage.setItem('force_tv_mode', '1'); } catch (e) { }
                            return true;
                        }
                        if (urlParams.get('tv') === '0') {
                            try { localStorage.setItem('force_tv_mode', '0'); } catch (e) { }
                            return false;
                        }

                        // 2. æ£€æŸ¥ localStorage è®°å¿†ï¼ˆç”¨æˆ·æ‰‹åŠ¨è®¾ç½®ï¼‰
                        try {
                            const saved = localStorage.getItem('force_tv_mode');
                            if (saved === '1') return true;
                            if (saved === '0') return false;
                        } catch (e) { }

                        // 3. åŸç”Ÿ App é»˜è®¤å¼€å¯ TV æ¨¡å¼
                        if (isNative) {
                            console.log('[TV æ£€æµ‹] âœ… åŸç”Ÿ Appï¼Œé»˜è®¤å¼€å¯ TV æ¨¡å¼');
                            return true;
                        }

                        // 4. ç½‘é¡µç«¯ï¼šæ™ºèƒ½ TV æµè§ˆå™¨ UA æ£€æµ‹
                        const ua = navigator.userAgent.toLowerCase();
                        const tvKeywords = [
                            'android tv', 'googletv',           // Android TV / Google TV
                            'aftt', 'aftm', 'aftb', 'firetv',   // Amazon Fire TV
                            'chromecast', 'sabrina', 'boreal',  // Chromecast with Google TV
                            'roku',                              // Roku
                            'smarttv', 'smart-tv',               // é€šç”¨ Smart TV
                            'tizen',                             // Samsung TV
                            'webos', 'web0s',                    // LG TV
                            'leanback'                           // Android TV Leanback
                        ];
                        const isTVUA = tvKeywords.some(k => ua.includes(k));

                        if (isTVUA) {
                            console.log('[TV æ£€æµ‹] âœ… æ£€æµ‹åˆ°æ™ºèƒ½ TV æµè§ˆå™¨:', ua.substring(0, 100));
                        }
                        return isTVUA;
                    })(),
                    historyExpanded: false,  // è§‚çœ‹å†å²å±•å¼€çŠ¶æ€
                    historyCanScrollLeft: false,  // å¯ä»¥å‘å·¦æ»šåŠ¨
                    historyCanScrollRight: false,  // å¯ä»¥å‘å³æ»šåŠ¨

                    // å†å²åŒæ­¥çŠ¶æ€
                    syncEnabled: false,  // æ˜¯å¦å¯ç”¨äº‘åŒæ­¥
                    syncStatus: 'idle',  // åŒæ­¥çŠ¶æ€: idle, syncing, success, error
                    syncToken: '',  // ç”¨æˆ·åŒæ­¥ Token (å¯†ç å“ˆå¸Œ)
                    lastSyncTime: 0,  // ä¸Šæ¬¡åŒæ­¥æ—¶é—´æˆ³
                    footerClickCount: 0,  // ç”¨äºéšè”½é€€å‡ºç™»å½•çš„ç‚¹å‡»è®¡æ•°

                    rowLeftButtons: {}, // å­˜å‚¨å„åˆ†ç±»æ¦œå•å·¦ä¾§æŒ‰é’®æ˜¾ç¤ºçŠ¶æ€ { movieRow: false, ... }

                    // === åŠ¨æ€æ¦œå•é…ç½® ===
                    rowLists: {}, // å­˜å‚¨å„æ¦œå•æ•°æ® { movieRow: [...], ... }
                    expandedRows: {}, // å­˜å‚¨å„æ¦œå•çš„å±•å¼€çŠ¶æ€ { movieRow: true, ... }
                    viewPages: {}, // å­˜å‚¨å„æ¦œå•å±•å¼€æ—¶çš„æŸ¥çœ‹é¡µç  { movieRow: 1, ... }
                    pageLoadingKeys: {}, // é˜²æ­¢é‡å¤å¿«é€Ÿç‚¹å‡»åŠ è½½ { movieRow: true, ... }
                    rowConfigs: {
                        randomRow: { title: 'éšæœºç›²ç›’Â·æƒŠå–œå‘ˆç°', icon: 'fa-random', path: 'MIXED', params: '', page: 1 },
                        movieRow: { title: 'å…¨çƒéœ‡æ„ŸÂ·ç”µå½±æ¦œ', icon: 'fa-film', path: '/trending/movie/week', params: '', page: 1 },
                        tvRow: { title: 'å…¨çƒå¿…è¿½Â·å‰§é›†æ¦œ', icon: 'fa-tv', path: '/trending/tv/week', params: '', page: 1 },
                        cnRow: { title: 'åè¯­å¼ºæ¡£Â·å›½äº§å‰§', icon: 'fa-dragon', path: '/discover/tv', params: 'with_origin_country=CN', page: 1, sortMode: 'newest' },
                        usRow: { title: 'ç¾å‰§Â·é«˜èƒ½å‰§é›†', icon: 'fa-flag-usa', path: '/discover/tv', params: 'with_origin_country=US', page: 1, sortMode: 'newest' },
                        krjpRow: { title: 'æ—¥éŸ©æ½®æµÂ·å‰§é›†', icon: 'fa-mask', path: '/discover/tv', params: 'with_origin_country=KR|JP', page: 1, sortMode: 'newest' },
                        animeRow: { title: 'äºŒæ¬¡å…ƒÂ·åŠ¨æ¼«ç•ªå‰§', icon: 'fa-ghost', path: '/discover/tv', params: 'with_genres=16', page: 1, sortMode: 'newest' },
                        scifiRow: { title: 'ç§‘å¹»å¥‡å¹»Â·æ˜Ÿé™…ç©¿è¶Š', icon: 'fa-rocket', path: '/discover/movie', params: 'with_genres=878,14', page: 1, sortMode: 'newest' },
                        actionRow: { title: 'åŠ¨ä½œå¤§ç‰‡Â·è‚¾ä¸Šè…ºç´ ', icon: 'fa-bomb', path: '/discover/movie', params: 'with_genres=28', page: 1, sortMode: 'newest' },
                        comedyRow: { title: 'å¼€å¿ƒå–œå‰§Â·è§£å‹å¿…å¤‡', icon: 'fa-laugh-squint', path: '/discover/movie', params: 'with_genres=35', page: 1, sortMode: 'newest' },
                        crimeRow: { title: 'çŠ¯ç½ªæ‚¬ç–‘Â·çƒ§è„‘ç¥ä½œ', icon: 'fa-user-secret', path: '/discover/movie', params: 'with_genres=80,9648', page: 1, sortMode: 'newest' },
                        romanceRow: { title: 'çˆ±æƒ…Â·æµªæ¼«æ»¡å±‹', icon: 'fa-heart', path: '/discover/movie', params: 'with_genres=10749', page: 1, sortMode: 'newest' },
                        familyRow: { title: 'åˆå®¶æ¬¢Â·æ¸©é¦¨æ—¶åˆ»', icon: 'fa-home', path: '/discover/movie', params: 'with_genres=10751', page: 1, sortMode: 'newest' },
                        docRow: { title: 'çºªå½•ç‰‡Â·æ¢ç´¢ä¸–ç•Œ', icon: 'fa-video', path: '/discover/movie', params: 'with_genres=99', page: 1, sortMode: 'newest' },
                        warRow: { title: 'æˆ˜äº‰Â·å²è¯—å·¨åˆ¶', icon: 'fa-fighter-jet', path: '/discover/movie', params: 'with_genres=10752', page: 1, sortMode: 'newest' },
                        horrorRow: { title: 'ææ€–æƒŠæ‚šÂ·èƒ†å°å‹¿å…¥', icon: 'fa-skull', path: '/discover/movie', params: 'with_genres=27', page: 1, sortMode: 'newest' },
                        mysteryRow: { title: 'çƒ§è„‘æ‚¬ç–‘Â·å±‚å±‚åè½¬', icon: 'fa-search', path: '/discover/movie', params: 'with_genres=9648', page: 1, sortMode: 'newest' },
                        fantasyRow: { title: 'å¥‡å¹»å†’é™©Â·å¼‚æƒ³å¤©å¼€', icon: 'fa-hat-wizard', path: '/discover/movie', params: 'with_genres=14', page: 1, sortMode: 'newest' },
                        varietyRow: { title: 'çƒ­é—¨ç»¼è‰ºÂ·å¨±ä¹ç”Ÿæ´»', icon: 'fa-microphone-alt', path: '/discover/tv', params: 'with_genres=10764', page: 1, sortMode: 'newest' },
                        historyRow: { title: 'å†å²Â·å²æœˆé•¿æ²³', icon: 'fa-landmark', path: '/discover/movie', params: 'with_genres=36', page: 1, sortMode: 'newest' },
                    },

                    movieList: [], tvList: [], list_cn: [], list_krjp: [],
                    list_scifi: [], list_action: [], list_comedy: [], list_horror: [],
                    categories: [
                        // æŒ‰ rowConfigs é¡ºåºæ’åˆ—ï¼ˆrandomRow ä¸åœ¨åˆ†ç±»ä¸­ï¼‰
                        { name: 'ç”µå½±', icon: 'fa-film', action: 'scroll', value: 'movieRow', color: 'linear-gradient(135deg, #FF512F 0%, #DD2476 100%)' },
                        { name: 'å‰§é›†', icon: 'fa-tv', action: 'scroll', value: 'tvRow', color: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)' },
                        { name: 'å›½äº§', icon: 'fa-dragon', action: 'scroll', value: 'cnRow', color: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' },
                        { name: 'ç¾å‰§', icon: 'fa-flag-usa', action: 'scroll', value: 'usRow', color: 'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)' },
                        { name: 'æ—¥éŸ©', icon: 'fa-mask', action: 'scroll', value: 'krjpRow', color: 'linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%)' },
                        { name: 'åŠ¨æ¼«', icon: 'fa-ghost', action: 'scroll', value: 'animeRow', color: 'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)' },
                        { name: 'ç§‘å¹»', icon: 'fa-rocket', action: 'scroll', value: 'scifiRow', color: 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)' },
                        { name: 'åŠ¨ä½œ', icon: 'fa-bomb', action: 'scroll', value: 'actionRow', color: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)' },
                        { name: 'å–œå‰§', icon: 'fa-laugh-squint', action: 'scroll', value: 'comedyRow', color: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)' },
                        { name: 'çŠ¯ç½ª', icon: 'fa-user-secret', action: 'scroll', value: 'crimeRow', color: 'linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%)' },
                        { name: 'çˆ±æƒ…', icon: 'fa-heart', action: 'scroll', value: 'romanceRow', color: 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)' },
                        { name: 'å®¶åº­', icon: 'fa-home', action: 'scroll', value: 'familyRow', color: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)' },
                        { name: 'çºªå½•', icon: 'fa-video', action: 'scroll', value: 'docRow', color: 'linear-gradient(135deg, #fff1eb 0%, #ace0f9 100%)' },
                        { name: 'æˆ˜äº‰', icon: 'fa-fighter-jet', action: 'scroll', value: 'warRow', color: 'linear-gradient(135deg, #ff0844 0%, #ffb199 100%)' },
                        { name: 'ææ€–', icon: 'fa-skull', action: 'scroll', value: 'horrorRow', color: 'linear-gradient(135deg, #434343 0%, #000000 100%)' },
                        { name: 'æ‚¬ç–‘', icon: 'fa-search', action: 'scroll', value: 'mysteryRow', color: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' },
                        { name: 'å¥‡å¹»', icon: 'fa-hat-wizard', action: 'scroll', value: 'fantasyRow', color: 'linear-gradient(135deg, #fccb90 0%, #d57eeb 100%)' },
                        { name: 'ç»¼è‰º', icon: 'fa-microphone-alt', action: 'scroll', value: 'varietyRow', color: 'linear-gradient(135deg, #d299c2 0%, #fef9d7 100%)' },
                        { name: 'å†å²', icon: 'fa-landmark', action: 'scroll', value: 'historyRow', color: 'linear-gradient(135deg, #accbee 0%, #e7f0fd 100%)' }
                    ]
                }
            },
            async mounted() {
                console.log('[VERSION] DongguaTV Code Version: 2024-12-19-v2 (showMovieInfo exists)');
                console.log('[VERSION] Methods available:', Object.keys(this.$options.methods || {}).join(', '));

                // ğŸ“º TV æ¨¡å¼è®¾ç½®
                if (this.isTVMode) {
                    // æ·»åŠ  TV æ¨¡å¼ class ä»¥åº”ç”¨ä¸“ç”¨æ ·å¼
                    document.body.classList.add('tv-mode');
                }

                // æ€§èƒ½ä¼˜åŒ–ï¼šä½¿ç”¨ passive æ»šåŠ¨ç›‘å¬ + èŠ‚æµ
                let scrollTicking = false;
                window.addEventListener('scroll', () => {
                    if (!scrollTicking) {
                        requestAnimationFrame(() => {
                            this.scrollY = window.scrollY;
                            scrollTicking = false;
                        });
                        scrollTicking = true;
                    }
                }, { passive: true });

                // æ€§èƒ½ä¼˜åŒ–ï¼šresize äº‹ä»¶èŠ‚æµ
                let resizeTimeout;
                window.addEventListener('resize', () => {
                    clearTimeout(resizeTimeout);
                    resizeTimeout = setTimeout(() => {
                        this.updateHistoryScrollNeeded();
                    }, 150);
                }, { passive: true });

                // ä¿®å¤ï¼šç‚¹å‡»ä»»æ„åœ°æ–¹å…³é—­ DPlayer å³é”®èœå•
                document.addEventListener('click', (e) => {
                    const menu = document.querySelector('.dplayer-menu');
                    if (menu && menu.classList.contains('dplayer-menu-show')) {
                        // å¦‚æœç‚¹å‡»çš„ä¸æ˜¯èœå•å†…éƒ¨ï¼Œåˆ™å…³é—­èœå•
                        if (!menu.contains(e.target)) {
                            menu.classList.remove('dplayer-menu-show');
                        }
                    }
                });

                // ğŸ“º TV é¥æ§å™¨é”®ç›˜æ§åˆ¶ - ä½¿ç”¨ window çº§åˆ«æ•è·
                const self = this;
                window.addEventListener('keydown', function (e) {
                    // TV æ¨¡å¼å…¨å±€è¿”å›é”®å¤„ç†
                    if (self.isTVMode && (e.key === 'Escape' || e.key === 'Backspace')) {
                        // æ£€æŸ¥æ˜¯å¦æœ‰å¼¹çª—
                        const popup = document.getElementById('tv-episode-popup');
                        if (popup) {
                            e.preventDefault();
                            popup.remove();
                            const epBtn = document.getElementById('tv-select-episode');
                            if (epBtn) epBtn.focus();
                            return false;
                        }

                        // å¦‚æœåœ¨æ’­æ”¾é¡µé¢ï¼Œå…³é—­æ’­æ”¾é¡µé¢
                        if (self.showDetail) {
                            e.preventDefault();
                            self.closeDetail();
                            return false;
                        }

                        // å¦‚æœåœ¨æœç´¢é¡µé¢ï¼Œè¿”å›é¦–é¡µ
                        if (self.searched) {
                            e.preventDefault();
                            self.goHome();
                            return false;
                        }

                        // åœ¨é¦–é¡µï¼šä¸æ‹¦æˆªè¿”å›é”®ï¼Œè®©ç³»ç»Ÿå¤„ç†ï¼ˆé€€å‡º APPï¼‰
                        // ä¸è°ƒç”¨ e.preventDefault()ï¼Œè®©äº‹ä»¶ä¼ é€’ç»™ Android
                    }

                    // å…¶ä»–æ§åˆ¶åªåœ¨æ’­æ”¾é¡µé¢ + TV æ¨¡å¼ç”Ÿæ•ˆ
                    if (!self.showDetail || !self.isTVMode) return;

                    // è·å–å½“å‰ç„¦ç‚¹å…ƒç´ 
                    const activeEl = document.activeElement;
                    const isPlayBtn = activeEl && activeEl.classList.contains('dplayer-play-icon');
                    const isProgressBar = activeEl && (activeEl.classList.contains('dplayer-bar') || activeEl.closest('.dplayer-bar'));

                    switch (e.key) {
                        case 'Enter':
                        case ' ':
                            // åªåœ¨ç„¦ç‚¹åœ¨æ’­æ”¾æŒ‰é’®æ—¶æ‰æš‚åœ/æ’­æ”¾
                            if (isPlayBtn && dp && dp.video) {
                                e.preventDefault();
                                e.stopImmediatePropagation();
                                dp.toggle();
                                dp.notice(dp.video.paused ? 'â¸ å·²æš‚åœ' : 'â–¶ æ’­æ”¾ä¸­');
                                return false;
                            }
                            // å…¶ä»–æŒ‰é’®è®©å®ƒä»¬è‡ªå·±å¤„ç†ç‚¹å‡»
                            break;
                        case 'ArrowDown':
                            // ä»é¡¶éƒ¨æŒ‰é’®è·³åˆ°åº•éƒ¨æ§åˆ¶æ 
                            const isTopBtn = activeEl && (activeEl.id === 'tv-back' || activeEl.id === 'tv-select-episode' || activeEl.id === 'tv-switch-source' || activeEl.id === 'tv-play-pause');
                            if (isTopBtn) {
                                e.preventDefault();
                                e.stopImmediatePropagation();
                                const bottomPlayBtn = document.getElementById('tv-bottom-play');
                                if (bottomPlayBtn) {
                                    bottomPlayBtn.focus();
                                    if (dp) dp.notice('â–¶ åº•éƒ¨æ§åˆ¶æ ');
                                }
                                return false;
                            }
                            break;
                        case 'ArrowUp':
                            // ä»åº•éƒ¨æ§åˆ¶æ è·³åˆ°é¡¶éƒ¨æŒ‰é’®
                            const isBottomBtn = activeEl && (activeEl.id === 'tv-bottom-play' || activeEl.id === 'tv-rewind' || activeEl.id === 'tv-forward' || activeEl.id === 'tv-speed');
                            if (isBottomBtn || (activeEl && activeEl.classList.contains('dplayer-icon'))) {
                                e.preventDefault();
                                e.stopImmediatePropagation();
                                const playPauseBtn = document.getElementById('tv-play-pause');
                                if (playPauseBtn) {
                                    playPauseBtn.focus();
                                    if (dp) dp.notice('â¸ é¡¶éƒ¨æ§åˆ¶æ ');
                                }
                                return false;
                            }
                            break;
                        case 'ArrowLeft':
                            // åªåœ¨ç„¦ç‚¹åœ¨è¿›åº¦æ¡æ—¶æ‰å¿«é€€
                            if (isProgressBar && dp && dp.video) {
                                e.preventDefault();
                                e.stopImmediatePropagation();
                                dp.video.currentTime = Math.max(0, dp.video.currentTime - 10);
                                dp.notice('âª å¿«é€€ 10 ç§’');
                                return false;
                            }
                            // å¦åˆ™è®©ç„¦ç‚¹ç§»åŠ¨
                            break;
                        case 'ArrowRight':
                            // åªåœ¨ç„¦ç‚¹åœ¨è¿›åº¦æ¡æ—¶æ‰å¿«è¿›
                            if (isProgressBar && dp && dp.video) {
                                e.preventDefault();
                                e.stopImmediatePropagation();
                                dp.video.currentTime = Math.min(dp.video.duration || 0, dp.video.currentTime + 10);
                                dp.notice('â© å¿«è¿› 10 ç§’');
                                return false;
                            }
                            // å¦åˆ™è®©ç„¦ç‚¹ç§»åŠ¨
                            break;
                        case 'AudioVolumeUp':
                            // é¥æ§å™¨éŸ³é‡+
                            if (dp && dp.video) {
                                e.preventDefault();
                                dp.video.volume = Math.min(1, dp.video.volume + 0.1);
                                dp.notice('ğŸ”Š éŸ³é‡: ' + Math.round(dp.video.volume * 100) + '%');
                                return false;
                            }
                            break;
                        case 'AudioVolumeDown':
                            // é¥æ§å™¨éŸ³é‡-
                            if (dp && dp.video) {
                                e.preventDefault();
                                dp.video.volume = Math.max(0, dp.video.volume - 0.1);
                                dp.notice('ğŸ”‰ éŸ³é‡: ' + Math.round(dp.video.volume * 100) + '%');
                                return false;
                            }
                            break;
                        case 'Escape':
                        case 'Backspace':
                            e.preventDefault();
                            // å…ˆæ£€æŸ¥æ˜¯å¦æœ‰é€‰é›†å¼¹çª—ï¼Œå¦‚æœæœ‰å°±å…³é—­å¼¹çª—
                            const popup = document.getElementById('tv-episode-popup');
                            if (popup) {
                                popup.remove();
                                // æ¢å¤ç„¦ç‚¹åˆ°é€‰é›†æŒ‰é’®
                                const epBtn = document.getElementById('tv-select-episode');
                                if (epBtn) epBtn.focus();
                            } else {
                                // å¦åˆ™å…³é—­æ’­æ”¾é¡µé¢
                                self.closeDetail();
                            }
                            return false;
                    }
                }, true);  // æ•è·é˜¶æ®µ

                // Store reference to app instance for external access
                window.vueApp = this;

                // å®šä¹‰ startApp å‡½æ•°ä¾›å¯†ç éªŒè¯æˆåŠŸåè°ƒç”¨
                window.startApp = () => {
                    // ç¡®ä¿é¡µé¢æ»šåŠ¨åˆ°é¡¶éƒ¨
                    window.scrollTo(0, 0);
                    return this.initApp();
                };
            },
            computed: {
                groupedList() {
                    const groups = {};
                    this.rawList.forEach(item => {
                        const name = item.vod_name;
                        if (!groups[name]) groups[name] = { name: name, pic: item.vod_pic, sources: [] };
                        const isDefault = (url) => !url || url.includes('mac_default') || url.includes('nopic');
                        if (isDefault(groups[name].pic) && !isDefault(item.vod_pic)) groups[name].pic = item.vod_pic;
                        if (isDefault(groups[name].pic)) this.handleImgError(name);

                        groups[name].sources.push({
                            ...item,
                            latency: item.latency || 999
                        });
                    });
                    return Object.values(groups).sort((a, b) => b.sources.length - a.sources.length);
                },
                // å¿«é€Ÿçº¿è·¯ (å»¶è¿Ÿ < 600ms)
                fastSources() {
                    if (!this.currentGroup || !this.currentGroup.sources) return [];
                    return this.currentGroup.sources.filter(s => {
                        if (s.latency === '...') return false;
                        return typeof s.latency === 'number' && s.latency < 600;
                    });
                },
                // æ…¢é€Ÿçº¿è·¯ (600ms <= å»¶è¿Ÿ < 9000msï¼Œéè¶…æ—¶)
                slowSources() {
                    if (!this.currentGroup || !this.currentGroup.sources) return [];
                    return this.currentGroup.sources.filter(s => {
                        if (s.latency === '...') return false;
                        return typeof s.latency === 'number' && s.latency >= 600 && s.latency < 9000;
                    });
                },
                // å…¼å®¹æ—§ä»£ç çš„ availableSourcesï¼ˆåŒ…å«å¿«é€Ÿå’Œæ…¢é€Ÿï¼‰
                availableSources() {
                    return [...this.fastSources, ...this.slowSources];
                }
            },
            methods: {
                async initApp() {
                    // é˜²æ­¢é‡å¤åˆå§‹åŒ–
                    if (this._appInitialized) return;
                    this._appInitialized = true;

                    // çŠ¶æ€æ›´æ–°å‡½æ•°
                    const updateStatus = (text) => {
                        const el = document.getElementById('loader-status');
                        if (el) el.textContent = text;
                    };

                    // 1. è·å–åç«¯é…ç½®
                    updateStatus('æ­£åœ¨è¿æ¥æœåŠ¡å™¨...');
                    try {
                        const res = await fetch('/api/config');
                        const config = await res.json();
                        TMDB_API_KEY = config.tmdb_api_key;

                        // ä¿å­˜ CORS ä»£ç† URLï¼ˆç”¨äºèµ„æºç«™ API ä¸­è½¬ï¼‰
                        if (config.cors_proxy_url) {
                            this.corsProxyUrl = config.cors_proxy_url;
                            console.log('[Config] CORS ä»£ç†å·²é…ç½®:', config.cors_proxy_url);
                        }

                        // Vercel å…¼å®¹æ€§æ£€æµ‹
                        if (config.enable_local_image_cache === false) {
                            console.log('[Config] Vercel ç¯å¢ƒæ£€æµ‹ï¼šç¦ç”¨æœ¬åœ°å›¾ç‰‡ç¼“å­˜ï¼Œä½¿ç”¨å®˜æ–¹æº');
                            // å›é€€åˆ°å®˜æ–¹ CDN
                            this.TMDB_IMG_URL = "https://image.tmdb.org/t/p/w342";
                            this.TMDB_BACKDROP_URL = "https://image.tmdb.org/t/p/original";
                        }

                        // å¦‚æœé…ç½®äº†åä»£åœ°å€ï¼Œè¿›è¡Œ IP æ£€æµ‹å¹¶åˆ‡æ¢
                        if (config.tmdb_proxy_url) {
                            updateStatus('æ­£åœ¨æ£€æµ‹ç½‘ç»œç¯å¢ƒ...');
                            await this.setupTmdbProxy(config.tmdb_proxy_url);
                        }
                    } catch (e) {
                        console.error('Config Load Error:', e);
                        updateStatus('âš ï¸ æœåŠ¡å™¨è¿æ¥å¤±è´¥');
                    }

                    // 2. å¦‚æœè·å–åˆ°äº† Keyï¼ŒåŠ è½½æ•°æ®
                    if (TMDB_API_KEY) {
                        updateStatus('æ­£åœ¨åŠ è½½é¦–é¡µå†…å®¹...');
                        try {
                            await this.fetchHero();
                        } catch (e) {
                            console.error('[InitApp] Hero åŠ è½½å¤±è´¥:', e);
                        }
                        try {
                            this.fetchAllLists();
                        } catch (e) {
                            console.error('[InitApp] Lists åŠ è½½å¤±è´¥:', e);
                        }
                    } else {
                        console.warn('TMDB_API_KEY æœªé…ç½®');
                        updateStatus('âš ï¸ API æœªé…ç½®');
                    }

                    // 3. ç§»é™¤ Loading é®ç½© (å¹³æ»‘è¿‡æ¸¡)
                    updateStatus('åŠ è½½å®Œæˆ');
                    setTimeout(() => {
                        const loader = document.getElementById('app-loader');
                        if (loader) loader.classList.add('hidden');
                    }, 300);

                    // 4. åŠ è½½ç«™ç‚¹ä¿¡æ¯ï¼ˆç”¨äºå®¢æˆ·ç«¯æµ‹é€Ÿï¼‰
                    try {
                        const sitesRes = await fetch('/api/sites');
                        const sitesData = await sitesRes.json();
                        if (sitesData.sites) {
                            sitesData.sites.forEach(site => {
                                this.sitesMap[site.key] = site;
                            });
                        }
                    } catch (e) {
                        console.error('Sites Load Error:', e);
                    }

                    // 5. åŠ è½½è§‚çœ‹å†å²
                    this.loadWatchHistory();
                },

                // ========== ğŸ“º è§‚çœ‹å†å²åŠŸèƒ½ ==========
                // åŠ è½½è§‚çœ‹å†å²
                loadWatchHistory() {
                    try {
                        const saved = localStorage.getItem('donggua_watch_history');
                        if (saved) {
                            const history = JSON.parse(saved);
                            // è¿‡æ»¤æ‰è¶…è¿‡30å¤©çš„è®°å½•
                            const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
                            this.watchHistory = history.filter(item =>
                                new Date(item.watchedAt).getTime() > thirtyDaysAgo
                            );

                            // ç¡®ä¿ä¸è¶…è¿‡30æ¡
                            if (this.watchHistory.length > 30) {
                                this.watchHistory = this.watchHistory.slice(0, 30);
                            }

                            // å¦‚æœæœ‰è¿‡æ»¤ï¼Œæ›´æ–°å­˜å‚¨
                            if (this.watchHistory.length !== history.length) {
                                this.saveWatchHistoryToStorage();
                            }
                            console.log('[è§‚çœ‹å†å²] å·²åŠ è½½', this.watchHistory.length, 'æ¡è®°å½•');
                            this.$nextTick(() => this.updateHistoryScrollNeeded());
                        }
                    } catch (e) {
                        console.error('[è§‚çœ‹å†å²] åŠ è½½å¤±è´¥:', e);
                    }
                    // åŒæ—¶æ¸…ç†è¿‡æœŸçš„è¿›åº¦è®°å½•
                    this.cleanUpOldProgress();

                    // åˆå§‹åŒ–äº‘åŒæ­¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰
                    this.initHistorySync();
                },

                // æ¸…ç†è¿‡æœŸçš„è¿›åº¦è®°å¿†ï¼ˆè¶…è¿‡30å¤©ï¼‰
                cleanUpOldProgress() {
                    const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
                    const keysToRemove = [];

                    try {
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            if (key && key.startsWith('donggua_progress_')) {
                                try {
                                    const value = localStorage.getItem(key);
                                    if (value) {
                                        const data = JSON.parse(value);
                                        if (data && data.date) {
                                            const savedDate = new Date(data.date).getTime();
                                            if (savedDate < thirtyDaysAgo) {
                                                keysToRemove.push(key);
                                            }
                                        } else {
                                            keysToRemove.push(key); // æ ¼å¼ä¸å¯¹ä¹Ÿæ¸…ç†
                                        }
                                    }
                                } catch (e) {
                                    keysToRemove.push(key); // è§£æå¤±è´¥ä¹Ÿæ¸…ç†
                                }
                            }
                        }

                        if (keysToRemove.length > 0) {
                            console.log('[æ¸…ç†] åˆ é™¤è¿‡æœŸè¿›åº¦è®°å½•:', keysToRemove.length, 'æ¡');
                            keysToRemove.forEach(key => localStorage.removeItem(key));
                        }
                    } catch (e) {
                        console.error('[æ¸…ç†] è¿›åº¦æ¸…ç†å¤±è´¥:', e);
                    }
                },

                // ä¿å­˜è§‚çœ‹å†å²åˆ° localStorageï¼ˆå¹¶åŒæ­¥åˆ°äº‘ç«¯ï¼‰
                saveWatchHistoryToStorage() {
                    try {
                        localStorage.setItem('donggua_watch_history', JSON.stringify(this.watchHistory));

                        // å¦‚æœå¯ç”¨äº†åŒæ­¥ï¼Œæ¨é€åˆ°æœåŠ¡å™¨
                        if (this.syncEnabled && this.syncToken) {
                            this.pushHistoryToServer();
                        }
                    } catch (e) {
                        console.error('[è§‚çœ‹å†å²] ä¿å­˜å¤±è´¥:', e);
                    }
                },

                // ========== ğŸ“¡ å†å²åŒæ­¥åŠŸèƒ½ ==========

                // åˆå§‹åŒ–åŒæ­¥çŠ¶æ€
                async initHistorySync() {
                    // ä» localStorage è·å–åŒæ­¥ Token (ä¸å¯†ç éªŒè¯ä½¿ç”¨ç›¸åŒçš„ key)
                    const storedToken = localStorage.getItem('emax_auth_hash');
                    if (storedToken) {
                        this.syncToken = storedToken;

                        // æ£€æŸ¥æ­¤ Token æ˜¯å¦å¯ç”¨åŒæ­¥
                        try {
                            const res = await fetch(`/api/config?token=${storedToken}`);
                            const data = await res.json();
                            this.syncEnabled = data.sync_enabled || false;

                            if (this.syncEnabled) {
                                // å¯ç”¨åŒæ­¥ï¼Œæ‰§è¡Œé¦–æ¬¡åŒæ­¥
                                await this.syncHistory();
                            }
                        } catch (e) {
                            console.error('[åŒæ­¥] æ£€æŸ¥åŒæ­¥çŠ¶æ€å¤±è´¥:', e);
                        }
                    }
                },

                // æ‹‰å–æœåŠ¡å™¨å†å²ï¼ˆæœåŠ¡å™¨ä¼˜å…ˆæ¨¡å¼ï¼‰
                // å¤šè®¾å¤‡åŒæ­¥åœºæ™¯ï¼šæœåŠ¡å™¨æ•°æ®ä½œä¸º source of truthï¼Œç›´æ¥è¦†ç›–æœ¬åœ°
                async pullAndMergeHistory() {
                    if (!this.syncEnabled || !this.syncToken) return;

                    try {
                        const res = await fetch(`/api/history/pull?token=${this.syncToken}`);
                        const data = await res.json();

                        if (!data.sync_enabled || !data.history) return;

                        const serverHistory = data.history;

                        console.log('[åŒæ­¥] æœåŠ¡å™¨ä¼˜å…ˆæ¨¡å¼ - æœåŠ¡å™¨å†å²:', serverHistory.length, 'æœ¬åœ°å†å²:', this.watchHistory.length);

                        // ğŸ”„ æœåŠ¡å™¨ä¼˜å…ˆç­–ç•¥ï¼šæœåŠ¡å™¨æ•°æ®ç›´æ¥è¦†ç›–æœ¬åœ°
                        // å°†æœåŠ¡å™¨å†å²è½¬æ¢ä¸ºæœ¬åœ°æ ¼å¼
                        const newHistory = serverHistory.map(serverItem => serverItem.data);

                        // ğŸ’¡ ä¼˜åŒ–ï¼šæœ¬åœ°ç‹¬æœ‰çš„è®°å½•ï¼ˆæœåŠ¡å™¨ä¸Šæ²¡æœ‰çš„ï¼‰éœ€è¦ä¿ç•™
                        // è¿™é€šå¸¸æ˜¯åˆšæ·»åŠ è¿˜æ²¡æ¥å¾—åŠæ¨é€çš„è®°å½•
                        const serverNames = new Set(serverHistory.map(item => item.data.name));
                        const localOnlyItems = this.watchHistory.filter(item => !serverNames.has(item.name));

                        if (localOnlyItems.length > 0) {
                            console.log('[åŒæ­¥] ä¿ç•™æœ¬åœ°ç‹¬æœ‰è®°å½•:', localOnlyItems.length, 'æ¡');
                            localOnlyItems.forEach(item => newHistory.push(item));
                        }

                        // æŒ‰æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
                        newHistory.sort((a, b) =>
                            new Date(b.watchedAt).getTime() - new Date(a.watchedAt).getTime()
                        );

                        // é™åˆ¶æœ€å¤§æ¡æ•°
                        if (newHistory.length > 50) {
                            newHistory.length = 50;
                        }

                        // æ£€æµ‹æ˜¯å¦æœ‰å˜åŒ–
                        const hasChanges = JSON.stringify(this.watchHistory) !== JSON.stringify(newHistory);

                        if (hasChanges) {
                            console.log('[åŒæ­¥] æœåŠ¡å™¨æ•°æ®å·²åŒæ­¥åˆ°æœ¬åœ°ï¼Œå…±', newHistory.length, 'æ¡è®°å½•');
                            this.watchHistory = newHistory;
                        } else {
                            console.log('[åŒæ­¥] æœ¬åœ°æ•°æ®ä¸æœåŠ¡å™¨ä¸€è‡´ï¼Œæ— éœ€æ›´æ–°');
                        }

                        // ä¿å­˜åˆ°æœ¬åœ°ï¼ˆä¸è§¦å‘å†æ¬¡æ¨é€ï¼‰
                        if (hasChanges) {
                            localStorage.setItem('donggua_watch_history', JSON.stringify(this.watchHistory));

                            // åŒæ­¥ç²¾ç¡®æ’­æ”¾è¿›åº¦åˆ°æœ¬åœ° localStorage
                            // è¿™æ ·æ’­æ”¾å™¨èƒ½æ¢å¤åˆ°æ­£ç¡®ä½ç½®ï¼ˆæœåŠ¡å™¨ä¼˜å…ˆæ¨¡å¼ï¼šç›´æ¥è¦†ç›–æœ¬åœ°è¿›åº¦ï¼‰
                            this.watchHistory.forEach(item => {
                                if (item.progressTime && item.progressTime > 60) {
                                    // ç”Ÿæˆè¿›åº¦å­˜å‚¨ key
                                    const name = item.groupData?.name || item.name;
                                    const combined = (name + '_' + (item.episode || '')).replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_');
                                    const key = 'donggua_progress_' + combined.substring(0, 80);

                                    // æœåŠ¡å™¨ä¼˜å…ˆï¼šç›´æ¥ç”¨æœåŠ¡å™¨æ•°æ®è¦†ç›–æœ¬åœ°è¿›åº¦
                                    localStorage.setItem(key, JSON.stringify({
                                        time: item.progressTime,
                                        date: item.watchedAt
                                    }));
                                }
                            });
                        }
                    } catch (e) {
                        console.error('[åŒæ­¥] æ‹‰å–å†å²å¤±è´¥:', e);
                    }
                },

                // æ¨é€å†å²åˆ°æœåŠ¡å™¨ï¼ˆå¸¦ 1 åˆ†é’Ÿé˜²æŠ–ï¼‰
                _pushDebounceTimer: null,
                _lastPushTime: 0,

                pushHistoryToServer(immediate = false) {
                    if (!this.syncEnabled || !this.syncToken) return;

                    // é˜²æŠ–ï¼š1 åˆ†é’Ÿå†…åªæ¨é€ä¸€æ¬¡
                    const now = Date.now();
                    if (!immediate && now - this._lastPushTime < 60000) {
                        // è®¾ç½®å»¶è¿Ÿæ¨é€ï¼ˆå¦‚æœè¿˜æ²¡æœ‰å®šæ—¶å™¨ï¼‰
                        if (!this._pushDebounceTimer) {
                            const delay = 60000 - (now - this._lastPushTime);
                            this._pushDebounceTimer = setTimeout(() => {
                                this._pushDebounceTimer = null;
                                this._doPushHistory();
                            }, delay);
                        }
                        return;
                    }

                    // æ¸…é™¤å¯èƒ½å­˜åœ¨çš„å®šæ—¶å™¨
                    if (this._pushDebounceTimer) {
                        clearTimeout(this._pushDebounceTimer);
                        this._pushDebounceTimer = null;
                    }

                    this._doPushHistory();
                },

                // å®é™…æ‰§è¡Œæ¨é€
                async _doPushHistory() {
                    if (!this.syncEnabled || !this.syncToken) return;

                    this._lastPushTime = Date.now();

                    try {
                        // æ„å»ºæ¨é€æ•°æ®
                        const historyToSync = this.watchHistory.map(item => ({
                            id: item.name,  // ä½¿ç”¨åç§°ä½œä¸ºå”¯ä¸€ ID
                            data: item,
                            updated_at: new Date(item.watchedAt).getTime()
                        }));

                        await fetch('/api/history/push', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                token: this.syncToken,
                                history: historyToSync
                            })
                        });
                        console.log('[åŒæ­¥] æ¨é€æˆåŠŸï¼Œå…±', historyToSync.length, 'æ¡è®°å½•');
                    } catch (e) {
                        console.error('[åŒæ­¥] æ¨é€å†å²å¤±è´¥:', e);
                    }
                },

                // ä½¿ç”¨ sendBeacon è¿›è¡Œæœ€åä¸€æ¬¡æ¨é€ï¼ˆé¡µé¢å…³é—­æ—¶è°ƒç”¨ï¼‰
                pushHistoryBeacon() {
                    if (!this.syncEnabled || !this.syncToken) return;

                    try {
                        const historyToSync = this.watchHistory.map(item => ({
                            id: item.name,
                            data: item,
                            updated_at: new Date(item.watchedAt).getTime()
                        }));

                        const data = JSON.stringify({
                            token: this.syncToken,
                            history: historyToSync
                        });

                        // sendBeacon ç¡®ä¿é¡µé¢å…³é—­æ—¶æ•°æ®ä¹Ÿèƒ½å‘é€
                        if (navigator.sendBeacon) {
                            navigator.sendBeacon('/api/history/push', new Blob([data], { type: 'application/json' }));
                            console.log('[åŒæ­¥] Beacon æ¨é€');
                        }
                    } catch (e) {
                        console.error('[åŒæ­¥] Beacon æ¨é€å¤±è´¥:', e);
                    }
                },

                // å®Œæ•´åŒæ­¥æµç¨‹
                async syncHistory() {
                    if (!this.syncEnabled || !this.syncToken) return;

                    this.syncStatus = 'syncing';

                    try {
                        // 1. å…ˆæ‹‰å–å¹¶åˆå¹¶
                        await this.pullAndMergeHistory();

                        // 2. å†æ¨é€æœ¬åœ°æ•°æ®ï¼ˆé¦–æ¬¡åŒæ­¥ä½¿ç”¨ç«‹å³æ¨¡å¼ï¼‰
                        await this._doPushHistory();

                        this.syncStatus = 'success';
                        this.lastSyncTime = Date.now();

                        // 3 ç§’åæ¢å¤ idle çŠ¶æ€
                        setTimeout(() => {
                            if (this.syncStatus === 'success') {
                                this.syncStatus = 'idle';
                            }
                        }, 3000);
                    } catch (e) {
                        console.error('[åŒæ­¥] åŒæ­¥å¤±è´¥:', e);
                        this.syncStatus = 'error';
                    }
                },

                // æ·»åŠ åˆ°è§‚çœ‹å†å²ï¼ˆåŒ…å« groupData ç”¨äºç›´æ¥æ’­æ”¾ï¼‰
                addToWatchHistory(name, poster, episode, progress, duration, groupData) {
                    // æŸ¥æ‰¾æ˜¯å¦å·²å­˜åœ¨
                    const existingIndex = this.watchHistory.findIndex(item => item.name === name);

                    const historyItem = {
                        name: name,
                        poster: poster || '',
                        episode: episode || null,  // å½“å‰é›†æ•°ï¼Œå¦‚ "ç¬¬5é›†"
                        progress: duration > 0 ? Math.min(Math.round((progress / duration) * 100), 100) : 0,
                        // ç²¾ç¡®æ’­æ”¾è¿›åº¦ï¼ˆç§’ï¼‰ï¼Œç”¨äºè·¨è®¾å¤‡æ¢å¤æ’­æ”¾ä½ç½®
                        progressTime: Math.round(progress) || 0,
                        progressDuration: Math.round(duration) || 0,
                        watchedAt: new Date().toISOString(),
                        // ä¿å­˜æ’­æ”¾æ‰€éœ€çš„æ•°æ®ï¼ˆç”¨äºç›´æ¥æ’­æ”¾ï¼‰
                        groupData: groupData ? {
                            name: groupData.name,
                            pic: groupData.pic,
                            sources: groupData.sources.map((s, idx) => ({
                                vod_name: s.vod_name,
                                vod_pic: s.vod_pic,
                                vod_play_url: s.vod_play_url,
                                vod_content: s.vod_content || '',  // å‰§æƒ…ä»‹ç»
                                site_name: s.site_name,
                                site_key: s.site_key || (s.site_name + '_' + idx),  // ç”¨äºåŒ¹é…é«˜äº®
                                latency: s.latency || 500,  // é»˜è®¤å»¶è¿Ÿ
                                _testType: s._testType || null  // ä¿å­˜æµ‹é€Ÿç±»å‹: direct/proxy/server
                            }))
                        } : null
                    };

                    if (existingIndex !== -1) {
                        // æ›´æ–°å·²å­˜åœ¨çš„è®°å½•
                        this.watchHistory.splice(existingIndex, 1);
                    }

                    // æ·»åŠ åˆ°æœ€å‰é¢
                    this.watchHistory.unshift(historyItem);

                    // é™åˆ¶æœ€å¤šä¿å­˜30æ¡
                    if (this.watchHistory.length > 30) {
                        this.watchHistory = this.watchHistory.slice(0, 30);
                    }

                    this.saveWatchHistoryToStorage();
                    console.log('[è§‚çœ‹å†å²] å·²ä¿å­˜:', name, 'è¿›åº¦:', historyItem.progress + '%', 'groupData:', !!groupData);
                },

                // æ¸…é™¤è§‚çœ‹å†å²
                async clearWatchHistory() {
                    if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰è§‚çœ‹å†å²å—ï¼Ÿ')) {
                        this.watchHistory = [];
                        localStorage.removeItem('donggua_watch_history');

                        // æ¸…é™¤æœåŠ¡å™¨ç«¯å†å²
                        if (this.syncEnabled && this.syncToken) {
                            try {
                                await fetch('/api/history/clear', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({ token: this.syncToken })
                                });
                                console.log('[åŒæ­¥] æœåŠ¡å™¨å†å²å·²æ¸…é™¤');
                            } catch (e) {
                                console.error('[åŒæ­¥] æ¸…é™¤æœåŠ¡å™¨å†å²å¤±è´¥:', e);
                            }
                        }
                        console.log('[è§‚çœ‹å†å²] å·²æ¸…é™¤');
                    }
                },

                // é€€å‡ºç™»å½•ï¼ˆåˆ‡æ¢è´¦æˆ·ï¼‰
                confirmLogout() {
                    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ\né€€å‡ºåéœ€è¦é‡æ–°è¾“å…¥å¯†ç ã€‚\n\nâš ï¸ ä¸ºé˜²æ­¢è§‚çœ‹å†å²æ··æ·†ï¼Œæœ¬åœ°å†å²å°†è¢«æ¸…é™¤ã€‚')) {
                        // æ¸…é™¤è®¤è¯ä¿¡æ¯
                        localStorage.removeItem('emax_auth_hash');
                        localStorage.removeItem('emax_auth_expiry');
                        sessionStorage.removeItem('emax_session_only');

                        // æ¸…é™¤æœ¬åœ°è§‚çœ‹å†å²ï¼ˆé˜²æ­¢ä¸åŒç”¨æˆ·æ•°æ®äº¤å‰ï¼‰
                        localStorage.removeItem('donggua_watch_history');

                        // æ¸…é™¤æ‰€æœ‰æ’­æ”¾è¿›åº¦è®°å½•
                        const keysToRemove = [];
                        for (let i = 0; i < localStorage.length; i++) {
                            const key = localStorage.key(i);
                            if (key && key.startsWith('donggua_progress_')) {
                                keysToRemove.push(key);
                            }
                        }
                        keysToRemove.forEach(key => localStorage.removeItem(key));

                        // æ¸…é™¤åŒæ­¥çŠ¶æ€
                        this.syncEnabled = false;
                        this.syncToken = '';
                        this.watchHistory = [];

                        console.log('[ç™»å½•] å·²é€€å‡ºï¼Œæœ¬åœ°æ•°æ®å·²æ¸…é™¤');

                        // åˆ·æ–°é¡µé¢æ˜¾ç¤ºå¯†ç è¾“å…¥æ¡†
                        window.location.reload();
                    }
                },

                // TV æ¨¡å¼åˆ‡æ¢
                toggleTVMode() {
                    const newMode = !this.isTVMode;
                    try {
                        if (newMode) {
                            localStorage.setItem('force_tv_mode', '1');
                        } else {
                            localStorage.setItem('force_tv_mode', '0');  // ä¿å­˜å…³é—­çŠ¶æ€
                        }
                    } catch (e) { }

                    // æ˜¾ç¤ºæç¤º
                    const message = newMode
                        ? 'ğŸ“º å·²å¼€å¯ TV æ¨¡å¼ï¼Œé¡µé¢å³å°†åˆ·æ–°...'
                        : 'ğŸ“± å·²å…³é—­ TV æ¨¡å¼ï¼Œé¡µé¢å³å°†åˆ·æ–°...';

                    // åˆ›å»ºç¾è§‚çš„æç¤º
                    const toast = document.createElement('div');
                    toast.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: rgba(0, 0, 0, 0.9);
                        color: #fff;
                        padding: 20px 30px;
                        border-radius: 12px;
                        font-size: 16px;
                        z-index: 999999;
                        text-align: center;
                        box-shadow: 0 10px 40px rgba(0,0,0,0.5);
                        border: 1px solid rgba(229, 9, 20, 0.3);
                    `;
                    toast.innerHTML = message;
                    document.body.appendChild(toast);

                    // å»¶è¿Ÿåˆ·æ–°ä»¥ä¾¿ç”¨æˆ·çœ‹åˆ°æç¤º
                    setTimeout(() => {
                        window.location.reload();
                    }, 800);
                },

                // ä¿å­˜ç”¨æˆ·åå¥½è®¾ç½®
                saveSettings(key) {
                    try {
                        if (key === 'hideRandomRow') {
                            localStorage.setItem('donggua_hide_random', this.hideRandomRow ? 'true' : 'false');
                            console.log('[è®¾ç½®] éšè—éšæœºç›²ç›’:', this.hideRandomRow);
                        } else if (key === 'filterNsfw') {
                            localStorage.setItem('donggua_filter_nsfw', this.filterNsfw ? 'true' : 'false');
                            console.log('[è®¾ç½®] è¿‡æ»¤æˆäººå†…å®¹:', this.filterNsfw);
                            // å¦‚æœå¼€å¯äº†è¿‡æ»¤ï¼Œæ¸…ç©ºå½“å‰çš„éšæœºåˆ—è¡¨è®©å®ƒé‡æ–°åŠ è½½
                            if (this.filterNsfw) {
                                this.rowLists.randomRow = null;
                                this.fetchRandomMixed();
                            }
                        }
                    } catch (e) {
                        console.error('[è®¾ç½®] ä¿å­˜å¤±è´¥:', e);
                    }
                },

                // é¡µè„šéšè”½é€€å‡ºï¼ˆè¿ç»­ç‚¹å‡»3æ¬¡è§¦å‘ï¼‰
                handleFooterClick() {
                    this.footerClickCount++;

                    // 2ç§’å†…æ²¡æœ‰ç»§ç»­ç‚¹å‡»åˆ™é‡ç½®è®¡æ•°
                    clearTimeout(this._footerClickTimer);
                    this._footerClickTimer = setTimeout(() => {
                        this.footerClickCount = 0;
                    }, 2000);

                    // ç‚¹å‡»3æ¬¡è§¦å‘é€€å‡ºç¡®è®¤
                    if (this.footerClickCount >= 3) {
                        this.footerClickCount = 0;
                        this.confirmLogout();
                    }
                },

                // æ ¼å¼åŒ–è§‚çœ‹æ—¶é—´
                formatWatchTime(isoString) {
                    if (!isoString) return '';
                    const date = new Date(isoString);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffMins = Math.floor(diffMs / (60 * 1000));
                    const diffHours = Math.floor(diffMs / (60 * 60 * 1000));
                    const diffDays = Math.floor(diffMs / (24 * 60 * 60 * 1000));

                    if (diffMins < 1) return 'åˆšåˆš';
                    if (diffMins < 60) return `${diffMins}åˆ†é’Ÿå‰`;
                    if (diffHours < 24) return `${diffHours}å°æ—¶å‰`;
                    if (diffDays < 7) return `${diffDays}å¤©å‰`;
                    return `${date.getMonth() + 1}/${date.getDate()}`;
                },

                // ä»å†å²è®°å½•ä¸­åˆ é™¤å•ä¸ªé¡¹ç›®
                removeFromHistory(index) {
                    if (index >= 0 && index < this.watchHistory.length) {
                        const removed = this.watchHistory.splice(index, 1);
                        this.saveWatchHistoryToStorage();
                        // ç«‹å³åŒæ­¥åˆ°æœåŠ¡å™¨
                        this.pushHistoryToServer(true);
                        this.$nextTick(() => this.updateHistoryScrollNeeded());
                        console.log('[è§‚çœ‹å†å²] å·²åˆ é™¤:', removed[0]?.name);
                    }
                },

                // ä»å†å²è®°å½•ç›´æ¥æ’­æ”¾
                async playFromHistory(item) {
                    if (!item || !item.name) return;
                    console.log('[è§‚çœ‹å†å²] ç‚¹å‡»æ’­æ”¾:', item.name, 'groupData:', !!item.groupData, 'episode:', item.episode);

                    // å¦‚æœæœ‰ä¿å­˜çš„ groupDataï¼Œç›´æ¥æ’­æ”¾
                    if (item.groupData && item.groupData.sources && item.groupData.sources.length > 0) {
                        console.log('[è§‚çœ‹å†å²] ä½¿ç”¨ä¿å­˜çš„æ•°æ®ç›´æ¥æ’­æ”¾');

                        // ç¡®ä¿æ‰€æœ‰ sources æœ‰ site_key
                        const sourcesWithKey = item.groupData.sources.map((s, idx) => ({
                            ...s,
                            site_key: s.site_key || (s.site_name + '_' + idx),
                            latency: s.latency || 500
                        }));

                        // è®¾ç½® currentGroupï¼ˆç¡®ä¿ sources æœ‰æ­£ç¡®çš„ site_keyï¼‰
                        this.currentGroup = {
                            ...item.groupData,
                            sources: sourcesWithKey
                        };

                        // è®¾ç½® rawListï¼ˆç”¨äºæ˜¾ç¤ºèµ„æºç«™åˆ—è¡¨å’Œå…è®¸åˆ‡æ¢ï¼‰
                        this.rawList = sourcesWithKey;

                        // è·å–æœ€ä½³èµ„æºï¼šä¼˜å…ˆé€‰æ‹©ç›´è¿æµ‹é€Ÿ(direct)çš„èµ„æºç«™ï¼Œå…¶æ¬¡æ˜¯ä»£ç†(proxy)ï¼Œæœ€åæ‰æ˜¯æœåŠ¡å™¨æµ‹é€Ÿ(server)
                        // 1. ä¼˜å…ˆé€‰æ‹©ç›´è¿æµ‹é€Ÿä¸”å»¶è¿Ÿåˆç†çš„èµ„æº
                        let directSources = sourcesWithKey.filter(s => s._testType === 'direct' && s.latency && s.latency < 3000);
                        // 2. å…¶æ¬¡é€‰æ‹©ä»£ç†æµ‹é€Ÿçš„èµ„æº
                        let proxySources = sourcesWithKey.filter(s => s._testType === 'proxy' && s.latency && s.latency < 3000);
                        // 3. æœ€åæ‰è€ƒè™‘æœåŠ¡å™¨æµ‹é€Ÿæˆ–æ— ç±»å‹çš„èµ„æº
                        let otherSources = sourcesWithKey.filter(s => (!s._testType || s._testType === 'server') && s.latency && s.latency < 3000);

                        // æŒ‰å»¶è¿Ÿæ’åº
                        directSources.sort((a, b) => a.latency - b.latency);
                        proxySources.sort((a, b) => a.latency - b.latency);
                        otherSources.sort((a, b) => a.latency - b.latency);

                        // é€‰æ‹©æœ€ä½³èµ„æº
                        let bestSource = directSources[0] || proxySources[0] || otherSources[0] || sourcesWithKey[0];
                        const testTypeLabel = bestSource?._testType === 'direct' ? 'ğŸ¬ç›´è¿' : (bestSource?._testType === 'proxy' ? 'ğŸ”€ä»£ç†' : 'ğŸ“¡æœåŠ¡å™¨');
                        console.log('[è§‚çœ‹å†å²] é€‰æ‹©èµ„æºç«™:', bestSource?.site_name, 'å»¶è¿Ÿ:', bestSource?.latency, 'ç±»å‹:', testTypeLabel);

                        // è®¾ç½® currentSourceï¼ˆä½¿ç”¨ç›¸åŒçš„ site_keyï¼‰
                        this.currentSource = bestSource;

                        this.showDetail = true;

                        if (bestSource && bestSource.vod_play_url) {
                            // è§£ææ’­æ”¾åœ°å€ï¼ˆåªä»è¿™ä¸€ä¸ªèµ„æºç«™å–ï¼‰
                            const urls = bestSource.vod_play_url.split('#').filter(u => u && u.includes('$'));
                            console.log('[è§‚çœ‹å†å²] è§£æåˆ°', urls.length, 'ä¸ªå‰§é›†');

                            if (urls.length > 0) {
                                // æ„å»ºå‰§é›†åˆ—è¡¨ï¼ˆåªç”¨ä¸€ä¸ªèµ„æºç«™çš„ï¼‰
                                this.episodeList = urls.map(u => {
                                    const p = u.split('$');
                                    return { name: p[0], url: p[1] };
                                });

                                // æ‰¾åˆ°å¯¹åº”é›†æ•°
                                let targetEpisode = this.episodeList[0];
                                if (item.episode) {
                                    // ç²¾ç¡®åŒ¹é…é›†æ•°åç§°
                                    const found = this.episodeList.find(ep => ep.name === item.episode);
                                    if (found) {
                                        targetEpisode = found;
                                        console.log('[è§‚çœ‹å†å²] æ‰¾åˆ°åŒ¹é…é›†æ•°:', item.episode);
                                    } else {
                                        console.log('[è§‚çœ‹å†å²] æœªæ‰¾åˆ°åŒ¹é…é›†æ•°:', item.episode, 'ä½¿ç”¨ç¬¬ä¸€é›†');
                                    }
                                }

                                await this.$nextTick();
                                if (targetEpisode && targetEpisode.url) {
                                    this.play(targetEpisode.url, bestSource.site_name);
                                    return;
                                }
                            }
                        }
                    }

                    // æ²¡æœ‰ä¿å­˜çš„æ•°æ®æˆ–è§£æå¤±è´¥ï¼Œä½¿ç”¨æœç´¢
                    console.log('[è§‚çœ‹å†å²] æ²¡æœ‰ä¿å­˜æ•°æ®æˆ–è§£æå¤±è´¥ï¼Œä½¿ç”¨æœç´¢');
                    await this.autoSearch(item.name);
                },

                // æ»šåŠ¨è§‚çœ‹å†å²ï¼ˆä¸è§¦å‘ fetchRowï¼‰
                scrollHistoryRow(direction) {
                    console.log('[å†å²æ»šåŠ¨] ç‚¹å‡»æŒ‰é’®, direction=', direction);
                    let row = this.$refs.watchHistoryRow;
                    console.log('[å†å²æ»šåŠ¨] ref åŸå§‹å€¼:', this.$refs.watchHistoryRow);
                    if (Array.isArray(row)) row = row[0];
                    if (row) {
                        console.log('[å†å²æ»šåŠ¨] æ»šåŠ¨å‰ scrollLeft=', row.scrollLeft);
                        // æ¯æ¬¡æ»šåŠ¨åŠå±å®½åº¦
                        const scrollAmount = row.clientWidth * 0.6;
                        const newScrollLeft = row.scrollLeft + direction * scrollAmount;
                        console.log('[å†å²æ»šåŠ¨] scrollAmount=', scrollAmount, 'newScrollLeft=', newScrollLeft);

                        // é™åˆ¶æ»šåŠ¨èŒƒå›´
                        const maxScroll = row.scrollWidth - row.clientWidth;
                        const finalScrollLeft = Math.max(0, Math.min(newScrollLeft, maxScroll));
                        console.log('[å†å²æ»šåŠ¨] maxScroll=', maxScroll, 'finalScrollLeft=', finalScrollLeft);
                        row.scrollLeft = finalScrollLeft;
                        console.log('[å†å²æ»šåŠ¨] æ»šåŠ¨å scrollLeft=', row.scrollLeft);

                        // æ»šåŠ¨åå»¶è¿Ÿæ›´æ–°æŒ‰é’®çŠ¶æ€ï¼ˆç­‰å¾…æµè§ˆå™¨å®Œæˆæ»šåŠ¨ï¼‰
                        setTimeout(() => this.updateHistoryScrollNeeded(), 50);
                    } else {
                        console.log('[å†å²æ»šåŠ¨] âŒ row å…ƒç´ æœªæ‰¾åˆ°');
                    }
                },

                // æ£€æŸ¥è§‚çœ‹å†å²æ»šåŠ¨æŒ‰é’®çŠ¶æ€
                updateHistoryScrollNeeded() {
                    let row = this.$refs.watchHistoryRow;
                    if (Array.isArray(row)) row = row[0];
                    if (row) {
                        const scrollLeft = Math.round(row.scrollLeft);
                        const scrollWidth = row.scrollWidth;
                        const clientWidth = row.clientWidth;
                        const maxScroll = scrollWidth - clientWidth;

                        // å·¦æŒ‰é’®ï¼šåªæœ‰æ»šåŠ¨è¿‡æ‰æ˜¾ç¤º
                        this.historyCanScrollLeft = scrollLeft > 10;
                        // å³æŒ‰é’®ï¼šåªæœ‰å½“å³ä¾§è¿˜æœ‰æœªæ˜¾ç¤ºå†…å®¹æ—¶æ˜¾ç¤º
                        this.historyCanScrollRight = maxScroll > 10 && scrollLeft < maxScroll - 10;

                        console.log('[å†å²æŒ‰é’®çŠ¶æ€] scrollLeft=', scrollLeft, 'maxScroll=', maxScroll,
                            'canLeft=', this.historyCanScrollLeft, 'canRight=', this.historyCanScrollRight);
                    } else {
                        this.historyCanScrollLeft = false;
                        this.historyCanScrollRight = false;
                    }
                },

                // ç›‘å¬è§‚çœ‹å†å²æ»šåŠ¨äº‹ä»¶
                onHistoryScroll() {
                    this.updateHistoryScrollNeeded();
                },

                // ç›‘å¬åˆ†ç±»æ¦œå•æ»šåŠ¨äº‹ä»¶ (å¸¦èŠ‚æµä¼˜åŒ–)
                onRowScroll(key) {
                    // èŠ‚æµï¼šé¿å…é¢‘ç¹è§¦å‘
                    if (this._scrollThrottleTimers?.[key]) return;
                    if (!this._scrollThrottleTimers) this._scrollThrottleTimers = {};

                    this._scrollThrottleTimers[key] = true;
                    requestAnimationFrame(() => {
                        let row = this.$refs[key];
                        if (Array.isArray(row)) row = row[0]; // v-for ref ä¿®æ­£
                        if (row) {
                            // åªè¦æ»šè¿‡ä¸€ç‚¹ç‚¹ï¼Œå°±æ˜¾ç¤ºå·¦æŒ‰é’®
                            const showLeft = row.scrollLeft > 10;
                            if (this.rowLeftButtons[key] !== showLeft) {
                                this.rowLeftButtons = { ...this.rowLeftButtons, [key]: showLeft };
                            }

                            // æ‰‹æœºç«¯ï¼šæ»‘åŠ¨æ¥è¿‘å³è¾¹ç¼˜æ—¶è‡ªåŠ¨åŠ è½½æ›´å¤š
                            const nearRightEdge = row.scrollLeft + row.clientWidth >= row.scrollWidth - 300;
                            if (nearRightEdge) {
                                this.fetchRow(key, true);
                            }
                        }
                        // èŠ‚æµé‡ç½® (100ms)
                        setTimeout(() => {
                            this._scrollThrottleTimers[key] = false;
                        }, 100);
                    });
                },
                // åˆ‡æ¢æ¦œå•å±•å¼€/æ”¶èµ·çŠ¶æ€
                toggleRowExpand(key) {
                    const isExpanding = !this.expandedRows[key];
                    console.log(`[DEBUG toggleRowExpand] key=${key}, isExpanding=${isExpanding}, viewPages[key] before=`, this.viewPages[key]);
                    this.expandedRows = { ...this.expandedRows, [key]: isExpanding };
                    // å±•å¼€æ—¶åˆå§‹åŒ–é¡µç ä¸º 1ï¼ˆä½¿ç”¨å“åº”å¼æ–¹å¼ï¼‰
                    if (isExpanding && this.viewPages[key] === undefined) {
                        this.viewPages = { ...this.viewPages, [key]: 1 };
                        console.log(`[DEBUG toggleRowExpand] Initialized viewPages[${key}] = 1`);
                    }
                    console.log(`[DEBUG toggleRowExpand] viewPages[key] after=`, this.viewPages[key]);
                },
                // æ»šåŠ¨åˆ°æŒ‡å®šåŒºåŸŸï¼ˆä½¿ç”¨ -section åç¼€çš„ refï¼‰
                scrollToSection(refName) {
                    // å…ˆæ‰¾åˆ°ç›®æ ‡å…ƒç´ 
                    const refKey = refName + '-section';
                    const sectionRef = this.$refs[refKey];
                    let el = Array.isArray(sectionRef) ? sectionRef[0] : sectionRef;
                    if (!el) return;

                    // è¾…åŠ©å‡½æ•°ï¼šæ‰§è¡Œæ»šåŠ¨
                    const doScroll = () => {
                        const rect = el.getBoundingClientRect();
                        const targetTop = rect.top + window.scrollY - 120;
                        window.scrollTo({ top: targetTop, behavior: 'smooth' });
                    };

                    // ç¬¬ä¸€æ¬¡æ»šåŠ¨
                    doScroll();

                    // ç”±äºå›¾ç‰‡æ‡’åŠ è½½å¯èƒ½å¯¼è‡´å¸ƒå±€åç§»ï¼Œå»¶è¿Ÿåå†æ¬¡å¾®è°ƒä½ç½®
                    // ç­‰å¾… 400ms è®©å¤§éƒ¨åˆ†å›¾ç‰‡å®ŒæˆåŠ è½½
                    setTimeout(() => {
                        doScroll();
                    }, 400);

                    // å†æ¬¡å¾®è°ƒï¼ˆ800ms åï¼‰ï¼Œå¤„ç†æ…¢é€Ÿç½‘ç»œ
                    setTimeout(() => {
                        doScroll();
                    }, 800);
                },

                // è·å–å½“å‰æŸ¥çœ‹é¡µçš„æ•°æ®ï¼ˆæ¯é¡µ20æ¡ï¼‰
                getPagedItems(key) {
                    const items = this.rowLists[key] || [];
                    const page = this.viewPages[key] || 1;
                    const perPage = 20;
                    const start = (page - 1) * perPage;
                    return items.slice(start, start + perPage);
                },

                // è·å–æ€»æŸ¥çœ‹é¡µæ•°
                getTotalViewPages(key) {
                    const items = this.rowLists[key] || [];
                    return Math.ceil(items.length / 20) || 1;
                },

                // æ»šåŠ¨åˆ°åˆ†ç±»æ ‡é¢˜ä½ç½®
                scrollToSectionTitle(key) {
                    this.$nextTick(() => {
                        const refKey = key + '-section';
                        const sectionRef = this.$refs[refKey];
                        let el = Array.isArray(sectionRef) ? sectionRef[0] : sectionRef;
                        if (el) {
                            const rect = el.getBoundingClientRect();
                            const targetY = window.pageYOffset + rect.top - 90;
                            window.scrollTo({
                                top: Math.max(0, targetY),
                                behavior: 'smooth'
                            });
                        }
                    });
                },

                // åˆ‡æ¢æŸ¥çœ‹é¡µï¼ˆå¸¦èŠ‚æµä¿æŠ¤ï¼‰
                changeViewPage(key, delta) {
                    // ç¡®ä¿åˆå§‹å€¼å­˜åœ¨ï¼ˆä½¿ç”¨å“åº”å¼æ–¹å¼ï¼‰
                    if (this.viewPages[key] === undefined) {
                        this.viewPages = { ...this.viewPages, [key]: 1 };
                    }

                    const currentPage = this.viewPages[key];
                    const newPage = currentPage + delta;
                    const totalPages = this.getTotalViewPages(key);

                    // æœ¬åœ°ç¿»é¡µï¼ˆä¸éœ€è¦ APIï¼‰å¯ä»¥ç«‹å³æ‰§è¡Œ
                    if (newPage >= 1 && newPage <= totalPages) {
                        this.viewPages = { ...this.viewPages, [key]: newPage };
                        // ç¿»é¡µåæ»šåŠ¨åˆ°åˆ†ç±»æ ‡é¢˜ä½ç½®
                        this.scrollToSectionTitle(key);
                    } else if (newPage > totalPages && this.rowConfigs[key].page < (this.rowConfigs[key].totalPages || 999)) {
                        // éœ€è¦åŠ è½½æ›´å¤šæ•°æ®
                        this._pendingPage = this._pendingPage || {};
                        this._pendingPage[key] = newPage;
                    }

                    // å¦‚æœéœ€è¦åŠ è½½æ›´å¤šæ•°æ®ï¼Œæ·»åŠ èŠ‚æµä¿æŠ¤ï¼ˆ500ms é—´éš”ï¼‰
                    if (newPage >= totalPages && this.rowConfigs[key].page < (this.rowConfigs[key].totalPages || 999)) {
                        // æ£€æŸ¥æ˜¯å¦æ­£åœ¨åŠ è½½ä¸­
                        if (this.pageLoadingKeys[key]) {
                            return;
                        }
                        // è®¾ç½®åŠ è½½é”
                        this.pageLoadingKeys[key] = true;

                        // åŠ è½½æ›´å¤šæ•°æ®ï¼Œå¹¶åœ¨å®Œæˆåæ£€æŸ¥æ˜¯å¦éœ€è¦è‡ªåŠ¨ç¿»é¡µ
                        this.fetchRow(key, true).then(() => {
                            // æ£€æŸ¥æ˜¯å¦æœ‰å¾…æ‰§è¡Œçš„ç¿»é¡µ
                            if (this._pendingPage && this._pendingPage[key]) {
                                const pendingPage = this._pendingPage[key];
                                const newTotalPages = this.getTotalViewPages(key);
                                if (pendingPage <= newTotalPages) {
                                    this.viewPages = { ...this.viewPages, [key]: pendingPage };
                                    // ç¿»é¡µåæ»šåŠ¨åˆ°åˆ†ç±»æ ‡é¢˜ä½ç½®
                                    this.scrollToSectionTitle(key);
                                }
                                delete this._pendingPage[key];
                            }
                        });

                        // 500ms åè§£é”
                        setTimeout(() => {
                            this.pageLoadingKeys[key] = false;
                        }, 500);
                    }
                },

                // å¤„ç†åˆ†ç±»ç‚¹å‡»
                handleCatClick(item) {
                    if (item.action === 'scroll') {
                        this.scrollToSection(item.value);
                    } else if (item.action === 'search') {
                        this.autoSearch(item.value);
                    }
                },

                // è·å–æµ·æŠ¥å›¾ç‰‡é“¾æ¥ (è‡ªåŠ¨é€‚é…æœ¬åœ°/è¿œç¨‹)
                getPosterUrl(path, size = 'w300') {
                    if (!path) {
                        return "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='450'%3E%3Crect fill='%23333' width='300' height='450'/%3E%3Ctext fill='%23666' x='50%25' y='50%25' text-anchor='middle' dy='.3em' font-size='20'%3ENo Image%3C/text%3E%3C/svg%3E";
                    }
                    // å¦‚æœé…ç½®äº†æœ¬åœ°ç¼“å­˜ URLï¼Œä½¿ç”¨å®ƒ (æ³¨æ„å»æ‰ size éƒ¨åˆ†å› ä¸ºå·²åŒ…å«åœ¨ path é‡Œ? ä¸ï¼Œpathåªæ˜¯ /xxxx.jpg)
                    // TMDB_IMG_URL æ ¼å¼å¯èƒ½æ˜¯ "/api/tmdb-image/w342" æˆ– "https://image.tmdb.org/t/p/w342"
                    return this.TMDB_IMG_URL + path;
                },

                // é˜²æŠ–æœç´¢ - è¾“å…¥æ—¶å®æ—¶æœç´¢
                debouncedSearch() {
                    clearTimeout(this.searchTimer);
                    if (!this.keyword || this.keyword.length < 2) {
                        // å…³é”®è¯å¤ªçŸ­æ—¶ä¸æœç´¢ï¼Œæ¸…é™¤ç»“æœ
                        if (!this.keyword) {
                            this.searched = false;
                            this.rawList = [];
                        }
                        return;
                    }
                    this.searchTimer = setTimeout(() => {
                        this.doSearch();
                    }, 500);  // 500ms é˜²æŠ–å»¶è¿Ÿ
                },

                // æ˜¾ç¤ºç”µå½±è¯¦æƒ…å¼¹çª—
                showMovieInfo(item) {
                    if (!item) return;
                    this.infoModalData = item;
                    this.showInfoModal = true;
                },

                // è®¾ç½® TMDB åä»£ï¼ˆé’ˆå¯¹å¤§é™†ç”¨æˆ·ï¼‰
                async setupTmdbProxy(proxyUrl) {
                    let isCN = false;

                    // è¶…æ—¶ fetchï¼ˆfetch åŸç”Ÿä¸æ”¯æŒ timeout é€‰é¡¹ï¼Œéœ€ç”¨ AbortControllerï¼‰
                    const fetchWithTimeout = async (url, timeoutMs = 3000) => {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(() => controller.abort(), timeoutMs);
                        try {
                            const res = await fetch(url, { signal: controller.signal });
                            clearTimeout(timeoutId);
                            return res;
                        } catch (e) {
                            clearTimeout(timeoutId);
                            throw e;
                        }
                    };

                    try {
                        // 1. ä¼˜å…ˆä½¿ç”¨ ip.sb (å›½å†…è®¿é—®ç¨³å®šï¼Œæ— é€Ÿç‡é™åˆ¶ï¼Œè¿”å›æ ‡å‡† JSON)
                        const res = await fetchWithTimeout('https://api.ip.sb/geoip', 3000);
                        if (res.ok) {
                            const data = await res.json();
                            // æ£€æŸ¥æ˜¯å¦æ˜¯ä¸­å›½å¤§é™† (country_code = CN)
                            // ip.sb è¿”å›: { "country_code": "CN", "country": "China", ... }
                            if (data.country_code === 'CN') {
                                // æ’é™¤æ¸¯æ¾³å° (æ ¹æ® region æˆ– city åˆ¤æ–­)
                                const excludeRegions = ['Hong Kong', 'Macau', 'Taiwan', 'é¦™æ¸¯', 'æ¾³é—¨', 'å°æ¹¾'];
                                const region = data.region || data.city || '';
                                if (!excludeRegions.some(r => region.includes(r))) {
                                    isCN = true;
                                }
                            }
                        } else {
                            throw new Error('ip.sb Status: ' + res.status);
                        }
                    } catch (e) {
                        // 2. å¤‡é€‰ï¼špv.sohu.comï¼ˆæœç‹ï¼Œå›½å†…é€Ÿåº¦å¿«ï¼‰
                        console.log('[IPæ£€æµ‹] ip.sb å¤±è´¥ï¼Œå°è¯•æœç‹æ¥å£...', e.message || e);
                        try {
                            const res = await fetchWithTimeout('https://pv.sohu.com/cityjson?ie=utf-8', 3000);
                            if (res.ok) {
                                const text = await res.text();
                                // å“åº”æ ¼å¼: var returnCitySN = {"cip": "x.x.x.x", "cid": "...", "cname": "åŒ—äº¬å¸‚"};
                                const match = text.match(/cname\s*:\s*["']([^"']+)["']/);
                                if (match) {
                                    // åªè¦ cname æœ‰å€¼å°±è®¤ä¸ºæ˜¯å›½å†…ï¼ˆæœç‹æ¥å£åªè¿”å›å›½å†…åŸå¸‚ï¼‰
                                    // æ’é™¤æ¸¯æ¾³å°
                                    const city = match[1];
                                    const excludeRegions = ['é¦™æ¸¯', 'æ¾³é—¨', 'å°æ¹¾'];
                                    if (!excludeRegions.some(r => city.includes(r))) {
                                        isCN = true;
                                    }
                                }
                            } else {
                                console.warn('[IPæ£€æµ‹] æœç‹æ¥å£å“åº”å¼‚å¸¸:', res.status);
                            }
                        } catch (e2) {
                            // 3. æœ€ç»ˆå¤‡é€‰ï¼šCloudflare Traceï¼ˆå›½å¤–ç”¨æˆ·ï¼‰
                            console.log('[IPæ£€æµ‹] æœç‹æ¥å£å¤±è´¥ï¼Œå°è¯• Cloudflare...', e2.message || e2);
                            try {
                                const res = await fetchWithTimeout('https://www.cloudflare.com/cdn-cgi/trace', 3000);
                                if (res.ok) {
                                    const text = await res.text();
                                    const matches = text.match(/loc=([A-Z]+)/);
                                    if (matches && matches[1] === 'CN') isCN = true;
                                }
                            } catch (e3) {
                                console.warn('[IPæ£€æµ‹] æ‰€æœ‰æ¥å£å‡å¤±è´¥ï¼Œè·³è¿‡è‡ªåŠ¨åˆ‡æ¢');
                            }
                        }
                    }

                    if (isCN) {
                        console.log('[IPæ£€æµ‹] æ£€æµ‹åˆ°å¤§é™†IPï¼Œå¯ç”¨TMDBåä»£:', proxyUrl);
                        TMDB_BASE_URL = proxyUrl + '/3';
                        TMDB_IMG_URL = proxyUrl + '/t/p/w342';
                        TMDB_BACKDROP_URL = proxyUrl + '/t/p/original';
                    } else {
                        console.log('[IPæ£€æµ‹] éå¤§é™†IPæˆ–æ£€æµ‹å®Œæˆï¼Œä¿æŒå®˜æ–¹åœ°å€');
                    }
                },

                // æ¸…ç† HTML æ ‡ç­¾
                stripHtml(html) {
                    if (!html) return '';
                    return html.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').trim();
                },

                getLatencyClass(ms) { return ms < 500 ? 'dot-green' : (ms < 2000 ? 'dot-yellow' : 'dot-red'); },
                // æŠ•å±åŠŸèƒ½ï¼šçº¯ç²¹çš„åŸç”Ÿå®ç°
                castVideo() {
                    const videoEl = document.querySelector('.dplayer-video');
                    if (!videoEl) return alert('è¯·å…ˆæ’­æ”¾è§†é¢‘');

                    // ğŸ”† æŠ•å±æ—¶ä¿æŒå±å¹•å¸¸äº®ï¼ˆé‡è¦ï¼šé˜²æ­¢é”å±å¯¼è‡´æŠ•å±æš‚åœï¼‰
                    this.requestWakeLock();

                    // 1. ä¼˜å…ˆå°è¯• Remote Playback API (Android Chrome / Edge)
                    // å…³é”®ä¿®å¤ï¼šä¸å†åˆ¤æ–­ state !== 'disconnected'ï¼Œåªè¦ API å­˜åœ¨å°±å°è¯•è°ƒç”¨
                    if (videoEl.remote && typeof videoEl.remote.prompt === 'function') {
                        videoEl.remote.prompt()
                            .then(() => console.log('[æŠ•å±] å‘¼å‡ºæŠ•å±èœå•æˆåŠŸ'))
                            .catch((err) => {
                                // é”™è¯¯å¤„ç†ï¼š
                                // DOMException: The prompt could not be shown. (é€šå¸¸æ˜¯å› ä¸ºæ²¡å¼€æœºã€æ²¡æœåˆ°è®¾å¤‡æˆ–é HTTPS)
                                console.log('[æŠ•å±] æ— æ³•æ˜¾ç¤ºæŠ•å±èœå•:', err);

                                // åªæœ‰åœ¨æ˜ç¡®æŠ¥é”™æ— æ³•æ˜¾ç¤ºèœå•æ—¶ï¼Œæ‰æç¤ºç”¨æˆ·
                                alert('æ— å¯ç”¨æŠ•å±è®¾å¤‡æˆ–æµè§ˆå™¨å—é™ã€‚\n\n1. è¯·ç¡®ä¿ç”µè§†/æŠ•å½±å·²å¼€æœºå¹¶è¿æ¥åŒä¸€WiFi\n2. ç¡®ä¿é€šè¿‡ HTTPS è®¿é—®\n3. æˆ–ä½¿ç”¨æµè§ˆå™¨èœå•ä¸­çš„"æŠ•å°„"åŠŸèƒ½');
                            });
                        return;
                    }

                    // 2. å°è¯• Safari AirPlay (iOS)
                    if (videoEl.webkitShowPlaybackTargetPicker) {
                        videoEl.webkitShowPlaybackTargetPicker();
                        return;
                    }

                    // 3. çœŸÂ·ä¸æ”¯æŒæ—¶çš„å›é€€ï¼šä»…å¤åˆ¶åœ°å€
                    const videoUrl = this.currentUrl || videoEl.src;
                    if (confirm('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒç›´æ¥æŠ•å±ã€‚\n\nç‚¹å‡»ç¡®å®šå¤åˆ¶è§†é¢‘åœ°å€ï¼Œå¯å»å…¶ä»–æ’­æ”¾å™¨æŠ•å±ã€‚')) {
                        navigator.clipboard.writeText(videoUrl)
                            .then(() => alert('âœ… åœ°å€å·²å¤åˆ¶'))
                            .catch(() => prompt('è¯·æ‰‹åŠ¨å¤åˆ¶:', videoUrl));
                    }
                },

                // ğŸ”† å±å¹•å¸¸äº®ï¼šè¯·æ±‚ Wake Lockï¼ˆæ’­æ”¾/æŠ•å±æ—¶ä¿æŒå±å¹•å¸¸äº®ï¼‰
                async requestWakeLock() {
                    // æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ Screen Wake Lock API
                    if (!('wakeLock' in navigator)) {
                        console.log('[Wake Lock] æµè§ˆå™¨ä¸æ”¯æŒ Screen Wake Lock API');
                        return;
                    }

                    // å¦‚æœå·²ç»æœ‰ Wake Lockï¼Œä¸é‡å¤è¯·æ±‚
                    if (this.wakeLock) {
                        console.log('[Wake Lock] å·²æ¿€æ´»ï¼Œè·³è¿‡é‡å¤è¯·æ±‚');
                        return;
                    }

                    try {
                        this.wakeLock = await navigator.wakeLock.request('screen');
                        console.log('[Wake Lock] âœ… å±å¹•å¸¸äº®å·²æ¿€æ´»');

                        // ç›‘å¬ Wake Lock è¢«ç³»ç»Ÿé‡Šæ”¾ï¼ˆå¦‚åˆ‡æ¢æ ‡ç­¾é¡µã€æœ€å°åŒ–ï¼‰
                        this.wakeLock.addEventListener('release', () => {
                            console.log('[Wake Lock] âš ï¸ å±å¹•å¸¸äº®è¢«ç³»ç»Ÿé‡Šæ”¾');
                            this.wakeLock = null;
                        });

                        // ç›‘å¬é¡µé¢å¯è§æ€§å˜åŒ–ï¼Œé‡æ–°è·å– Wake Lock
                        const handleVisibilityChange = async () => {
                            if (document.visibilityState === 'visible' && this.showDetail && this.currentUrl) {
                                // é¡µé¢é‡æ–°å¯è§ä¸”æ­£åœ¨æ’­æ”¾ï¼Œå°è¯•é‡æ–°è·å– Wake Lock
                                if (!this.wakeLock) {
                                    try {
                                        this.wakeLock = await navigator.wakeLock.request('screen');
                                        console.log('[Wake Lock] âœ… é¡µé¢æ¢å¤ï¼Œå±å¹•å¸¸äº®å·²é‡æ–°æ¿€æ´»');
                                        this.wakeLock.addEventListener('release', () => {
                                            this.wakeLock = null;
                                        });
                                    } catch (e) {
                                        console.log('[Wake Lock] é‡æ–°æ¿€æ´»å¤±è´¥:', e.message);
                                    }
                                }
                            }
                        };

                        // åªæ·»åŠ ä¸€æ¬¡ç›‘å¬å™¨
                        if (!this._wakeLockVisibilityHandler) {
                            this._wakeLockVisibilityHandler = handleVisibilityChange;
                            document.addEventListener('visibilitychange', handleVisibilityChange);
                        }

                    } catch (err) {
                        console.log('[Wake Lock] è¯·æ±‚å¤±è´¥:', err.message);
                        // å¸¸è§åŸå› ï¼šç”µæ± ç”µé‡ä½ã€çœç”µæ¨¡å¼ã€æµè§ˆå™¨é™åˆ¶ç­‰
                    }
                },

                // ğŸ”… å±å¹•å¸¸äº®ï¼šé‡Šæ”¾ Wake Lock
                async releaseWakeLock() {
                    if (this.wakeLock) {
                        try {
                            await this.wakeLock.release();
                            console.log('[Wake Lock] ğŸ”… å±å¹•å¸¸äº®å·²å…³é—­');
                        } catch (e) {
                            console.log('[Wake Lock] é‡Šæ”¾å¤±è´¥:', e.message);
                        }
                        this.wakeLock = null;
                    }
                },

                scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); },

                goHome() {
                    // TV æ¨¡å¼ï¼šç›´æ¥åˆ·æ–°é¡µé¢ï¼Œç¡®ä¿å®Œå…¨é‡ç½®çŠ¶æ€
                    if (this.isTVMode) {
                        window.location.href = '/';
                        return;
                    }

                    this.scrollToTop();
                    // å…³é—­æ’­æ”¾è¯¦æƒ…é¡µ
                    this.showDetail = false;
                    if (dp) dp.pause();
                    // æ¸…é™¤æœç´¢çŠ¶æ€
                    this.searched = false;
                    this.keyword = '';
                    this.rawList = [];
                    window.scrollTo(0, 0);
                },

                // åŠ è½½å•ä¸ªæ¦œå•æ•°æ®
                fetchRow(key, loadMore = false) {
                    if (key === 'randomRow') {
                        return this.fetchRandomMixed(loadMore);
                    }
                    const config = this.rowConfigs[key];
                    if (!config) return Promise.resolve();

                    if (loadMore) {
                        // æ£€æŸ¥æ˜¯å¦å·²åˆ°è¾¾ API è¿”å›çš„æ€»é¡µæ•°
                        if (config.totalPages && config.page >= config.totalPages) {
                            console.log(`[${key}] å·²åŠ è½½å…¨éƒ¨ ${config.totalPages} é¡µ`);
                            return Promise.resolve();
                        }
                        config.page++;
                    }

                    // æ„å»ºæ’åºå‚æ•°
                    let sortParam = '';
                    if (config.sortMode && config.path.includes('/discover/')) {
                        const isMovie = config.path.includes('/movie');
                        if (config.sortMode === 'newest') {
                            const dateField = isMovie ? 'primary_release_date.desc' : 'first_air_date.desc';
                            sortParam = `&sort_by=${dateField}&vote_count.gte=10`;
                        } else {
                            sortParam = '&sort_by=popularity.desc';
                        }
                    }

                    const url = `/api/tmdb-proxy?path=${encodeURIComponent(config.path)}&page=${config.page}&${config.params}${sortParam}`;
                    return tmdbFetch(url)
                        .then(res => res.json())
                        .then(data => {
                            if (data.results) {
                                // ä¿å­˜æ€»é¡µæ•°ä¿¡æ¯
                                if (data.total_pages) {
                                    config.totalPages = data.total_pages;
                                }
                                // ç¡®ä¿å“åº”å¼æ›´æ–°
                                if (!this.rowLists[key]) {
                                    this.rowLists[key] = data.results;
                                } else if (loadMore) {
                                    this.rowLists[key].push(...data.results);
                                } else {
                                    this.rowLists[key] = data.results;
                                }
                            }
                        })
                        .catch(err => console.error(`Fetch error for ${key}:`, err));
                },

                // éšç§˜åˆ‡æ¢æ’åºæ¨¡å¼
                toggleSortMode(key) {
                    const config = this.rowConfigs[key];
                    if (!config || !config.path.includes('/discover/')) return;

                    // åˆ‡æ¢æ¨¡å¼
                    config.sortMode = config.sortMode === 'newest' ? 'popular' : 'newest';
                    console.log(`[æ’åºåˆ‡æ¢] ${config.title} -> ${config.sortMode}`);

                    // åŠ¨ç”»æ•ˆæœï¼šå…ˆæ·¡å‡º
                    let rowEl = this.$refs[key];
                    if (Array.isArray(rowEl)) rowEl = rowEl[0];
                    if (rowEl) {
                        rowEl.style.transition = 'opacity 0.2s ease';
                        rowEl.style.opacity = '0.3';
                    }

                    // é‡ç½®é¡µç å¹¶é‡æ–°åŠ è½½
                    config.page = 1;
                    this.fetchRow(key).then(() => {
                        // åŠ¨ç”»æ•ˆæœï¼šæ·¡å…¥
                        if (rowEl) {
                            rowEl.style.opacity = '1';
                            setTimeout(() => { rowEl.style.transition = ''; }, 200);
                        }
                    });

                    // è½»å¾®çš„è§¦è§‰åé¦ˆ (æ‰‹æœºç«¯)
                    if (window.navigator.vibrate) window.navigator.vibrate(10);
                },

                // åˆå§‹åŒ–æ¦œå• (ä¼˜å…ˆåŠ è½½é¦–å±å¯è§æ¦œå•)
                fetchAllLists() {
                    const keys = Object.keys(this.rowConfigs);

                    // è®¾å¤‡æ£€æµ‹ï¼ˆä»…ç”¨äºæ—¥å¿—ï¼‰
                    const viewportWidth = window.innerWidth;
                    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
                    const isMobileUA = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                    const isMobile = viewportWidth < 768 || (isTouchDevice && viewportWidth < 1024) || isMobileUA;

                    console.log(`[è®¾å¤‡æ£€æµ‹] å®½åº¦=${viewportWidth}, è§¦æ‘¸=${isTouchDevice}, UAç§»åŠ¨=${isMobileUA}, åˆ¤å®š=${isMobile ? 'ç§»åŠ¨ç«¯' : 'æ¡Œé¢ç«¯'}`);

                    // æ€§èƒ½ä¼˜åŒ–ï¼šä¼˜å…ˆåŠ è½½é¦–å±å¯è§æ¦œå• (å‰4ä¸ª)
                    const priorityKeys = keys.slice(0, 4);
                    const deferredKeys = keys.slice(4);

                    console.log(`[æ¦œå•åŠ è½½] ä¼˜å…ˆåŠ è½½ ${priorityKeys.length} ä¸ªé¦–å±æ¦œå•`);

                    // ç«‹å³å¹¶è¡ŒåŠ è½½ä¼˜å…ˆæ¦œå•
                    priorityKeys.forEach((key, index) => {
                        setTimeout(() => {
                            this.fetchRow(key);
                        }, index * 100); // æ›´çŸ­çš„é—´éš”
                    });

                    // å»¶è¿ŸåŠ è½½å‰©ä½™æ¦œå• (é¡µé¢ç©ºé—²æ—¶)
                    if (deferredKeys.length > 0) {
                        const loadDeferred = () => {
                            console.log(`[æ¦œå•åŠ è½½] åŠ è½½å‰©ä½™ ${deferredKeys.length} ä¸ªæ¦œå•`);
                            deferredKeys.forEach((key, index) => {
                                setTimeout(() => {
                                    this.fetchRow(key);
                                }, index * 150);
                            });
                        };

                        // ä½¿ç”¨ requestIdleCallback æˆ– setTimeout å»¶è¿ŸåŠ è½½
                        if ('requestIdleCallback' in window) {
                            requestIdleCallback(loadDeferred, { timeout: 2000 });
                        } else {
                            setTimeout(loadDeferred, 1000);
                        }
                    }
                },

                // ğŸ² æ ¸å¿ƒï¼šå…¨ç±»åˆ«éšæœºæ··æ­æŠ“å– (ä¼˜åŒ–ç‰ˆï¼šä½¿ç”¨æ—¥æœŸç§å­ç¡®ä¿ç¼“å­˜å‘½ä¸­)
                async fetchRandomMixed(loadMore = false) {
                    const config = this.rowConfigs.randomRow;
                    if (!config) return Promise.resolve();

                    // ä½¿ç”¨æ—¥æœŸ + å°æ—¶ä½œä¸ºç§å­ï¼ŒåŒä¸€å°æ—¶å†…çš„è¯·æ±‚ä¼šä½¿ç”¨ç›¸åŒçš„å‚æ•°ï¼Œå¯ä»¥å‘½ä¸­ç¼“å­˜
                    const now = new Date();
                    const dateSeed = now.getFullYear() * 10000 + (now.getMonth() + 1) * 100 + now.getDate();
                    const hourSeed = now.getHours();

                    // ç®€å•çš„ä¼ªéšæœºå‡½æ•°ï¼ˆåŸºäºç§å­ï¼‰
                    const seededRandom = (seed, index) => {
                        const x = Math.sin(seed * 9999 + index * 7777) * 10000;
                        return x - Math.floor(x);
                    };

                    // å¦‚æœæ˜¯åŠ è½½æ›´å¤šï¼Œä½¿ç”¨ä¸åŒçš„ç§å­ç»„
                    const seedOffset = loadMore ? (config.loadCount || 0) + 1 : 0;
                    config.loadCount = seedOffset;

                    const randomRequests = [];
                    const types = ['movie', 'tv'];
                    // æ‰€æœ‰ç±»å‹ï¼ˆåŒ…æ‹¬ææ€–å’Œæµªæ¼«ï¼‰ï¼Œé€šè¿‡åˆ†çº§è¿‡æ»¤æ¥æ’é™¤æˆäººå†…å®¹
                    const genres = [28, 35, 10749, 16, 80, 18, 14, 27, 10751, 9648];

                    // æ¯æ¬¡æŠ“å–ç”Ÿæˆ 4 ä¸ªä¸åŒçš„éšæœºæºï¼ˆåŸºäºç§å­ï¼‰
                    for (let i = 0; i < 4; i++) {
                        const baseSeed = dateSeed + hourSeed + seedOffset * 100 + i;

                        const type = types[Math.floor(seededRandom(baseSeed, 1) * types.length)];
                        const page = Math.floor(seededRandom(baseSeed, 2) * 10) + 1;
                        const genreIndex = Math.floor(seededRandom(baseSeed, 3) * genres.length);

                        // ä½¿ç”¨å›ºå®šçš„å‚æ•°ç»„åˆï¼Œç¡®ä¿å¯ç¼“å­˜
                        // æ·»åŠ  include_adult=false è¿‡æ»¤æ˜ç¡®çš„æˆäººå†…å®¹
                        // æ·»åŠ åˆ†çº§è¿‡æ»¤ï¼šç”µå½± PG-13 ä»¥ä¸‹ï¼Œç”µè§† TV-14 ä»¥ä¸‹ï¼ˆæ’é™¤ R çº§ã€NC-17 ç­‰æƒ…è‰²å†…å®¹ï¼‰
                        let adultParam = '';
                        if (this.filterNsfw) {
                            adultParam = '&include_adult=false';
                            if (type === 'movie') {
                                // ç¾å›½ç”µå½±åˆ†çº§ï¼šG, PG, PG-13, R, NC-17ï¼Œåªæ˜¾ç¤º PG-13 åŠä»¥ä¸‹
                                adultParam += '&certification_country=US&certification.lte=PG-13';
                            } else {
                                // ç¾å›½ç”µè§†åˆ†çº§ï¼šTV-Y, TV-Y7, TV-G, TV-PG, TV-14, TV-MAï¼Œåªæ˜¾ç¤º TV-14 åŠä»¥ä¸‹
                                adultParam += '&certification_country=US&certification.lte=TV-14';
                            }
                        }
                        const url = `/api/tmdb-proxy?path=${encodeURIComponent('/discover/' + type)}&page=${page}&sort_by=popularity.desc&with_genres=${genres[genreIndex]}${adultParam}`;
                        randomRequests.push(tmdbFetch(url).then(res => res.json()));
                    }

                    try {
                        const results = await Promise.all(randomRequests);
                        let combined = [];
                        results.forEach(data => {
                            if (data.results) combined.push(...data.results);
                        });

                        // --- ğŸ”€ æ´—ç‰Œç®—æ³• (ä½¿ç”¨ç§å­çš„éšæœºæ´—ç‰Œï¼Œä½†ç»“æœä»ç„¶æ¯æ¬¡ä¸åŒ) ---
                        for (let i = combined.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [combined[i], combined[j]] = [combined[j], combined[i]];
                        }

                        if (!this.rowLists.randomRow || !loadMore) {
                            this.rowLists.randomRow = combined;
                        } else {
                            this.rowLists.randomRow.push(...combined);
                        }

                        // console.log(`[éšæœºç›²ç›’] æˆåŠŸæ··æ­å¹¶æ´—ç‰Œ ${combined.length} æ¡æ•°æ® (ç§å­: ${dateSeed})`);
                    } catch (e) {
                        console.error('[éšæœºç›²ç›’] æ··æ­å¤±è´¥:', e);
                    }
                },

                scrollRow(refName, direction) {
                    let row = this.$refs[refName];
                    if (Array.isArray(row)) row = row[0];
                    if (row) {
                        const scrollAmount = row.clientWidth * 0.6;
                        row.scrollLeft += direction * scrollAmount;
                        if (direction > 0) this.fetchRow(refName, true);
                    }
                },

                fetchHero() {
                    return tmdbFetch(`/api/tmdb-proxy?path=${encodeURIComponent('/trending/all/week')}`)
                        .then(res => res.json())
                        .then(data => {
                            if (data.results) {
                                this.heroList = data.results.filter(i => i.backdrop_path).slice(0, 5).map(item => ({
                                    title: item.title || item.name,
                                    originalTitle: item.original_title || item.original_name || '',  // åŸå§‹æ ‡é¢˜ï¼ˆé€šå¸¸æ˜¯è‹±æ–‡ï¼‰
                                    overview: item.overview || 'ç²¾å½©å†…å®¹ä¸å®¹é”™è¿‡',
                                    backdrop: `${TMDB_BACKDROP_URL}${item.backdrop_path}`,
                                    rawData: item
                                }));
                            }
                        })
                        .catch(e => {
                            console.error('[Hero] åŠ è½½å¤±è´¥:', e);
                            // ä¸æŠ›å‡ºé”™è¯¯ï¼Œå…è®¸ initApp ç»§ç»­æ‰§è¡Œ
                        });
                },

                finalPoster(item, isHot = false) {
                    const name = isHot ? item.vod_name : item.name;
                    return this.imageMap[name] || (isHot ? item.vod_pic : item.pic);
                },
                isFallback(name) { return this.fallbackMap[name] === true; },

                handleImgError(name) {
                    if (this.imageMap[name] || this.fallbackMap[name]) return;
                    this.fallbackMap[name] = true;
                    let cleanName = name.replace(/ç¬¬[0-9ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]+[å­£éƒ¨]/g, '').replace(/Season\s*\d+/ig, '').replace(/S\d{1,2}/ig, '').replace(/(HD|BD|1080P|720P|4K|202\d|TC|TS).*/i, '').trim();
                    tmdbFetch(`/api/tmdb-proxy?path=${encodeURIComponent('/search/multi')}&query=${encodeURIComponent(cleanName)}`)
                        .then(res => res.json()).then(data => {
                            if (data.results && data.results.length > 0) {
                                const found = data.results.find(i => i.poster_path) || data.results[0];
                                if (found.poster_path) {
                                    this.imageMap[name] = `${TMDB_IMG_URL}${found.poster_path}`;
                                    this.fallbackMap[name] = false;
                                }
                            }
                        }).catch(() => { });
                },

                autoSearch(name, originalTitle = '') {
                    this.keyword = name;
                    this._originalTitle = originalTitle;  // ä¿å­˜åŸå§‹æ ‡é¢˜ç”¨äºæœç´¢
                    this.doSearch();
                },
                clearSearch() { this.searched = false; this.keyword = ''; this.rawList = []; this._originalTitle = ''; },
                doSearch() {
                    if (!this.keyword) return;

                    if (this._evtSource) {
                        this._evtSource.close();
                        this._evtSource = null;
                    }

                    this.loading = true;
                    this.searched = true;
                    this.rawList = [];
                    window.scrollTo({ top: 0, behavior: 'smooth' });

                    // TV æ¨¡å¼ï¼šèšç„¦åˆ°è¿”å›é¦–é¡µæŒ‰é’®
                    if (this.isTVMode) {
                        setTimeout(() => {
                            const backBtn = document.querySelector('#search-result-anchor button');
                            if (backBtn) {
                                backBtn.focus();
                                backBtn.setAttribute('tabindex', '1');
                            }
                        }, 100);
                    }

                    // æ„å»ºæœç´¢ URLï¼ŒåŒ…å«åŸå§‹æ ‡é¢˜ç”¨äºæ™ºèƒ½æœç´¢
                    let url = `/api/search?wd=${encodeURIComponent(this.keyword)}&stream=true`;
                    if (this._originalTitle && this._originalTitle !== this.keyword) {
                        url += `&original=${encodeURIComponent(this._originalTitle)}`;
                    }
                    this._evtSource = new EventSource(url);

                    this._evtSource.onmessage = (e) => {
                        try {
                            const newItems = JSON.parse(e.data);
                            if (Array.isArray(newItems) && newItems.length > 0) {
                                this.rawList = this.rawList.concat(newItems);
                                newItems.forEach(item => {
                                    if (!item.vod_pic || item.vod_pic.includes('mac_default')) this.handleImgError(item.vod_name);
                                });
                            }
                        } catch (err) { }
                    };

                    this._evtSource.addEventListener('done', () => {
                        this.loading = false;
                        if (this._evtSource) {
                            this._evtSource.close();
                            this._evtSource = null;
                        }
                    });

                    this._evtSource.onerror = () => {
                        this.loading = false;
                        if (this._evtSource) {
                            this._evtSource.close();
                            this._evtSource = null;
                        }
                    };
                },
                async openDetail(group) {
                    this.currentGroup = group;
                    this.showDetail = true;
                    this.isTestingSources = true;  // å¼€å§‹æµ‹é€Ÿ
                    this.currentSource = null;  // ç¡®ä¿æ¸…ç©ºä¹‹å‰çš„é€‰æ‹©
                    this.episodeList = [];

                    // çœŸå®ç”¨æˆ·ç«¯æµ‹é€Ÿï¼šè·å–æ¯ä¸ªçº¿è·¯çš„è§†é¢‘URLï¼Œç›´æ¥ä»ç”¨æˆ·ç«¯æµ‹è¯•m3u8å»¶è¿Ÿ
                    // è¿™æ ·èƒ½çœŸæ­£åæ˜ ç”¨æˆ·æ˜¯å¦å¯ä»¥è®¿é—®è¯¥è§†é¢‘æº

                    // å¿«é€Ÿè¿”å›æ ‡å¿—ï¼šä¸€æ—¦æœ‰2+å¿«é€Ÿçº¿è·¯ï¼Œç«‹å³è‡ªåŠ¨é€‰æ‹©æœ€å¿«çš„
                    let hasAutoSelected = false;
                    const FAST_THRESHOLD = 600;  // å¿«é€Ÿçº¿è·¯é˜ˆå€¼ (ms)
                    const EARLY_RETURN_COUNT = 2;  // æœ‰å‡ ä¸ªå¿«é€Ÿçº¿è·¯åæå‰è¿”å›
                    const MAX_WAIT_TIME = 3000;  // æœ€é•¿ç­‰å¾…æ—¶é—´ (ms)

                    // æ£€æŸ¥æ˜¯å¦å¯ä»¥æå‰è¿”å› - ä¼˜å…ˆç”¨æˆ·ç«¯æµ‹é€Ÿç»“æœ
                    const checkEarlyReturn = () => {
                        if (hasAutoSelected) return;

                        // ä¼˜å…ˆæ£€æŸ¥ç”¨æˆ·ç«¯æµ‹é€Ÿ(direct)çš„å¿«é€Ÿçº¿è·¯
                        const directFastSources = this.currentGroup.sources.filter(s =>
                            s._testType === 'direct' && typeof s.latency === 'number' && s.latency < FAST_THRESHOLD
                        );

                        if (directFastSources.length >= EARLY_RETURN_COUNT) {
                            hasAutoSelected = true;
                            directFastSources.sort((a, b) => a.latency - b.latency);
                            console.log(`[å¿«é€Ÿè¿”å›] å·²æ‰¾åˆ° ${directFastSources.length} ä¸ªç”¨æˆ·ç«¯å¿«é€Ÿçº¿è·¯ï¼Œè‡ªåŠ¨é€‰æ‹©: ${directFastSources[0].site_name} (${directFastSources[0].latency}ms ğŸ¬)`);
                            this.switchSource(directFastSources[0]);
                        }
                    };

                    // è¶…æ—¶è‡ªåŠ¨é€‰æ‹©ï¼ˆä¼˜å…ˆç”¨æˆ·ç«¯æµ‹é€Ÿï¼Œå…¶æ¬¡æœåŠ¡å™¨ç«¯ï¼‰
                    const earlyReturnTimer = setTimeout(() => {
                        if (hasAutoSelected) return;
                        hasAutoSelected = true;

                        // ä¼˜å…ˆé€‰æ‹©ç”¨æˆ·ç«¯æµ‹é€Ÿçš„ç»“æœ
                        let directSources = this.currentGroup.sources.filter(s =>
                            s._testType === 'direct' && typeof s.latency === 'number' && s.latency < 9000
                        );

                        if (directSources.length > 0) {
                            directSources.sort((a, b) => a.latency - b.latency);
                            console.log(`[è¶…æ—¶è¿”å›] é€‰æ‹©ç”¨æˆ·ç«¯æµ‹é€Ÿæœ€å¿«çš„: ${directSources[0].site_name} (${directSources[0].latency}ms ğŸ¬)`);
                            this.switchSource(directSources[0]);
                            return;
                        }

                        // æ²¡æœ‰ç”¨æˆ·ç«¯æµ‹é€Ÿç»“æœï¼Œå›é€€åˆ°æœåŠ¡å™¨ç«¯
                        const testedSources = this.currentGroup.sources.filter(s =>
                            typeof s.latency === 'number' && s.latency < 9000
                        );

                        if (testedSources.length > 0) {
                            testedSources.sort((a, b) => a.latency - b.latency);
                            console.log(`[è¶…æ—¶è¿”å›] ${MAX_WAIT_TIME}msåè‡ªåŠ¨é€‰æ‹©: ${testedSources[0].site_name} (${testedSources[0].latency}ms)`);
                            this.switchSource(testedSources[0]);
                        }
                    }, MAX_WAIT_TIME);

                    const latencyPromises = this.currentGroup.sources.map(async (source) => {
                        source.latency = '...';
                        source._useProxy = false;  // é»˜è®¤ä¸ä½¿ç”¨ä»£ç†
                        try {
                            // 1. å…ˆè·å–è¯¥çº¿è·¯çš„è§†é¢‘è¯¦æƒ…
                            const detailRes = await fetch(`/api/detail?site_key=${source.site_key}&id=${source.vod_id}`);
                            const detailData = await detailRes.json();

                            if (!detailData.list || detailData.list.length === 0) {
                                source.latency = 9999;
                                return source;
                            }

                            // 2. è§£æå‡ºç¬¬ä¸€ä¸ª m3u8 è§†é¢‘ URL
                            const detail = detailData.list[0];
                            let playUrl = detail.vod_play_url || '';

                            // å¤„ç†å¤šçº¿è·¯æ ¼å¼ (ç”¨ $$$ åˆ†éš”)
                            if (playUrl.includes('$$$')) {
                                const sets = playUrl.split('$$$');
                                playUrl = sets.find(s => s.toLowerCase().includes('m3u8')) || sets[0];
                            }

                            // è·å–ç¬¬ä¸€ä¸ªè§†é¢‘URL
                            const firstEp = playUrl.split('#')[0];
                            const parts = firstEp.split('$');
                            const videoUrl = parts.length > 1 ? parts[1] : parts[0];

                            if (!videoUrl || !videoUrl.startsWith('http')) {
                                source.latency = 9999;
                                return source;
                            }

                            // æ£€æŸ¥æ··åˆå†…å®¹ï¼šå¦‚æœé¡µé¢æ˜¯ HTTPS ä½†è§†é¢‘ URL æ˜¯ HTTPï¼Œå›é€€åˆ°æœåŠ¡å™¨ç«¯æµ‹é€Ÿ
                            const isPageHttps = window.location.protocol === 'https:';
                            const isVideoHttp = videoUrl.startsWith('http:');

                            if (isPageHttps && isVideoHttp) {
                                // æ··åˆå†…å®¹ï¼Œæ— æ³•ç›´æ¥æµ‹è¯•ï¼Œå›é€€åˆ°æœåŠ¡å™¨ç«¯å»¶è¿Ÿ
                                console.log(`[æ··åˆå†…å®¹] ${source.site_name} è§†é¢‘URLä¸ºHTTPï¼Œå›é€€åˆ°æœåŠ¡å™¨æµ‹é€Ÿ`);
                                const checkRes = await fetch(`/api/check?key=${source.site_key}`);
                                const checkData = await checkRes.json();
                                source.latency = checkData.latency;
                                source._testType = 'server';  // æœåŠ¡å™¨ç«¯æµ‹é€Ÿ
                                source._cachedDetail = detail;
                                checkEarlyReturn();
                                return source;
                            }

                            // 3. ç”¨æˆ·ç«¯ç›´æ¥æµ‹è¯• m3u8 URL çš„å»¶è¿Ÿ
                            let directSuccess = false;
                            let directLatency = 0;
                            const startTime = Date.now();
                            const SLOW_THRESHOLD = 1500; // è¶…è¿‡æ­¤å»¶è¿Ÿè§†ä¸ºæ…¢é€Ÿ

                            try {
                                const controller = new AbortController();
                                const timeoutId = setTimeout(() => controller.abort(), 5000);

                                // m3u8 æ–‡ä»¶é€šå¸¸é…ç½®äº† CORSï¼Œå¯ä»¥ç›´æ¥ fetch
                                const testRes = await fetch(videoUrl, {
                                    method: 'GET',
                                    cache: 'no-cache',
                                    signal: controller.signal
                                });

                                clearTimeout(timeoutId);

                                if (testRes.ok || testRes.type === 'cors') {
                                    directLatency = Date.now() - startTime;
                                    source.latency = directLatency;
                                    directSuccess = true;
                                }
                            } catch (directError) {
                                // ç›´æ¥è®¿é—®å¤±è´¥ï¼Œç¨åå°è¯•ä»£ç†
                                console.log(`[ç›´æ¥è®¿é—®å¤±è´¥] ${source.site_name}: ${directError.message}`);
                            }

                            // 4. å¦‚æœç›´æ¥è®¿é—®å¤±è´¥ï¼Œæˆ–è€…å»¶è¿Ÿå¤ªé«˜ï¼Œå°è¯•ä»£ç†
                            const shouldTryProxy = !directSuccess || (directSuccess && directLatency > SLOW_THRESHOLD);

                            if (shouldTryProxy && this.corsProxyUrl) {
                                try {
                                    const proxyUrl = `${this.corsProxyUrl}/?url=${encodeURIComponent(videoUrl)}`;
                                    const proxyStartTime = Date.now();
                                    const proxyController = new AbortController();
                                    const proxyTimeoutId = setTimeout(() => proxyController.abort(), 6000);

                                    const proxyTestRes = await fetch(proxyUrl, {
                                        method: 'GET',
                                        cache: 'no-cache',
                                        signal: proxyController.signal
                                    });

                                    clearTimeout(proxyTimeoutId);

                                    if (proxyTestRes.ok) {
                                        const proxyLatency = Date.now() - proxyStartTime;

                                        // å¦‚æœç›´è¿å¤±è´¥ï¼Œä½¿ç”¨ä»£ç†
                                        // å¦‚æœç›´è¿æˆåŠŸä½†ä»£ç†æ›´å¿«ï¼ˆè‡³å°‘å¿« 30%ï¼‰ï¼Œä½¿ç”¨ä»£ç†
                                        const useProxy = !directSuccess || (proxyLatency < directLatency * 0.7);

                                        if (useProxy) {
                                            source.latency = proxyLatency;
                                            source._useProxy = true;  // æ ‡è®°éœ€è¦ä½¿ç”¨ä»£ç†
                                            source._proxyUrl = this.corsProxyUrl;

                                            if (directSuccess) {
                                                console.log(`[ä»£ç†æ›´å¿«] ${source.site_name} (${proxyLatency}ms vs ç›´è¿ ${directLatency}ms)`);
                                            } else {
                                                console.log(`[ä»£ç†æˆåŠŸ] ${source.site_name} é€šè¿‡ä»£ç†è®¿é—® (${proxyLatency}ms)`);
                                            }
                                            directSuccess = true;
                                        } else {
                                            console.log(`[ç›´è¿æ›´ä¼˜] ${source.site_name} ç›´è¿ ${directLatency}ms vs ä»£ç† ${proxyLatency}ms`);
                                        }
                                    }
                                } catch (proxyError) {
                                    console.log(`[ä»£ç†å¤±è´¥] ${source.site_name}: ${proxyError.message}`);
                                }
                            }

                            // 5. å¦‚æœä»ç„¶å¤±è´¥ï¼Œå›é€€åˆ°æœåŠ¡å™¨ç«¯æµ‹é€Ÿ
                            if (!directSuccess) {
                                try {
                                    const checkRes = await fetch(`/api/check?key=${source.site_key}`);
                                    const checkData = await checkRes.json();
                                    source.latency = checkData.latency;
                                    source._testType = 'server';
                                } catch (e) {
                                    source.latency = 9999;
                                }
                            } else {
                                source._testType = source._useProxy ? 'proxy' : 'direct';
                            }

                            // ç¼“å­˜è¯¦æƒ…æ•°æ®ï¼Œåç»­åˆ‡æ¢æ—¶å¯ä»¥å¤ç”¨
                            source._cachedDetail = detail;

                            // æ¯å®Œæˆä¸€ä¸ªæµ‹é€Ÿå°±æ£€æŸ¥æ˜¯å¦å¯ä»¥æå‰è¿”å›
                            checkEarlyReturn();

                        } catch (e) {
                            // è·å–è¯¦æƒ…å¤±è´¥çš„å…œåº•å¤„ç†
                            if (e.name !== 'AbortError') {
                                try {
                                    const detailRes = await fetch(`/api/detail?site_key=${source.site_key}&id=${source.vod_id}`);
                                    const detailData = await detailRes.json();
                                    if (detailData.list && detailData.list.length > 0) {
                                        source._cachedDetail = detailData.list[0];
                                        // æ— æ³•ç›´æ¥æµ‹è¯•ï¼Œå›é€€åˆ°æœåŠ¡å™¨ç«¯å»¶è¿Ÿ
                                        const checkRes = await fetch(`/api/check?key=${source.site_key}`);
                                        const checkData = await checkRes.json();
                                        source.latency = checkData.latency;
                                        source._testType = 'server';  // æœåŠ¡å™¨ç«¯æµ‹é€Ÿ
                                        checkEarlyReturn();
                                    } else {
                                        source.latency = 9999;
                                    }
                                } catch (e2) {
                                    source.latency = 9999;
                                }
                            } else {
                                source.latency = 9999;  // è¶…æ—¶
                            }
                        }
                        return source;
                    });

                    // ç­‰å¾…æ‰€æœ‰æµ‹é€Ÿå®Œæˆï¼ˆåå°ç»§ç»­ï¼‰
                    await Promise.all(latencyPromises);
                    clearTimeout(earlyReturnTimer);
                    this.isTestingSources = false;  // æµ‹é€Ÿå®Œæˆ

                    // æŒ‰å»¶è¿Ÿæ’åº (ä½åˆ°é«˜)
                    this.currentGroup.sources.sort((a, b) => {
                        const latA = typeof a.latency === 'number' ? a.latency : 9999;
                        const latB = typeof b.latency === 'number' ? b.latency : 9999;
                        return latA - latB;
                    });

                    // å¦‚æœå·²ç»æœ‰é€‰ä¸­çš„æºå¹¶ä¸”è§†é¢‘å·²å¼€å§‹æ’­æ”¾ï¼Œä¸å†è‡ªåŠ¨åˆ‡æ¢
                    // è¿™æ ·ä¸ä¼šæ‰“æ–­ç”¨æˆ·æ­£åœ¨è§‚çœ‹çš„å†…å®¹
                    if (hasAutoSelected && this.currentSource && this.currentUrl) {
                        console.log(`[æµ‹é€Ÿå®Œæˆ] ä¿æŒå½“å‰çº¿è·¯: ${this.currentSource.site_name}ï¼Œä¸è‡ªåŠ¨åˆ‡æ¢`);
                        return;
                    }

                    // å¦‚æœè¿˜æ²¡æœ‰é€‰æ‹©ä»»ä½•æºï¼Œé€‰æ‹©æœ€å¿«çš„
                    if (!hasAutoSelected) {
                        // ä¼˜å…ˆé€‰æ‹©ç”¨æˆ·ç«¯æµ‹é€Ÿ(direct)çš„ç»“æœ
                        const directSources = this.currentGroup.sources.filter(s =>
                            s._testType === 'direct' && typeof s.latency === 'number' && s.latency < 9000
                        );

                        if (directSources.length > 0) {
                            console.log(`[æµ‹é€Ÿå®Œæˆ] é€‰æ‹©ç”¨æˆ·ç«¯æµ‹é€Ÿæœ€å¿«çš„çº¿è·¯: ${directSources[0].site_name} (${directSources[0].latency}ms)`);
                            this.switchSource(directSources[0]);
                        } else {
                            // å›é€€åˆ°æœåŠ¡å™¨ç«¯æµ‹é€Ÿæœ€å¿«çš„
                            const fastestAvailable = this.currentGroup.sources.find(s =>
                                typeof s.latency === 'number' && s.latency < 9000
                            );
                            if (fastestAvailable) {
                                console.log(`[æµ‹é€Ÿå®Œæˆ] é€‰æ‹©æœåŠ¡å™¨æµ‹é€Ÿæœ€å¿«çš„çº¿è·¯: ${fastestAvailable.site_name} (${fastestAvailable.latency}ms)`);
                                this.switchSource(fastestAvailable);
                            }
                        }
                    }
                    // å¦‚æœå…¨éƒ¨ä¸å¯ç”¨ï¼Œä¸è‡ªåŠ¨é€‰æ‹©ï¼ŒUIä¼šæ˜¾ç¤ºæç¤º
                },
                closeDetail() {
                    this.showDetail = false;
                    if (dp) dp.pause();

                    // é‡Šæ”¾å±å¹•å¸¸äº®
                    this.releaseWakeLock();

                    // TV æ¨¡å¼ï¼šç§»é™¤æ§åˆ¶æ 
                    const tvControls = document.getElementById('tv-controls');
                    if (tvControls) tvControls.remove();
                    const tvBottomControls = document.getElementById('tv-bottom-controls');
                    if (tvBottomControls) tvBottomControls.remove();
                    const tvEpisodePopup = document.getElementById('tv-episode-popup');
                    if (tvEpisodePopup) tvEpisodePopup.remove();

                    // é€€å‡ºå…¨å±æ¨¡å¼
                    if (document.fullscreenElement) {
                        document.exitFullscreen().catch(() => { });
                    }

                    // é‡ç½®é¡µé¢æ»šåŠ¨ä½ç½®
                    window.scrollTo(0, 0);
                    document.body.style.overflow = '';
                    document.documentElement.style.overflow = '';
                },
                async switchSource(source) {
                    this.currentSource = source;
                    this.loadingDetail = true;

                    // è®°ä½å½“å‰é›†æ•°åç§°ï¼Œåˆ‡æ¢åå°è¯•ä¿ç•™ï¼ˆåœ¨æ¸…ç©ºä¹‹å‰è·å–ï¼ï¼‰
                    const previousEpName = this.episodeList?.find(ep => ep.url === this.currentUrl)?.name;
                    console.log('[åˆ‡æ¢èµ„æº] å½“å‰é›†æ•°:', previousEpName);

                    this.episodeList = [];

                    try {

                        // å¦‚æœ source å·²ç»æœ‰ vod_play_urlï¼ˆæ¥è‡ªå†å²è®°å½•ï¼‰ï¼Œç›´æ¥ä½¿ç”¨
                        if (source.vod_play_url) {
                            console.log('[åˆ‡æ¢èµ„æº] ä½¿ç”¨å·²æœ‰çš„ vod_play_url');
                            this.parseEpisodes(source.vod_play_url, previousEpName);
                            this.loadingDetail = false;
                            return;
                        }

                        // ä¼˜å…ˆä½¿ç”¨æµ‹é€Ÿæ—¶ç¼“å­˜çš„è¯¦æƒ…æ•°æ®
                        let detail = source._cachedDetail;

                        if (!detail) {
                            // å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œé‡æ–°è·å–
                            const res = await fetch(`/api/detail?site_key=${source.site_key}&id=${source.vod_id}`);
                            const data = await res.json();
                            if (data.list && data.list.length > 0) {
                                detail = data.list[0];
                            }
                        }

                        if (detail) {
                            // ä¿å­˜ç®€ä»‹ä¿¡æ¯åˆ°å½“å‰æº
                            this.currentSource.vod_content = detail.vod_content || detail.vod_blurb || '';
                            this.parseEpisodes(detail.vod_play_url, previousEpName);
                        }
                    } catch (e) { console.log('[åˆ‡æ¢èµ„æº] é”™è¯¯:', e); }
                    this.loadingDetail = false;
                },

                // è§£æå‰§é›†åˆ—è¡¨ï¼Œå°è¯•åŒ¹é…æŒ‡å®šé›†æ•°
                parseEpisodes(urlStr, targetEpName) {
                    let playSource = urlStr;
                    if (urlStr.includes('$$$')) {
                        const sets = urlStr.split('$$$');
                        playSource = sets.find(s => s.toLowerCase().includes('m3u8')) || sets[0];
                    }
                    this.episodeList = playSource.split('#').map(ep => {
                        const p = ep.split('$');
                        return { name: p.length > 1 ? p[0] : 'æ­£ç‰‡', url: p.length > 1 ? p[1] : p[0] };
                    });

                    if (this.episodeList.length > 0) {
                        // å°è¯•æ‰¾åˆ°ä¸ä¹‹å‰ç›¸åŒåç§°çš„é›†æ•°
                        let targetEp = this.episodeList[0];
                        if (targetEpName) {
                            // æ ‡å‡†åŒ–é›†æ•°åç§°è¿›è¡ŒåŒ¹é…
                            const normalize = (name) => name?.replace(/ç¬¬0*(\d+)é›†/g, 'ç¬¬$1é›†') || '';
                            const normalizedTarget = normalize(targetEpName);

                            const found = this.episodeList.find(ep => normalize(ep.name) === normalizedTarget);
                            if (found) {
                                targetEp = found;
                                console.log('[åˆ‡æ¢èµ„æº] æ‰¾åˆ°åŒ¹é…é›†æ•°:', targetEp.name);
                            } else {
                                console.log('[åˆ‡æ¢èµ„æº] æœªæ‰¾åˆ°åŒ¹é…é›†æ•°:', targetEpName, 'ä½¿ç”¨ç¬¬ä¸€é›†');
                            }
                        }
                        this.play(targetEp.url);
                    }
                },
                play(url) {
                    this.currentUrl = url;
                    this.playbackErrorCount = 0;  // é‡ç½®é”™è¯¯è®¡æ•°

                    // ğŸ”† æ’­æ”¾æ—¶ä¿æŒå±å¹•å¸¸äº®
                    this.requestWakeLock();

                    console.log('[æ’­æ”¾å™¨] play() è¢«è°ƒç”¨');
                    console.log('[æ’­æ”¾å™¨] URL:', url?.substring(0, 50) + '...');
                    console.log('[æ’­æ”¾å™¨] currentGroup:', this.currentGroup?.name);
                    console.log('[æ’­æ”¾å™¨] episodeListé•¿åº¦:', this.episodeList?.length);
                    console.log('[æ’­æ”¾å™¨] dpå·²å­˜åœ¨:', !!dp);

                    // æ£€æŸ¥å½“å‰çº¿è·¯æ˜¯å¦éœ€è¦ä½¿ç”¨ä»£ç†
                    let finalUrl = url;
                    if (this.currentSource && this.currentSource._useProxy && this.currentSource._proxyUrl) {
                        finalUrl = `${this.currentSource._proxyUrl}/?url=${encodeURIComponent(url)}`;
                        console.log('[æ’­æ”¾å™¨] ğŸŒ ä½¿ç”¨ä»£ç†æ’­æ”¾:', finalUrl.substring(0, 80) + '...');
                    }

                    const setupErrorHandling = () => {
                        // ç›‘å¬æ’­æ”¾é”™è¯¯ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªå¯ç”¨çº¿è·¯
                        dp.on('error', () => {
                            this.handlePlaybackError();
                        });

                        // ç›‘å¬ HLS é”™è¯¯
                        if (dp.video) {
                            dp.video.addEventListener('error', () => {
                                this.handlePlaybackError();
                            });
                        }
                    };

                    if (!dp) {
                        console.log('[æ’­æ”¾å™¨] åˆ›å»ºæ–°çš„ DPlayer å®ä¾‹');
                        dp = new DPlayer({
                            container: document.getElementById('dplayer'),
                            theme: '#e50914',
                            lang: 'zh-cn',           // ä¸­æ–‡ç•Œé¢
                            hotkey: true,            // å¿«æ·é”®æ”¯æŒ
                            preload: 'auto',         // è‡ªåŠ¨é¢„åŠ è½½
                            volume: 0.8,             // é»˜è®¤éŸ³é‡ 80%
                            loop: false,             // å¾ªç¯æ’­æ”¾ï¼ˆå¯åœ¨è®¾ç½®ä¸­åˆ‡æ¢ï¼‰
                            playbackSpeed: [0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 3],  // 0.25é—´éš”å€é€Ÿé€‰é¡¹
                            video: { url: finalUrl, type: 'hls' },
                            contextmenu: [
                                { text: 'ğŸ¬ Eè§†ç•ŒMAX', link: '/' },
                                { text: 'âš¡ å½“å‰é€Ÿåº¦: 1x', click: () => { } }
                            ]
                        });

                        // ç›‘å¬å€é€Ÿå˜åŒ–ï¼Œæ›´æ–° UI
                        if (dp.video) {
                            dp.video.addEventListener('ratechange', () => {
                                const speed = dp.video.playbackRate;
                                // ğŸ’¾ è®°ä½ç”¨æˆ·é€‰æ‹©çš„å€é€Ÿ
                                try { localStorage.setItem('dplayer_speed', speed); } catch (e) { }

                                const dplayerContainer = document.getElementById('dplayer');

                                // 1. æ›´æ–°å³é”®èœå•æ–‡æœ¬
                                const menuItems = dplayerContainer.querySelectorAll('.dplayer-menu-item a');
                                menuItems.forEach(item => {
                                    if (item.textContent.includes('å½“å‰é€Ÿåº¦')) {
                                        item.textContent = `âš¡ å½“å‰é€Ÿåº¦: ${speed}x`;
                                    }
                                });

                                // 2. æ˜¾ç¤ºå€é€Ÿæµ®å±‚æç¤º
                                const indicator = dplayerContainer.querySelector('.dplayer-speed-indicator');
                                if (indicator) {
                                    indicator.innerText = `å€é€Ÿ: ${speed}x`;
                                    indicator.classList.add('show');
                                    clearTimeout(indicator.hideTimer);
                                    indicator.hideTimer = setTimeout(() => {
                                        indicator.classList.remove('show');
                                    }, 1500);
                                }

                                // 3. å¼ºåˆ¶æ›´æ–°è®¾ç½®é¢æ¿ä¸­çš„é«˜äº®çŠ¶æ€
                                const speedItems = dplayerContainer.querySelectorAll('.dplayer-setting-speed-item');
                                speedItems.forEach(item => {
                                    // DPlayer çš„ item åŒ…å« data-speed å±æ€§
                                    const itemSpeed = parseFloat(item.dataset.speed);
                                    if (itemSpeed && Math.abs(itemSpeed - speed) < 0.01) {
                                        item.classList.add('dplayer-setting-speed-current');
                                    } else {
                                        item.classList.remove('dplayer-setting-speed-current');
                                    }
                                });
                            });
                        }

                        // ğŸ“± å…¨å±äº‹ä»¶ç›‘å¬ - ä½¿ç”¨ Capacitor æ’ä»¶å¤„ç†æ—‹è½¬å’ŒçŠ¶æ€æ 
                        const handleEnterFullscreen = async () => {
                            console.log('[DPlayer] è¿›å…¥å…¨å±');

                            // 1. éšè—å¯¼èˆªæ 
                            const navbar = document.querySelector('.navbar-custom');
                            if (navbar) navbar.style.display = 'none';

                            // 2. ä½¿ç”¨ Capacitor æ’ä»¶
                            if (window.Capacitor && window.Capacitor.isNativePlatform && window.Capacitor.isNativePlatform()) {
                                try {
                                    // éšè—çŠ¶æ€æ å¹¶è®© WebView è¦†ç›–çŠ¶æ€æ åŒºåŸŸ
                                    const { StatusBar } = window.Capacitor.Plugins;
                                    if (StatusBar) {
                                        // å…ˆè®© WebView è¦†ç›–çŠ¶æ€æ åŒºåŸŸ
                                        await StatusBar.setOverlaysWebView({ overlay: true });
                                        // ç„¶åéšè—çŠ¶æ€æ 
                                        await StatusBar.hide();
                                        console.log('[Fullscreen] çŠ¶æ€æ å·²éšè—ï¼ŒWebView å·²æ‰©å±•');
                                    }
                                } catch (e) { console.warn('StatusBar error:', e); }

                                try {
                                    // é”å®šæ¨ªå±
                                    const { ScreenOrientation } = window.Capacitor.Plugins;
                                    if (ScreenOrientation) {
                                        await ScreenOrientation.lock({ orientation: 'landscape' });
                                        console.log('[Fullscreen] å·²é”å®šæ¨ªå±');
                                    }
                                } catch (e) { console.warn('ScreenOrientation error:', e); }
                            }

                            // 3. Web API fallback
                            try {
                                if (screen.orientation && screen.orientation.lock) {
                                    await screen.orientation.lock('landscape').catch(() => { });
                                }
                            } catch (e) { }
                        };

                        const handleExitFullscreen = async () => {
                            console.log('[DPlayer] é€€å‡ºå…¨å±');

                            // 1. æ¢å¤å¯¼èˆªæ 
                            const navbar = document.querySelector('.navbar-custom');
                            if (navbar) navbar.style.display = '';

                            // 2. ä½¿ç”¨ Capacitor æ’ä»¶
                            if (window.Capacitor && window.Capacitor.isNativePlatform && window.Capacitor.isNativePlatform()) {
                                try {
                                    // æ¢å¤çŠ¶æ€æ 
                                    const { StatusBar } = window.Capacitor.Plugins;
                                    if (StatusBar) {
                                        // å…ˆæ˜¾ç¤ºçŠ¶æ€æ 
                                        await StatusBar.show();
                                        // æ¢å¤ WebView ä¸è¦†ç›–çŠ¶æ€æ 
                                        await StatusBar.setOverlaysWebView({ overlay: false });
                                        console.log('[Fullscreen] çŠ¶æ€æ å·²æ¢å¤');
                                    }
                                } catch (e) { console.warn('StatusBar error:', e); }

                                try {
                                    // è§£é”å±å¹•æ–¹å‘
                                    const { ScreenOrientation } = window.Capacitor.Plugins;
                                    if (ScreenOrientation) {
                                        await ScreenOrientation.unlock();
                                        console.log('[Fullscreen] å±å¹•æ–¹å‘å·²è§£é”');
                                    }
                                } catch (e) { console.warn('ScreenOrientation error:', e); }
                            }

                            // 3. Web API fallback
                            try {
                                if (screen.orientation && screen.orientation.unlock) {
                                    screen.orientation.unlock();
                                }
                            } catch (e) { }
                        };

                        dp.on('fullscreen', handleEnterFullscreen);
                        dp.on('fullscreen_cancel', handleExitFullscreen);

                        // ä¹Ÿç›‘å¬ web fullscreen äº‹ä»¶
                        dp.on('webfullscreen', handleEnterFullscreen);
                        dp.on('webfullscreen_cancel', handleExitFullscreen);

                        // ========== ğŸ”§ è®¾ç½®èœå•ä¿®å¤ ==========
                        setTimeout(() => {
                            const dplayerContainer = document.getElementById('dplayer');
                            const settingBox = dplayerContainer.querySelector('.dplayer-setting-box');
                            const mask = dplayerContainer.querySelector('.dplayer-mask');

                            if (settingBox && mask) {
                                // ä½¿ç”¨ MutationObserver ç›‘æ§è®¾ç½®èœå•çš„æ‰“å¼€/å…³é—­çŠ¶æ€
                                const observer = new MutationObserver((mutations) => {
                                    mutations.forEach((mutation) => {
                                        if (mutation.attributeName === 'class') {
                                            const isOpen = settingBox.classList.contains('dplayer-setting-box-open');
                                            // å½“è®¾ç½®èœå•æ‰“å¼€æ—¶ï¼Œç¦ç”¨é®ç½©å±‚çš„ç‚¹å‡»äº‹ä»¶
                                            mask.style.pointerEvents = isOpen ? 'none' : 'auto';
                                            console.log('[Settings] Menu ' + (isOpen ? 'OPENED - mask disabled' : 'CLOSED - mask enabled'));

                                            // æ‰“å¼€èœå•æ—¶ï¼Œå¼ºåˆ¶åˆ·æ–°ä¸€æ¬¡å€é€Ÿé«˜äº®
                                            try {
                                                if (isOpen && typeof dp !== 'undefined' && dp && dp.video) {
                                                    const speed = dp.video.playbackRate;
                                                    const dplayerContainer = document.getElementById('dplayer');
                                                    if (dplayerContainer) {
                                                        const speedItems = dplayerContainer.querySelectorAll('.dplayer-setting-speed-item');
                                                        speedItems.forEach(item => {
                                                            const itemSpeed = parseFloat(item.dataset.speed);
                                                            if (itemSpeed && Math.abs(itemSpeed - speed) < 0.01) {
                                                                item.classList.add('dplayer-setting-speed-current');
                                                            } else {
                                                                item.classList.remove('dplayer-setting-speed-current');
                                                            }
                                                        });
                                                    }
                                                }
                                            } catch (e) { console.warn('Highlight update failed:', e); }

                                            // åˆå§‹åŒ–/æ˜¾ç¤ºè·³è¿‡ç‰‡å¤´ç‰‡å°¾ UI
                                            if (isOpen && window.skipManager) {
                                                window.skipManager.initUI();
                                            }
                                            // åˆå§‹åŒ–å¹¿å‘Šè¿‡æ»¤ UI
                                            if (isOpen && window.AdFilter && window.AdFilter.initUI) {
                                                window.AdFilter.initUI();
                                            }
                                        }
                                    });
                                });

                                observer.observe(settingBox, { attributes: true });

                                // ========== âœ¨ è·³è¿‡ç‰‡å¤´ç‰‡å°¾ç®¡ç†å™¨ ==========
                                window.skipManager = {
                                    vue: this,
                                    config: { intro: 0, outro: 0, enabled: false },
                                    hasSkippedIntro: false,
                                    hasSkippedOutro: false,

                                    getKey() {
                                        const vodName = this.vue.currentGroup?.name || 'default';
                                        const safeName = vodName.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_');
                                        return `skip_config_${safeName}`;
                                    },
                                    load() {
                                        try {
                                            const saved = localStorage.getItem(this.getKey());
                                            if (saved) this.config = JSON.parse(saved);
                                            else this.config = { intro: 0, outro: 0, enabled: false };
                                        } catch (e) { }
                                        this.hasSkippedIntro = false;
                                        this.hasSkippedOutro = false;
                                        this.updateUI();
                                    },
                                    save() {
                                        localStorage.setItem(this.getKey(), JSON.stringify(this.config));
                                        this.updateUI();
                                    },
                                    formatTime(seconds) {
                                        if (!seconds) return 'ç‚¹å‡»è®¾å®š';
                                        const m = Math.floor(seconds / 60);
                                        const s = Math.floor(seconds % 60);
                                        return `${m}:${s.toString().padStart(2, '0')}`;
                                    },
                                    setIntro() {
                                        if (!dp.video) return;
                                        const time = Math.floor(dp.video.currentTime);
                                        if (dp.video.duration && time > dp.video.duration * 0.5) {
                                            dp.notice('ç‰‡å¤´æ—¶é—´ä¸èƒ½è¶…è¿‡è§†é¢‘æ—¶é•¿çš„ä¸€åŠ', 2000);
                                            return;
                                        }
                                        this.config.intro = time;
                                        this.config.enabled = true;
                                        this.save();
                                        dp.notice(`å·²è®¾ç½®ç‰‡å¤´æˆªæ­¢ç‚¹: ${this.formatTime(this.config.intro)}`);
                                    },
                                    setOutro() {
                                        if (!dp.video) return;
                                        const time = Math.floor(dp.video.currentTime);
                                        if (dp.video.duration && time < dp.video.duration * 0.5) {
                                            dp.notice('ç‰‡å°¾èµ·ç‚¹é€šå¸¸åœ¨è§†é¢‘ååŠéƒ¨åˆ†ï¼Œè¯·æ‹–åŠ¨è¿›åº¦æ¡åå†è®¾ç½®', 3000);
                                            return;
                                        }
                                        if (this.config.intro > 0 && time <= this.config.intro) {
                                            dp.notice('ç‰‡å°¾æ—¶é—´å¿…é¡»æ™šäºç‰‡å¤´', 2000);
                                            return;
                                        }
                                        this.config.outro = time;
                                        this.config.enabled = true;
                                        this.save();
                                        dp.notice(`å·²è®¾ç½®ç‰‡å°¾èµ·ç‚¹: ${this.formatTime(this.config.outro)}`);
                                    },
                                    clear() {
                                        this.config = { intro: 0, outro: 0, enabled: false };
                                        this.save();
                                        dp.notice('å·²æ¸…é™¤è·³è¿‡é…ç½®');
                                    },
                                    updateUI() {
                                        const group = document.querySelector('.dplayer-setting-skip-group');
                                        if (!group) return;
                                        const toggleBg = group.querySelector('.dplayer-toggle-icon');
                                        const toggleKnob = group.querySelector('.toggle-knob');
                                        if (toggleBg && toggleKnob) {
                                            if (this.config.enabled) {
                                                toggleBg.style.background = '#e50914';
                                                toggleKnob.style.transform = 'translateX(18px)';
                                            } else {
                                                toggleBg.style.background = 'rgba(255,255,255,0.2)';
                                                toggleKnob.style.transform = 'translateX(0)';
                                            }
                                        }
                                        const introVal = group.querySelector('.intro-val');
                                        if (introVal) introVal.textContent = this.formatTime(this.config.intro);
                                        const outroVal = group.querySelector('.outro-val');
                                        if (outroVal) outroVal.textContent = this.formatTime(this.config.outro);
                                    },
                                    initUI() {
                                        const panel = document.querySelector('.dplayer-setting-origin-panel');
                                        if (!panel || panel.querySelector('.dplayer-setting-skip-group')) {
                                            if (panel) this.updateUI();
                                            return;
                                        }
                                        const html = `
                                            <div class="dplayer-setting-skip-group" style="border-top: 1px solid rgba(255,255,255,0.1); margin-top: 5px; padding-top: 5px;">
                                                <div class="dplayer-setting-item dplayer-setting-skip-toggle" style="display: flex; align-items: center; justify-content: space-between; cursor: pointer;">
                                                    <span class="dplayer-label" style="white-space: nowrap;">è·³è¿‡ç‰‡å¤´ç‰‡å°¾</span>
                                                    <div class="dplayer-toggle-icon" style="position: relative; width: 40px; height: 22px; background: ${this.config.enabled ? '#e50914' : 'rgba(255,255,255,0.2)'}; border-radius: 20px; transition: background 0.3s; flex-shrink: 0;">
                                                        <div class="toggle-knob" style="position: absolute; top: 2px; left: 2px; width: 18px; height: 18px; background: #fff; border-radius: 50%; transition: transform 0.3s; box-shadow: 0 1px 3px rgba(0,0,0,0.4); transform: translateX(${this.config.enabled ? '18px' : '0'});"></div>
                                                    </div>
                                                </div>
                                                <div class="dplayer-setting-item dplayer-setting-set-intro" style="cursor: pointer; justify-content: space-between;">
                                                    <span class="dplayer-label">è®¾ç½®ç‰‡å¤´</span>
                                                    <span class="dplayer-value intro-val" style="opacity: 0.8;">${this.formatTime(this.config.intro)}</span>
                                                </div>
                                                <div class="dplayer-setting-item dplayer-setting-set-outro" style="cursor: pointer; justify-content: space-between;">
                                                    <span class="dplayer-label">è®¾ç½®ç‰‡å°¾</span>
                                                    <span class="dplayer-value outro-val" style="opacity: 0.8;">${this.formatTime(this.config.outro)}</span>
                                                </div>
                                                 <div class="dplayer-setting-item dplayer-setting-del-config" style="cursor: pointer; color: #888; font-size: 12px; height: 32px; display: flex; align-items: center; padding: 0 10px; margin-top: 0;">
                                                    <i class="fas fa-trash-alt" style="margin-right:8px;"></i> æ¸…é™¤è·³è¿‡é…ç½®
                                                </div>
                                            </div>
                                        `;
                                        panel.insertAdjacentHTML('beforeend', html);
                                        const group = panel.querySelector('.dplayer-setting-skip-group');
                                        group.querySelector('.dplayer-setting-skip-toggle').addEventListener('click', () => {
                                            this.config.enabled = !this.config.enabled;
                                            this.save();
                                            dp.notice(this.config.enabled ? 'å·²å¼€å¯è·³è¿‡åŠŸèƒ½' : 'å·²å…³é—­è·³è¿‡åŠŸèƒ½');
                                        });
                                        group.querySelector('.dplayer-setting-set-intro').addEventListener('click', () => this.setIntro());
                                        group.querySelector('.dplayer-setting-set-outro').addEventListener('click', () => this.setOutro());
                                        group.querySelector('.dplayer-setting-del-config').addEventListener('click', () => this.clear());
                                    },
                                    check(time) {
                                        if (!this.config.enabled) return;
                                        if (this.config.intro > 0 && time < this.config.intro && !this.hasSkippedIntro) {
                                            dp.seek(this.config.intro);
                                            dp.notice('å·²è·³è¿‡ç‰‡å¤´');
                                            this.hasSkippedIntro = true;
                                        }
                                        if (this.config.outro > 0 && time > this.config.outro && !this.hasSkippedOutro) {
                                            dp.notice('å·²è·³è¿‡ç‰‡å°¾');
                                            this.hasSkippedOutro = true;
                                            if (dp.events) dp.events.trigger('ended');
                                        }
                                    }
                                };

                                // ç›‘å¬æ’­æ”¾å™¨äº‹ä»¶
                                dp.on('timeupdate', () => {
                                    if (dp.video && window.skipManager) window.skipManager.check(dp.video.currentTime);
                                });

                                dp.on('canplay', () => {
                                    if (window.skipManager) window.skipManager.load();
                                });

                                // åˆå§‹åŠ è½½é…ç½®
                                window.skipManager.load();

                                // æ³¨å…¥â€œä¸‹ä¸€é›†â€æŒ‰é’®
                                {
                                    const iconsRight = dplayerContainer.querySelector('.dplayer-icons-right');
                                    if (iconsRight && !iconsRight.querySelector('.dplayer-next-icon')) {
                                        const nextBtnHtml = `
                                            <div class="dplayer-icon dplayer-next-icon" data-balloon="ä¸‹ä¸€é›†" data-balloon-pos="up">
                                                <span class="dplayer-icon-content" style="display: flex; align-items: center; justify-content: center; width: 100%; height: 100%;">
                                                    <i class="fas fa-step-forward" aria-hidden="true" style="font-size:18px;"></i>
                                                </span>
                                            </div>
                                        `;
                                        iconsRight.insertAdjacentHTML('afterbegin', nextBtnHtml);

                                        const nextBtn = iconsRight.querySelector('.dplayer-next-icon');
                                        if (nextBtn) {
                                            nextBtn.addEventListener('click', () => {
                                                this.playNextEpisode();
                                            });
                                        }
                                    }
                                }

                                // å†æ¬¡ç‚¹å‡»è®¾ç½®æŒ‰é’®æ—¶å…³é—­è®¾ç½®èœå•
                                const settingIcon = dplayerContainer.querySelector('.dplayer-setting-icon');
                                if (settingIcon) {
                                    // ä½¿ç”¨ mousedown è®°å½•ç‚¹å‡»å‰çš„èœå•çŠ¶æ€
                                    let wasOpenBeforeClick = false;

                                    settingIcon.addEventListener('mousedown', () => {
                                        wasOpenBeforeClick = settingBox.classList.contains('dplayer-setting-box-open');
                                    });

                                    settingIcon.addEventListener('click', (e) => {
                                        // åªæœ‰åœ¨ç‚¹å‡»å‰èœå•å°±å·²ç»æ‰“å¼€çš„æƒ…å†µä¸‹æ‰å…³é—­
                                        if (wasOpenBeforeClick) {
                                            e.stopPropagation();
                                            settingBox.classList.remove('dplayer-setting-box-open');
                                            // åŒæ—¶å…³é—­é€Ÿåº¦é€‰æ‹©å­èœå•
                                            const settingSpeed = settingBox.querySelector('.dplayer-setting-speed');
                                            if (settingSpeed) {
                                                settingSpeed.classList.add('dplayer-setting-box-hide');
                                            }
                                            // é‡æ–°æ˜¾ç¤ºä¸»è®¾ç½®èœå•ï¼ˆéšè—çŠ¶æ€ï¼‰
                                            const settingOrigin = settingBox.querySelector('.dplayer-setting-origin');
                                            if (settingOrigin) {
                                                settingOrigin.classList.remove('dplayer-setting-box-hide');
                                            }
                                            console.log('[Settings] Toggled OFF by button click');
                                        }
                                        wasOpenBeforeClick = false; // é‡ç½®çŠ¶æ€
                                    });
                                }

                                console.log('[Settings] Fix applied - monitoring setting box state');
                            }
                        }, 500);

                        // æ·»åŠ å…¨å±æ¨ªå±åŠŸèƒ½ï¼ˆæ‰‹æœºç«¯ï¼‰+ ğŸ“± Android çŠ¶æ€æ ç®¡ç†
                        // æ£€æµ‹ Capacitor æ’ä»¶
                        const { StatusBar } = typeof Capacitor !== 'undefined' ? Capacitor.Plugins : {};

                        // è¿›å…¥å…¨å±å¤„ç†å‡½æ•°
                        const enterFullscreenMode = async () => {
                            // 1. æ ‡è®° body ä¸ºå…¨å±çŠ¶æ€ï¼ˆç§»é™¤ safe-area paddingï¼‰
                            document.body.classList.add('dplayer-fullscreen-active');

                            // 2. ğŸ“± è°ƒç”¨ Android åŸç”Ÿå…¨å±æ¥å£ï¼ˆç§»é™¤ padding + æ—‹è½¬æ¨ªå± + éšè—çŠ¶æ€æ ï¼‰
                            if (window.AndroidFullscreen) {
                                window.AndroidFullscreen.enter();
                                console.log('[Fullscreen] Android åŸç”Ÿå…¨å±å·²å¯ç”¨');
                            }

                            // 3. Capacitor StatusBar æ’ä»¶ï¼ˆä½œä¸ºå¤‡ç”¨ï¼‰
                            if (StatusBar) {
                                try {
                                    await StatusBar.setOverlaysWebView({ overlay: true });
                                    await StatusBar.hide();
                                    console.log('[Fullscreen] çŠ¶æ€æ å·²éšè—');
                                } catch (e) {
                                    console.warn('[Fullscreen] StatusBar hide error:', e);
                                }
                            }

                            // 4. Web API é”å®šæ¨ªå±ï¼ˆä½œä¸ºå¤‡ç”¨ï¼‰
                            if (screen.orientation && screen.orientation.lock) {
                                screen.orientation.lock('landscape').catch(() => { });
                            }
                        };

                        // é€€å‡ºå…¨å±å¤„ç†å‡½æ•°
                        const exitFullscreenMode = async () => {
                            // 1. ç§»é™¤å…¨å±çŠ¶æ€æ ‡è®°ï¼ˆæ¢å¤ safe-area paddingï¼‰
                            document.body.classList.remove('dplayer-fullscreen-active');

                            // 2. ğŸ“± è°ƒç”¨ Android åŸç”Ÿé€€å‡ºå…¨å±æ¥å£ï¼ˆæ¢å¤ padding + è§£é”æ–¹å‘ + æ˜¾ç¤ºçŠ¶æ€æ ï¼‰
                            if (window.AndroidFullscreen) {
                                window.AndroidFullscreen.exit();
                                console.log('[Fullscreen] Android åŸç”Ÿå…¨å±å·²é€€å‡º');
                            }

                            // 3. Capacitor StatusBar æ’ä»¶ï¼ˆä½œä¸ºå¤‡ç”¨ï¼‰
                            if (StatusBar) {
                                try {
                                    await StatusBar.show();
                                    await StatusBar.setOverlaysWebView({ overlay: false });
                                    console.log('[Fullscreen] çŠ¶æ€æ å·²æ¢å¤');
                                } catch (e) {
                                    console.warn('[Fullscreen] StatusBar show error:', e);
                                }
                            }

                            // 4. Web API è§£é”å±å¹•æ–¹å‘ï¼ˆä½œä¸ºå¤‡ç”¨ï¼‰
                            if (screen.orientation && screen.orientation.unlock) {
                                screen.orientation.unlock();
                            }
                        };

                        // ç›‘å¬ DPlayer å…¨å±äº‹ä»¶
                        dp.on('fullscreen', enterFullscreenMode);
                        dp.on('fullscreen_cancel', exitFullscreenMode);

                        // ç›‘å¬ DPlayer Web å…¨å±äº‹ä»¶
                        dp.on('webfullscreen', enterFullscreenMode);
                        dp.on('webfullscreen_cancel', exitFullscreenMode);

                        // ç›‘å¬æµè§ˆå™¨åŸç”Ÿå…¨å± APIï¼ˆå¤‡ç”¨ï¼‰
                        document.addEventListener('fullscreenchange', () => {
                            if (document.fullscreenElement) {
                                enterFullscreenMode();
                            } else {
                                exitFullscreenMode();
                            }
                        });

                        // ========== ğŸ“± æ‰‹æœºç«¯åŒå‡»å¿«è¿›/å¿«é€€åŠŸèƒ½ ==========
                        const container = document.getElementById('dplayer');
                        let lastTap = 0;
                        let tapTimeout = null;
                        let controllerHideTimer = null;
                        const SEEK_SECONDS = 10;  // å¿«è¿›/å¿«é€€ç§’æ•°

                        // åˆ›å»ºæç¤ºå…ƒç´ 
                        const seekHintLeft = document.createElement('div');
                        seekHintLeft.className = 'dplayer-seek-hint left';
                        seekHintLeft.innerHTML = '<i class="fas fa-backward"></i><span>-10ç§’</span>';
                        container.appendChild(seekHintLeft);

                        const seekHintRight = document.createElement('div');
                        seekHintRight.className = 'dplayer-seek-hint right';
                        seekHintRight.innerHTML = '<i class="fas fa-forward"></i><span>+10ç§’</span>';
                        container.appendChild(seekHintRight);

                        // å€é€ŸæŒ‡ç¤ºå™¨
                        const speedIndicator = document.createElement('div');
                        speedIndicator.className = 'dplayer-speed-indicator';
                        container.appendChild(speedIndicator);

                        // ğŸ–¥ï¸ ç”µè„‘ç«¯ä¸­å¤®æ’­æ”¾/æš‚åœæŒ‰é’®
                        const isDesktop = window.innerWidth > 768;
                        let desktopPlayOverlay = null;

                        if (isDesktop) {
                            desktopPlayOverlay = document.createElement('div');
                            desktopPlayOverlay.className = 'desktop-play-overlay';
                            desktopPlayOverlay.innerHTML = '<i class="fas fa-play"></i>';
                            container.appendChild(desktopPlayOverlay);

                            // æ›´æ–°æ¡Œé¢æŒ‰é’®çŠ¶æ€
                            const updateDesktopOverlay = () => {
                                if (dp.video.paused) {
                                    desktopPlayOverlay.innerHTML = '<i class="fas fa-play"></i>';
                                    desktopPlayOverlay.classList.remove('pause-state');
                                    desktopPlayOverlay.classList.add('show');
                                } else {
                                    desktopPlayOverlay.innerHTML = '<i class="fas fa-pause"></i>';
                                    desktopPlayOverlay.classList.add('pause-state');
                                    // æ’­æ”¾æ—¶çŸ­æš‚æ˜¾ç¤ºåéšè—
                                    desktopPlayOverlay.classList.add('show');
                                    setTimeout(() => {
                                        if (!dp.video.paused) {
                                            desktopPlayOverlay.classList.remove('show');
                                        }
                                    }, 800);
                                }
                            };

                            // ç›‘å¬æ’­æ”¾/æš‚åœäº‹ä»¶
                            dp.on('pause', () => {
                                desktopPlayOverlay.innerHTML = '<i class="fas fa-play"></i>';
                                desktopPlayOverlay.classList.remove('pause-state');
                                desktopPlayOverlay.classList.add('show');
                            });

                            dp.on('play', () => {
                                desktopPlayOverlay.innerHTML = '<i class="fas fa-pause"></i>';
                                desktopPlayOverlay.classList.add('pause-state');
                                desktopPlayOverlay.classList.add('show');
                                // æ’­æ”¾åçŸ­æš‚æ˜¾ç¤ºç„¶åéšè—
                                setTimeout(() => {
                                    if (!dp.video.paused) {
                                        desktopPlayOverlay.classList.remove('show');
                                    }
                                }, 800);
                            });

                            // ç‚¹å‡»æŒ‰é’®åˆ‡æ¢æ’­æ”¾/æš‚åœ
                            desktopPlayOverlay.addEventListener('click', (e) => {
                                e.preventDefault();
                                e.stopPropagation();
                                dp.toggle();
                            });

                            // ç‚¹å‡»è§†é¢‘åŒºåŸŸä¹Ÿæ˜¾ç¤ºæŒ‰é’®
                            container.addEventListener('click', (e) => {
                                // å¿½ç•¥æ§åˆ¶æ å’Œè®¾ç½®èœå•
                                if (e.target.closest('.dplayer-controller') ||
                                    e.target.closest('.dplayer-setting-box') ||
                                    e.target.closest('.desktop-play-overlay')) {
                                    return;
                                }

                                // å¦‚æœæŒ‰é’®éšè—ï¼Œå…ˆæ˜¾ç¤º
                                if (!desktopPlayOverlay.classList.contains('show')) {
                                    updateDesktopOverlay();
                                }
                            });
                        }

                        // ğŸ“± æ‰‹æœºç«¯ä¸­å¤®äº¤äº’æŒ‰é’®
                        const mobilePlayOverlay = document.createElement('div');
                        mobilePlayOverlay.className = 'mobile-play-overlay';
                        mobilePlayOverlay.innerHTML = '<i class="fas fa-play"></i>';
                        container.appendChild(mobilePlayOverlay);

                        // å¼ºåŠ›ç§»é™¤ DPlayer åŸç”Ÿç§»åŠ¨ç«¯å›¾æ ‡
                        const removeNativeIcons = () => {
                            const nativePlay = container.querySelector('.dplayer-mobile-play');
                            if (nativePlay) nativePlay.style.display = 'none';

                            const nativeBezels = container.querySelectorAll('.dplayer-bezel-icon');
                            nativeBezels.forEach(el => el.style.display = 'none');
                        };

                        // åˆå§‹ç§»é™¤
                        removeNativeIcons();

                        // ç›‘å¬ DOM å˜åŒ–æŒç»­ç§»é™¤ (é˜²æ­¢ DPlayer é‡æ–°åˆ›å»º)
                        const observer = new MutationObserver((mutations) => {
                            removeNativeIcons();
                        });
                        observer.observe(container, { childList: true, subtree: true });

                        // æ›´æ–°æŒ‰é’®çŠ¶æ€å‡½æ•°
                        const updateOverlayState = (overlay) => {
                            if (dp.video.paused) {
                                overlay.innerHTML = '<i class="fas fa-play"></i>';
                                overlay.classList.remove('pause-state');
                            } else {
                                overlay.innerHTML = '<i class="fas fa-pause"></i>';
                                overlay.classList.add('pause-state'); // è°ƒæ•´å›¾æ ‡å±…ä¸­
                                overlay.classList.add('show');
                            }
                            overlay.classList.add('show');
                        };

                        // ç›‘å¬æ’­æ”¾çŠ¶æ€å˜åŒ–æ¥è‡ªåŠ¨æ›´æ–° UI (å¯é€‰ï¼Œä½†ä¸ºäº†ç¡®ä¿ä¸€è‡´æ€§)
                        dp.on('play', () => {
                            if (mobilePlayOverlay.classList.contains('show')) {
                                mobilePlayOverlay.innerHTML = '<i class="fas fa-pause"></i>';
                                mobilePlayOverlay.classList.add('pause-state');
                            }
                        });

                        dp.on('pause', () => {
                            if (mobilePlayOverlay.classList.contains('show')) {
                                mobilePlayOverlay.innerHTML = '<i class="fas fa-play"></i>';
                                mobilePlayOverlay.classList.remove('pause-state');
                            }
                        });

                        // ç‚¹å‡»ä¸­å¤®æŒ‰é’®äº‹ä»¶
                        mobilePlayOverlay.addEventListener('touchend', (e) => {
                            e.preventDefault(); // é˜»æ­¢å†’æ³¡é˜²æ­¢è§¦å‘èƒŒæ™¯ç‚¹å‡»
                            e.stopPropagation();
                            dp.toggle();
                            // ç‚¹å‡»åæ›´æ–°çŠ¶æ€
                            setTimeout(() => updateOverlayState(mobilePlayOverlay), 50);
                            // äº¤äº’åé‡ç½®éšè—è®¡æ—¶å™¨
                            if (controllerHideTimer) clearTimeout(controllerHideTimer);
                            controllerHideTimer = setTimeout(() => {
                                const controller = container.querySelector('.dplayer-controller');
                                if (controller) controller.classList.remove('dplayer-controller-show');
                                mobilePlayOverlay.classList.remove('show');
                                container.classList.add('dplayer-hide-controller');
                            }, 3000);
                        });

                        // åŒå‡»æ£€æµ‹
                        // åŒå‡»æ£€æµ‹
                        container.addEventListener('touchend', (e) => {
                            // å¿½ç•¥æ§åˆ¶æ åŒºåŸŸå’Œè‡ªå®šä¹‰æŒ‰é’®çš„ç‚¹å‡»
                            // å¿½ç•¥æ§åˆ¶æ åŒºåŸŸã€è‡ªå®šä¹‰æŒ‰é’®ä»¥åŠ DPlayer é®ç½©çš„ç‚¹å‡»
                            if (e.target.closest('.dplayer-controller') ||
                                e.target.closest('.dplayer-setting-box') ||
                                e.target.closest('.mobile-play-overlay') ||
                                e.target.closest('.dplayer-mask')) {
                                return;
                            }

                            // é˜»æ­¢ DPlayer åŸç”Ÿç‚¹å‡»äº‹ä»¶ï¼Œé˜²æ­¢å†²çª
                            if (e.cancelable) {
                                e.preventDefault();
                            }

                            const now = Date.now();
                            const rect = container.getBoundingClientRect();
                            const x = e.changedTouches[0].clientX - rect.left;
                            const width = rect.width;
                            const isLeftSide = x < width * 0.35;   // å·¦ä¾§ 35%
                            const isRightSide = x > width * 0.65; // å³ä¾§ 35%
                            const isCenter = !isLeftSide && !isRightSide;  // ä¸­é—´ 30%

                            if (now - lastTap < 300) {
                                // åŒå‡»æ£€æµ‹æˆåŠŸ
                                clearTimeout(tapTimeout);

                                if (isLeftSide && dp.video) {
                                    // å·¦ä¾§åŒå‡» - å¿«é€€
                                    const newTime = Math.max(0, dp.video.currentTime - SEEK_SECONDS);
                                    dp.seek(newTime);
                                    seekHintLeft.classList.add('show');
                                    setTimeout(() => seekHintLeft.classList.remove('show'), 600);
                                } else if (isRightSide && dp.video) {
                                    // å³ä¾§åŒå‡» - å¿«è¿›
                                    const newTime = Math.min(dp.video.duration || 0, dp.video.currentTime + SEEK_SECONDS);
                                    dp.seek(newTime);
                                    seekHintRight.classList.add('show');
                                    setTimeout(() => seekHintRight.classList.remove('show'), 600);
                                } else if (isCenter) {
                                    // ä¸­é—´åŒå‡» - æš‚åœ/æ’­æ”¾
                                    dp.toggle();
                                }
                            } else {
                                // ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œç­‰å¾…æ£€æµ‹åŒå‡»
                                tapTimeout = setTimeout(() => {
                                    // å•å‡» - åˆ‡æ¢æ§åˆ¶æ æ˜¾ç¤º/éšè—
                                    const controller = container.querySelector('.dplayer-controller');
                                    const overlay = container.querySelector('.mobile-play-overlay');

                                    if (controller) {
                                        // æ£€æŸ¥å½“å‰æ˜¯å¦å¯è§ (æ£€æŸ¥ opacity)
                                        const isVisible = window.getComputedStyle(controller).opacity !== '0';

                                        if (isVisible) {
                                            // å½“å‰å¯è§ -> éšè—
                                            controller.classList.remove('dplayer-controller-show');
                                            if (overlay) overlay.classList.remove('show');

                                            container.classList.add('dplayer-hide-controller'); // å¼ºåˆ¶æ·»åŠ éšè—ç±»
                                            if (controllerHideTimer) {
                                                clearTimeout(controllerHideTimer);
                                                controllerHideTimer = null;
                                            }
                                        } else {
                                            // å½“å‰éšè— -> æ˜¾ç¤º
                                            if (controllerHideTimer) clearTimeout(controllerHideTimer);
                                            controller.classList.add('dplayer-controller-show');
                                            if (overlay) updateOverlayState(overlay); // æ›´æ–°å¹¶æ˜¾ç¤º

                                            container.classList.remove('dplayer-hide-controller'); // ç§»é™¤éšè—ç±»

                                            // 4ç§’åè‡ªåŠ¨éšè—
                                            controllerHideTimer = setTimeout(() => {
                                                controller.classList.remove('dplayer-controller-show');
                                                if (overlay) overlay.classList.remove('show');
                                                container.classList.add('dplayer-hide-controller');
                                                controllerHideTimer = null;
                                            }, 4000);
                                        }
                                    }
                                }, 300);
                            }
                            lastTap = now;
                        });



                        // å€é€Ÿå˜åŒ–æ—¶æ˜¾ç¤ºæŒ‡ç¤ºå™¨
                        dp.on('ratechange', () => {
                            const rate = dp.video.playbackRate;
                            speedIndicator.textContent = `${rate}x`;
                            speedIndicator.classList.add('show');
                            clearTimeout(speedIndicator._hideTimer);
                            speedIndicator._hideTimer = setTimeout(() => {
                                speedIndicator.classList.remove('show');
                            }, 1500);
                        });

                        setupErrorHandling();

                        // ========== ğŸ• æ’­æ”¾è¿›åº¦è®°å¿†åŠŸèƒ½ (å¤–éƒ¨å®ç°) ==========
                        // æ ‡å‡†åŒ–é›†æ•°åç§°ï¼Œç¡®ä¿ä¸åŒæºä½¿ç”¨ç›¸åŒçš„ Key
                        const normalizeEpisodeName = (name) => {
                            if (!name) return 'æ­£ç‰‡';
                            // ç§»é™¤å‰å¯¼é›¶: ç¬¬01é›† -> ç¬¬1é›†, ç¬¬001é›† -> ç¬¬1é›†
                            let normalized = name.replace(/ç¬¬0*(\d+)é›†/g, 'ç¬¬$1é›†');
                            // ä¹Ÿå¤„ç†çº¯æ•°å­—: 01 -> 1
                            normalized = normalized.replace(/^0+(\d)/, '$1');
                            return normalized || 'æ­£ç‰‡';
                        };

                        // æ™ºèƒ½ Key ç”Ÿæˆï¼ˆä½¿ç”¨ this.currentUrl åŠ¨æ€è·å–å½“å‰é›†æ•°ï¼‰
                        // - ç”µå½±ï¼ˆåªæœ‰1é›†ï¼‰ï¼šå¿½ç•¥é›†æ•°åç§°ï¼ˆæ­£ç‰‡/HD/HDä¸­å­—ç­‰ï¼‰ï¼Œåªç”¨ç”µå½±å
                        // - å‰§é›†ï¼ˆå¤šé›†ï¼‰ï¼šä½¿ç”¨ç”µå½±å + æ ‡å‡†åŒ–é›†æ•°
                        const getProgressKey = () => {
                            const vodName = this.currentGroup?.name || 'unknown';

                            // å¦‚æœåªæœ‰1é›†ï¼ˆç”µå½±ï¼‰ï¼Œä¸åŠ é›†æ•°åç¼€ï¼Œè¿™æ · æ­£ç‰‡/HD/HDä¸­å­— éƒ½å…±äº«åŒä¸€ä¸ªè¿›åº¦
                            if (this.episodeList && this.episodeList.length === 1) {
                                const key = `donggua_progress_${vodName}`.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_');
                                return key.substring(0, 80);
                            }

                            // å¤šé›†ï¼ˆå‰§é›†ï¼‰ï¼Œä½¿ç”¨ç”µå½±å + å½“å‰æ’­æ”¾é›†æ•°ï¼ˆåŠ¨æ€è·å–ï¼ï¼‰
                            let episodeName = 'æ­£ç‰‡';
                            if (this.episodeList && this.episodeList.length > 0) {
                                const currentEp = this.episodeList.find(ep => ep.url === this.currentUrl);
                                if (currentEp) {
                                    episodeName = normalizeEpisodeName(currentEp.name);
                                }
                            }
                            const combined = `${vodName}_${episodeName}`.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_');
                            return 'donggua_progress_' + combined.substring(0, 80);
                        };

                        // æ³¨æ„ï¼šprogressKey ç°åœ¨æ˜¯åŠ¨æ€è®¡ç®—çš„ï¼Œæ¯æ¬¡è°ƒç”¨ getProgressKey() è·å–
                        console.log('[è¿›åº¦è®°å¿†] åˆå§‹ Key:', getProgressKey());

                        // æ¢å¤æ’­æ”¾è¿›åº¦
                        let progressRestored = false;
                        dp.on('canplay', () => {
                            // ğŸ’¾ æ¢å¤å€é€Ÿè®¾ç½® (æ¯æ¬¡è§†é¢‘åŠ è½½éƒ½æ£€æŸ¥)
                            try {
                                const savedSpeed = parseFloat(localStorage.getItem('dplayer_speed'));
                                if (savedSpeed && !isNaN(savedSpeed) && dp.video) {
                                    if (Math.abs(dp.video.playbackRate - savedSpeed) > 0.01) {
                                        dp.speed(savedSpeed);
                                    }
                                }
                            } catch (e) { }

                            if (progressRestored) return;

                            try {
                                const currentKey = getProgressKey();
                                const saved = localStorage.getItem(currentKey);
                                console.log('[è¿›åº¦è®°å¿†] canplay è§¦å‘, Key:', currentKey);
                                console.log('[è¿›åº¦è®°å¿†] å­˜å‚¨æ•°æ®:', saved);
                                console.log('[è¿›åº¦è®°å¿†] è§†é¢‘æ—¶é•¿:', dp.video.duration);
                                console.log('[è¿›åº¦è®°å¿†] å½“å‰æ—¶é—´:', dp.video.currentTime);
                                console.log('[è¿›åº¦è®°å¿†] æ˜¯å¦å¯seek:', dp.video.seekable.length > 0 ? `æ˜¯ (${dp.video.seekable.start(0)}-${dp.video.seekable.end(0)})` : 'å¦');

                                if (saved) {
                                    const savedData = JSON.parse(saved);
                                    const savedTime = savedData.time;
                                    const savedDate = new Date(savedData.date);
                                    const now = new Date();
                                    const daysDiff = (now - savedDate) / (1000 * 60 * 60 * 24);

                                    console.log('[è¿›åº¦è®°å¿†] ä¿å­˜æ—¶é—´:', savedTime, 'ç§’');
                                    console.log('[è¿›åº¦è®°å¿†] ä¿å­˜æ—¥æœŸ:', savedData.date, `(${daysDiff.toFixed(1)}å¤©å‰)`);

                                    // åªæ¢å¤30å¤©å†…çš„è¿›åº¦ï¼Œä¸”è¿›åº¦åœ¨æœ‰æ•ˆèŒƒå›´å†…
                                    const isTimeOK = daysDiff < 30;
                                    const isMinOK = savedTime > 60;  // è‡³å°‘çœ‹è¿‡1åˆ†é’Ÿ
                                    const isMaxOK = dp.video.duration && savedTime < dp.video.duration - 120;  // è·ç¦»ç»“å°¾>2åˆ†é’Ÿ

                                    console.log('[è¿›åº¦è®°å¿†] æ£€æŸ¥: 30å¤©å†…=' + isTimeOK + ', >1åˆ†é’Ÿ=' + isMinOK + ', <ç»“å°¾2åˆ†é’Ÿ=' + isMaxOK);

                                    if (isTimeOK && isMinOK && isMaxOK) {
                                        console.log('[è¿›åº¦è®°å¿†] âœ… å‡†å¤‡è·³è½¬åˆ°:', savedTime);

                                        // è®°å½•è·³è½¬å‰çš„æ—¶é—´
                                        const beforeSeek = dp.video.currentTime;

                                        dp.seek(savedTime);

                                        // å»¶è¿Ÿæ£€æŸ¥è·³è½¬æ˜¯å¦æˆåŠŸ
                                        setTimeout(() => {
                                            const afterSeek = dp.video.currentTime;
                                            console.log('[è¿›åº¦è®°å¿†] è·³è½¬ç»“æœ: ä¹‹å‰=' + beforeSeek.toFixed(1) + ', ç›®æ ‡=' + savedTime + ', ä¹‹å=' + afterSeek.toFixed(1));

                                            if (Math.abs(afterSeek - savedTime) < 10) {
                                                console.log('[è¿›åº¦è®°å¿†] âœ… è·³è½¬æˆåŠŸ!');
                                            } else {
                                                console.log('[è¿›åº¦è®°å¿†] âš ï¸ è·³è½¬å¯èƒ½å¤±è´¥ï¼Œè§†é¢‘æºå¯èƒ½ä¸æ”¯æŒç²¾ç¡®è·³è½¬');
                                            }
                                        }, 1000);

                                        dp.notice(`â–¶ å·²æ¢å¤ä¸Šæ¬¡è§‚çœ‹ä½ç½® ${Math.floor(savedTime / 60)}:${String(Math.floor(savedTime % 60)).padStart(2, '0')}`, 3000);
                                    } else {
                                        console.log('[è¿›åº¦è®°å¿†] âŒ æ¡ä»¶ä¸æ»¡è¶³ï¼Œè·³è¿‡æ¢å¤');
                                    }
                                } else {
                                    console.log('[è¿›åº¦è®°å¿†] æ— ä¿å­˜è®°å½•');
                                }
                            } catch (e) {
                                console.log('[è¿›åº¦è®°å¿†] æ¢å¤å¤±è´¥:', e);
                            }
                            progressRestored = true;
                        });

                        // è¿›åº¦ä¿å­˜é€»è¾‘ï¼š
                        // - åªæœ‰å½“å‰ä½ç½® > 1åˆ†é’Ÿ æ‰ä¿å­˜ï¼ˆé˜²æ­¢ä»å¤´çœ‹çš„èµ„æºè¦†ç›–è¿›åº¦ï¼‰
                        // - å…è®¸è¿›åº¦å€’é€€ï¼ˆç”¨æˆ·å¯èƒ½é‡æ–°å¼€å§‹çœ‹ï¼‰
                        // - è·ç¦»ç»“å°¾ < 2åˆ†é’Ÿ è§†ä¸ºå®Œæ’­ï¼Œæ¸…é™¤è¿›åº¦
                        const saveProgress = (currentTime) => {
                            const duration = dp.video?.duration || 0;

                            // è·å–ç”µå½±ä¿¡æ¯ç”¨äºè§‚çœ‹å†å²
                            const movieName = this.currentGroup?.name || '';
                            const poster = this.currentGroup?.pic || '';
                            // ä½¿ç”¨ this.currentUrl è·å–å½“å‰æ­£åœ¨æ’­æ”¾çš„é›†æ•°ï¼ˆè€Œä¸æ˜¯é—­åŒ…ä¸­å›ºå®šçš„ urlï¼‰
                            const currentEp = this.episodeList?.find(ep => ep.url === this.currentUrl);
                            const episodeName = (this.episodeList?.length > 1 && currentEp) ? currentEp.name : null;

                            console.log('[è¿›åº¦è®°å¿†] å½“å‰é›†æ•°:', episodeName, 'å½“å‰URL:', this.currentUrl?.substring(0, 30));

                            // å¦‚æœè·ç¦»ç»“å°¾ < 2åˆ†é’Ÿï¼Œè§†ä¸ºå®Œæ’­ï¼Œæ¸…é™¤è¿›åº¦
                            if (duration > 0 && currentTime > duration - 120) {
                                localStorage.removeItem(getProgressKey());
                                console.log('[è¿›åº¦è®°å¿†] å³å°†å®Œæ’­ï¼Œæ¸…é™¤è¿›åº¦è®°å½•');
                                // æ›´æ–°è§‚çœ‹å†å²ï¼ˆè¿›åº¦100%ï¼‰
                                if (movieName) {
                                    this.addToWatchHistory(movieName, poster, episodeName, duration, duration, this.currentGroup);
                                }
                                return;
                            }

                            // åªæœ‰æ’­æ”¾ä½ç½® > 1åˆ†é’Ÿæ‰ä¿å­˜ï¼ˆé˜²æ­¢ä»å¤´æ’­æ”¾çš„èµ„æºè¦†ç›–è¿›åº¦ï¼‰
                            if (currentTime <= 60) {
                                console.log('[è¿›åº¦è®°å¿†] å½“å‰ä½ç½® < 1åˆ†é’Ÿï¼Œä¸ä¿å­˜è¿›åº¦å’Œå†å²');
                                return;
                            }

                            try {
                                const data = {
                                    time: Math.floor(currentTime),
                                    date: new Date().toISOString()
                                };
                                localStorage.setItem(getProgressKey(), JSON.stringify(data));
                                console.log('[è¿›åº¦è®°å¿†] ä¿å­˜è¿›åº¦:', currentTime.toFixed(0), 'ç§’, é›†æ•°:', episodeName);

                                // åŒæ—¶æ›´æ–°è§‚çœ‹å†å²ï¼ˆåªæœ‰è¿›åº¦ > 1åˆ†é’Ÿæ‰æ›´æ–°ï¼Œé˜²æ­¢è¦†ç›–ä¸º0ï¼‰
                                if (movieName) {
                                    this.addToWatchHistory(movieName, poster, episodeName, currentTime, duration, this.currentGroup);
                                }
                            } catch (e) {
                                console.log('[è¿›åº¦è®°å¿†] ä¿å­˜å¤±è´¥:', e);
                            }
                        };

                        // å®šæ—¶ä¿å­˜è¿›åº¦ (æ¯15ç§’)
                        const progressSaveInterval = setInterval(() => {
                            if (dp.video && !dp.video.paused) {
                                saveProgress(dp.video.currentTime);
                            }
                        }, 15000);

                        // æš‚åœæ—¶ä¿å­˜
                        dp.on('pause', () => {
                            if (dp.video) {
                                saveProgress(dp.video.currentTime);
                            }
                        });

                        // é¡µé¢å…³é—­å‰ä¿å­˜
                        window.addEventListener('beforeunload', () => {
                            if (dp.video) {
                                saveProgress(dp.video.currentTime);
                            }
                            // ä½¿ç”¨ sendBeacon ç¡®ä¿é¡µé¢å…³é—­æ—¶ä¹Ÿèƒ½åŒæ­¥
                            this.pushHistoryBeacon();
                        });

                        // æ’­æ”¾ç»“æŸæ—¶æ¸…é™¤è¿›åº¦è®°å½•
                        dp.on('ended', () => {
                            localStorage.removeItem(getProgressKey());
                            console.log('[è¿›åº¦è®°å¿†] æ’­æ”¾å®Œæ¯•ï¼Œæ¸…é™¤è®°å½•');
                            // æ›´æ–°è§‚çœ‹å†å²ï¼ˆè¿›åº¦100%ï¼‰
                            const movieName = this.currentGroup?.name || '';
                            const poster = this.currentGroup?.pic || '';
                            const currentEp = this.episodeList?.find(ep => ep.url === this.currentUrl);
                            const episodeName = (this.episodeList?.length > 1 && currentEp) ? currentEp.name : null;
                            const duration = dp.video?.duration || 0;
                            if (movieName) {
                                this.addToWatchHistory(movieName, poster, episodeName, duration, duration, this.currentGroup);
                            }

                            // è‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€é›†ï¼ˆéå•æ›²å¾ªç¯æ¨¡å¼ä¸‹ï¼‰
                            if (!dp.loop) {
                                this.playNextEpisode(true);
                            }
                        });

                    } else {
                        console.log('[æ’­æ”¾å™¨] ä½¿ç”¨å·²æœ‰ DPlayer å®ä¾‹ï¼Œåˆ‡æ¢è§†é¢‘');

                        // æ ‡å‡†åŒ–é›†æ•°åç§°
                        const normalizeEpisodeName = (name) => {
                            if (!name) return 'æ­£ç‰‡';
                            let normalized = name.replace(/ç¬¬0*(\d+)é›†/g, 'ç¬¬$1é›†');
                            normalized = normalized.replace(/^0+(\d)/, '$1');
                            return normalized || 'æ­£ç‰‡';
                        };

                        // æ™ºèƒ½ Key ç”Ÿæˆï¼ˆä¸åˆå§‹åŒ–æ—¶ç›¸åŒé€»è¾‘ï¼‰
                        const getProgressKey = () => {
                            const vodName = this.currentGroup?.name || 'unknown';

                            // ç”µå½±ï¼ˆåªæœ‰1é›†ï¼‰ï¼šå¿½ç•¥é›†æ•°åç§°
                            if (this.episodeList && this.episodeList.length === 1) {
                                const key = `donggua_progress_${vodName}`.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_');
                                return key.substring(0, 80);
                            }

                            // å‰§é›†ï¼ˆå¤šé›†ï¼‰ï¼šä½¿ç”¨ç”µå½±å + é›†æ•°
                            let episodeName = 'æ­£ç‰‡';
                            if (this.episodeList && this.episodeList.length > 0) {
                                const currentEp = this.episodeList.find(ep => ep.url === url);
                                if (currentEp) {
                                    episodeName = normalizeEpisodeName(currentEp.name);
                                }
                            }
                            const combined = `${vodName}_${episodeName}`.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '_');
                            return 'donggua_progress_' + combined.substring(0, 80);
                        };

                        const progressKey = getProgressKey();
                        console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] Key:', progressKey);
                        console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] å·²ä¿å­˜çš„æ•°æ®:', localStorage.getItem(progressKey));

                        let progressRestored = false;

                        dp.switchVideo({ url: finalUrl, type: 'hls' });
                        console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] switchVideo å·²è°ƒç”¨' + (finalUrl !== url ? ' (ä»£ç†æ¨¡å¼)' : ''));

                        // æ¢å¤æ–°è§†é¢‘çš„è¿›åº¦
                        const restoreHandler = () => {
                            console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] canplay äº‹ä»¶è§¦å‘!');
                            console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] progressRestored:', progressRestored);

                            // ğŸ’¾ æ¢å¤å€é€Ÿè®¾ç½® (æ¯æ¬¡åˆ‡æ¢è§†é¢‘éƒ½æ£€æŸ¥)
                            try {
                                const savedSpeed = parseFloat(localStorage.getItem('dplayer_speed'));
                                if (savedSpeed && !isNaN(savedSpeed) && dp.video) {
                                    if (Math.abs(dp.video.playbackRate - savedSpeed) > 0.01) {
                                        dp.speed(savedSpeed);
                                        console.log('[å€é€Ÿæ¢å¤] åˆ‡æ¢è§†é¢‘åæ¢å¤å€é€Ÿ:', savedSpeed + 'x');
                                    }
                                }
                            } catch (e) { }

                            if (progressRestored) {
                                console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] å·²æ¢å¤è¿‡ï¼Œè·³è¿‡');
                                return;
                            }
                            progressRestored = true;

                            console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] è§†é¢‘æ—¶é•¿:', dp.video.duration);
                            console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] å½“å‰æ—¶é—´:', dp.video.currentTime);

                            try {
                                const saved = localStorage.getItem(progressKey);
                                console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] è¯»å–å­˜å‚¨:', saved);

                                if (saved) {
                                    const savedData = JSON.parse(saved);
                                    const savedTime = savedData.time;
                                    const savedDate = new Date(savedData.date);
                                    const daysDiff = (new Date() - savedDate) / (1000 * 60 * 60 * 24);

                                    console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] ä¿å­˜æ—¶é—´:', savedTime, 'å¤©æ•°:', daysDiff.toFixed(1));

                                    const isTimeOK = daysDiff < 7;
                                    const isMinOK = savedTime > 10;
                                    const isMaxOK = dp.video.duration && savedTime < dp.video.duration - 30;

                                    console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] æ£€æŸ¥: 7å¤©å†…=' + isTimeOK + ', >10ç§’=' + isMinOK + ', <ç»“å°¾=' + isMaxOK);

                                    if (isTimeOK && isMinOK && isMaxOK) {
                                        setTimeout(() => {
                                            console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] æ‰§è¡Œ seek åˆ°:', savedTime);
                                            dp.seek(savedTime);
                                            dp.notice(`â–¶ å·²æ¢å¤ä¸Šæ¬¡è§‚çœ‹ä½ç½®`, 2000);

                                            setTimeout(() => {
                                                console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] seekåå½“å‰æ—¶é—´:', dp.video.currentTime);
                                            }, 1000);
                                        }, 500);
                                    } else {
                                        console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] æ¡ä»¶ä¸æ»¡è¶³ï¼Œè·³è¿‡æ¢å¤');
                                    }
                                } else {
                                    console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] æ— ä¿å­˜è®°å½•');
                                }
                            } catch (e) {
                                console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] æ¢å¤å¤±è´¥:', e);
                            }
                        };

                        dp.on('canplay', restoreHandler);
                        console.log('[è¿›åº¦è®°å¿†-åˆ‡æ¢] canplay ç›‘å¬å™¨å·²æ·»åŠ ');

                        // ğŸ’¾ é‡æ–°ç»‘å®š ratechange ç›‘å¬å™¨ï¼ˆswitchVideo å video å…ƒç´ ä¼šæ›´æ–°ï¼‰
                        // ä½¿ç”¨ DPlayer çš„äº‹ä»¶è€Œéç›´æ¥ç›‘å¬ videoï¼Œç¡®ä¿å…¼å®¹æ€§
                        setTimeout(() => {
                            if (dp.video) {
                                dp.video.addEventListener('ratechange', () => {
                                    const speed = dp.video.playbackRate;
                                    try {
                                        localStorage.setItem('dplayer_speed', speed);
                                        console.log('[å€é€Ÿä¿å­˜] åˆ‡æ¢åä¿å­˜å€é€Ÿ:', speed + 'x');
                                    } catch (e) { }
                                });
                            }
                        }, 100);
                    }
                    dp.play();

                    // ğŸ“º TV æ¨¡å¼ï¼šè‡ªåŠ¨å…¨å± + æ·»åŠ æ§åˆ¶æ æŒ‰é’®
                    if (this.isTVMode) {
                        // æ˜¾ç¤º TV æ¨¡å¼æç¤º
                        const tvNotice = document.createElement('div');
                        tvNotice.style.cssText = 'position:fixed;top:20px;left:20px;background:#e50914;color:#fff;padding:15px 25px;border-radius:10px;z-index:999999;font-size:16px;font-weight:bold;';
                        tvNotice.innerHTML = 'ğŸ“º TV æ¨¡å¼å·²å¯ç”¨<br>ğŸ® ç¡®è®¤é”®=æš‚åœ å·¦å³é”®=å¿«è¿›é€€';
                        document.body.appendChild(tvNotice);
                        setTimeout(() => tvNotice.remove(), 6000);

                        // å…ˆå…¨å±
                        setTimeout(() => {
                            if (dp.fullScreen) {
                                dp.fullScreen.request('web');
                            }
                        }, 500);

                        // å…¨å±åæ·»åŠ æŒ‰é’®ï¼ˆéœ€è¦ç­‰å¾…å…¨å±å®Œæˆï¼‰
                        setTimeout(() => {
                            try {
                                // 1. ç¦ç”¨èƒŒæ™¯å…ƒç´ çš„ç„¦ç‚¹
                                document.querySelectorAll('.source-pill, .ep-item, .close-btn, .btn-cast, .video-header button').forEach(el => {
                                    el.setAttribute('tabindex', '-1');
                                });

                                // 2. åˆ›å»ºé¡¶éƒ¨æ§åˆ¶æ ï¼ˆé¿å…è¢«åº•éƒ¨æ—¶é—´æ˜¾ç¤ºé®ç›–ï¼‰
                                let controlBar = document.getElementById('tv-controls');
                                if (!controlBar) {
                                    controlBar = document.createElement('div');
                                    controlBar.id = 'tv-controls';
                                    controlBar.style.cssText = 'position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:999999;display:flex;gap:15px;';
                                    document.body.appendChild(controlBar);
                                }

                                if (!document.getElementById('tv-switch-source')) {
                                    // æ·»åŠ "åˆ‡æ¢çº¿è·¯"æŒ‰é’®
                                    const switchBtn = document.createElement('button');
                                    switchBtn.id = 'tv-switch-source';
                                    switchBtn.setAttribute('tabindex', '102');
                                    switchBtn.innerHTML = 'ğŸ”„ åˆ‡æ¢çº¿è·¯';
                                    switchBtn.style.cssText = 'background:#e50914;border-radius:8px;padding:10px 20px;color:#fff;border:none;cursor:pointer;font-size:14px;font-weight:bold;';
                                    switchBtn.onclick = () => {
                                        const sources = window.vueApp.availableSources;
                                        const current = window.vueApp.currentSource;
                                        const idx = sources.findIndex(s => s.site_key === current?.site_key);
                                        const next = sources[(idx + 1) % sources.length];
                                        if (next) {
                                            window.vueApp.switchSource(next);
                                            dp.notice('åˆ‡æ¢åˆ°: ' + next.site_name);
                                        }
                                    };

                                    // æ·»åŠ "é€‰é›†"æŒ‰é’®
                                    const epBtn = document.createElement('button');
                                    epBtn.id = 'tv-select-episode';
                                    epBtn.setAttribute('tabindex', '101');
                                    epBtn.innerHTML = 'ğŸ“º é€‰é›†';
                                    epBtn.style.cssText = 'background:#333;border-radius:8px;padding:10px 20px;color:#fff;border:2px solid #666;cursor:pointer;font-size:14px;font-weight:bold;';
                                    epBtn.onclick = () => {
                                        // åˆ›å»ºé€‰é›†å¼¹çª—
                                        let popup = document.getElementById('tv-episode-popup');
                                        if (popup) {
                                            popup.remove();
                                            return;
                                        }

                                        popup = document.createElement('div');
                                        popup.id = 'tv-episode-popup';
                                        popup.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#1a1a1a;border-radius:15px;padding:20px;z-index:9999999;max-width:80%;max-height:70%;overflow-y:auto;border:2px solid #e50914;';

                                        // æ ‡é¢˜
                                        const title = document.createElement('div');
                                        title.style.cssText = 'color:#fff;font-size:18px;font-weight:bold;margin-bottom:15px;text-align:center;';
                                        title.textContent = 'ğŸ“º é€‰æ‹©é›†æ•°';
                                        popup.appendChild(title);

                                        // é›†æ•°åˆ—è¡¨
                                        const episodes = window.vueApp.episodeList || [];
                                        const currentUrl = window.vueApp.currentUrl;
                                        const grid = document.createElement('div');
                                        grid.style.cssText = 'display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:10px;min-width:300px;';

                                        if (episodes.length === 0) {
                                            const noEp = document.createElement('div');
                                            noEp.style.cssText = 'color:#999;text-align:center;padding:20px;';
                                            noEp.textContent = 'æš‚æ— é›†æ•°ä¿¡æ¯';
                                            grid.appendChild(noEp);
                                        } else {
                                            episodes.forEach((ep, i) => {
                                                const btn = document.createElement('button');
                                                btn.setAttribute('tabindex', String(300 + i));
                                                btn.textContent = ep.name || ('ç¬¬' + (i + 1) + 'é›†');
                                                const isActive = ep.url === currentUrl;
                                                btn.style.cssText = 'padding:12px;border-radius:5px;border:none;cursor:pointer;font-size:14px;' +
                                                    (isActive ? 'background:#e50914;color:#fff;' : 'background:#333;color:#fff;');
                                                btn.onclick = () => {
                                                    window.vueApp.play(ep.url);
                                                    popup.remove();
                                                };
                                                grid.appendChild(btn);
                                            });
                                        }
                                        popup.appendChild(grid);

                                        // å…³é—­æŒ‰é’®
                                        const closeBtn = document.createElement('button');
                                        closeBtn.setAttribute('tabindex', '299');
                                        closeBtn.textContent = 'âœ• å…³é—­';
                                        closeBtn.style.cssText = 'margin-top:15px;width:100%;padding:10px;background:#666;color:#fff;border:none;border-radius:5px;cursor:pointer;font-size:14px;';
                                        closeBtn.onclick = () => popup.remove();
                                        popup.appendChild(closeBtn);

                                        document.body.appendChild(popup);

                                        // èšç„¦åˆ°ç¬¬ä¸€ä¸ªé›†æ•°æŒ‰é’®
                                        const firstBtn = grid.querySelector('button');
                                        if (firstBtn) firstBtn.focus();
                                    };

                                    // æ·»åŠ æš‚åœ/æ’­æ”¾æŒ‰é’®
                                    const playPauseBtn = document.createElement('button');
                                    playPauseBtn.id = 'tv-play-pause';
                                    playPauseBtn.setAttribute('tabindex', '100');
                                    playPauseBtn.innerHTML = 'â¸ æš‚åœ';
                                    playPauseBtn.style.cssText = 'background:#333;border-radius:8px;padding:10px 20px;color:#fff;border:2px solid #666;cursor:pointer;font-size:14px;font-weight:bold;';
                                    playPauseBtn.onclick = () => {
                                        if (dp && dp.video) {
                                            dp.toggle();
                                            playPauseBtn.innerHTML = dp.video.paused ? 'â–¶ æ’­æ”¾' : 'â¸ æš‚åœ';
                                            dp.notice(dp.video.paused ? 'â¸ å·²æš‚åœ' : 'â–¶ æ’­æ”¾ä¸­');
                                        }
                                    };

                                    // æ·»åŠ è¿”å›æŒ‰é’®
                                    const backBtn = document.createElement('button');
                                    backBtn.id = 'tv-back';
                                    backBtn.setAttribute('tabindex', '99');
                                    backBtn.innerHTML = 'â† è¿”å›';
                                    backBtn.style.cssText = 'background:#666;border-radius:8px;padding:10px 20px;color:#fff;border:none;cursor:pointer;font-size:14px;font-weight:bold;';
                                    backBtn.onclick = () => {
                                        window.vueApp.closeDetail();
                                    };

                                    // æŒ‰é¡ºåºæ·»åŠ æŒ‰é’®ï¼šè¿”å›ã€æ’­æ”¾/æš‚åœã€é€‰é›†ã€åˆ‡æ¢çº¿è·¯
                                    controlBar.appendChild(backBtn);
                                    controlBar.appendChild(playPauseBtn);
                                    controlBar.appendChild(epBtn);
                                    controlBar.appendChild(switchBtn);

                                    // åˆ›å»ºåº•éƒ¨å›ºå®šæ§åˆ¶æ 
                                    let bottomBar = document.getElementById('tv-bottom-controls');
                                    if (!bottomBar) {
                                        bottomBar = document.createElement('div');
                                        bottomBar.id = 'tv-bottom-controls';
                                        bottomBar.style.cssText = 'position:fixed;bottom:80px;left:50%;transform:translateX(-50%);z-index:999999;display:flex;gap:20px;align-items:center;background:rgba(0,0,0,0.8);padding:15px 30px;border-radius:15px;';

                                        // å¿«é€€æŒ‰é’®
                                        const rewindBtn = document.createElement('button');
                                        rewindBtn.id = 'tv-rewind';
                                        rewindBtn.setAttribute('tabindex', '201');
                                        rewindBtn.innerHTML = 'âª -10s';
                                        rewindBtn.style.cssText = 'background:#444;border-radius:8px;padding:12px 20px;color:#fff;border:none;cursor:pointer;font-size:16px;';
                                        rewindBtn.onclick = () => {
                                            if (dp && dp.video) {
                                                dp.video.currentTime = Math.max(0, dp.video.currentTime - 10);
                                                dp.notice('âª å¿«é€€ 10 ç§’');
                                            }
                                        };

                                        // åº•éƒ¨æ’­æ”¾/æš‚åœæŒ‰é’®
                                        const bottomPlayBtn = document.createElement('button');
                                        bottomPlayBtn.id = 'tv-bottom-play';
                                        bottomPlayBtn.setAttribute('tabindex', '200');
                                        bottomPlayBtn.innerHTML = 'â¸';
                                        bottomPlayBtn.style.cssText = 'background:#e50914;border-radius:50%;width:60px;height:60px;color:#fff;border:none;cursor:pointer;font-size:24px;';
                                        bottomPlayBtn.onclick = () => {
                                            if (dp && dp.video) {
                                                dp.toggle();
                                                bottomPlayBtn.innerHTML = dp.video.paused ? 'â–¶' : 'â¸';
                                                playPauseBtn.innerHTML = dp.video.paused ? 'â–¶ æ’­æ”¾' : 'â¸ æš‚åœ';
                                                dp.notice(dp.video.paused ? 'â¸ å·²æš‚åœ' : 'â–¶ æ’­æ”¾ä¸­');
                                            }
                                        };

                                        // å¿«è¿›æŒ‰é’®
                                        const forwardBtn = document.createElement('button');
                                        forwardBtn.id = 'tv-forward';
                                        forwardBtn.setAttribute('tabindex', '202');
                                        forwardBtn.innerHTML = '+10s â©';
                                        forwardBtn.style.cssText = 'background:#444;border-radius:8px;padding:12px 20px;color:#fff;border:none;cursor:pointer;font-size:16px;';
                                        forwardBtn.onclick = () => {
                                            if (dp && dp.video) {
                                                dp.video.currentTime = Math.min(dp.video.duration || 0, dp.video.currentTime + 10);
                                                dp.notice('â© å¿«è¿› 10 ç§’');
                                            }
                                        };

                                        // å€é€ŸæŒ‰é’®
                                        const speeds = [0.5, 0.75, 1, 1.25, 1.5, 2];
                                        let currentSpeedIndex = 2;  // é»˜è®¤ 1x
                                        const speedBtn = document.createElement('button');
                                        speedBtn.id = 'tv-speed';
                                        speedBtn.setAttribute('tabindex', '203');
                                        speedBtn.innerHTML = '1x âš¡';
                                        speedBtn.style.cssText = 'background:#444;border-radius:8px;padding:12px 20px;color:#fff;border:none;cursor:pointer;font-size:16px;';
                                        speedBtn.onclick = () => {
                                            if (dp && dp.video) {
                                                currentSpeedIndex = (currentSpeedIndex + 1) % speeds.length;
                                                const newSpeed = speeds[currentSpeedIndex];
                                                dp.video.playbackRate = newSpeed;
                                                speedBtn.innerHTML = newSpeed + 'x âš¡';
                                                dp.notice('âš¡ å€é€Ÿ: ' + newSpeed + 'x');
                                            }
                                        };

                                        bottomBar.appendChild(rewindBtn);
                                        bottomBar.appendChild(bottomPlayBtn);
                                        bottomBar.appendChild(forwardBtn);
                                        bottomBar.appendChild(speedBtn);
                                        document.body.appendChild(bottomBar);
                                    }

                                    // æ·»åŠ è‡ªå®šä¹‰ç„¦ç‚¹å¯¼èˆªï¼šä¸‹é”®ä»é¡¶éƒ¨æŒ‰é’®è·³åˆ°æ’­æ”¾æŒ‰é’®
                                    epBtn.addEventListener('keydown', (e) => {
                                        if (e.key === 'ArrowDown') {
                                            e.preventDefault();
                                            const playBtn = document.querySelector('.dplayer-play-icon');
                                            if (playBtn) playBtn.focus();
                                        }
                                    });
                                    switchBtn.addEventListener('keydown', (e) => {
                                        if (e.key === 'ArrowDown') {
                                            e.preventDefault();
                                            const playBtn = document.querySelector('.dplayer-play-icon');
                                            if (playBtn) playBtn.focus();
                                        }
                                    });

                                    console.log('[TV æ¨¡å¼] æŒ‰é’®å·²æ·»åŠ ');
                                }

                                // 3. è®© DPlayer æ§åˆ¶æŒ‰é’®å¯è·å¾—ç„¦ç‚¹
                                document.querySelectorAll('.dplayer-icon').forEach((icon, index) => {
                                    icon.setAttribute('tabindex', String(200 + index));
                                    // æ·»åŠ è‡ªå®šä¹‰ç„¦ç‚¹å¯¼èˆªï¼šä¸Šé”®ä»æ§åˆ¶æ è·³åˆ°é¡¶éƒ¨æŒ‰é’®
                                    icon.addEventListener('keydown', (e) => {
                                        if (e.key === 'ArrowUp') {
                                            e.preventDefault();
                                            const epBtn = document.getElementById('tv-select-episode');
                                            if (epBtn) epBtn.focus();
                                        }
                                    });
                                });

                                // ç‰¹åˆ«ç¡®ä¿æ’­æ”¾æŒ‰é’®å¯è·å¾—ç„¦ç‚¹
                                const playBtn = document.querySelector('.dplayer-play-icon');
                                if (playBtn) {
                                    playBtn.setAttribute('tabindex', '200');
                                }

                                // 4. èšç„¦åˆ°æš‚åœ/æ’­æ”¾æŒ‰é’®
                                const playPauseBtn = document.getElementById('tv-play-pause');
                                if (playPauseBtn) {
                                    playPauseBtn.focus();
                                }
                            } catch (e) {
                                console.log('[TV æ¨¡å¼] è®¾ç½®å¤±è´¥:', e);
                            }
                        }, 1500);  // å»¶é•¿åˆ° 1.5 ç§’ç¡®ä¿å…¨å±å®Œæˆ
                    }
                },

                // å¤„ç†æ’­æ”¾é”™è¯¯ï¼Œè‡ªåŠ¨åˆ‡æ¢çº¿è·¯
                handlePlaybackError() {
                    this.playbackErrorCount++;

                    // é¿å…é‡å¤è§¦å‘
                    if (this.isAutoRetrying || this.playbackErrorCount > 1) return;

                    // è·å–å½“å‰çº¿è·¯ç´¢å¼•
                    const allSources = this.availableSources;
                    const currentIndex = allSources.findIndex(s => s.site_key === this.currentSource?.site_key);

                    // å¦‚æœè¿˜æœ‰ä¸‹ä¸€ä¸ªçº¿è·¯å¯ç”¨ï¼Œè‡ªåŠ¨åˆ‡æ¢
                    if (currentIndex >= 0 && currentIndex < allSources.length - 1) {
                        this.isAutoRetrying = true;
                        const nextSource = allSources[currentIndex + 1];

                        // æ˜¾ç¤ºç”¨æˆ·æç¤º
                        this.autoRetryMessage = `${this.currentSource?.site_name} æ’­æ”¾å¤±è´¥ï¼Œæ­£åœ¨å°è¯• ${nextSource.site_name}`;
                        console.log(`[Auto-Failover] ${this.autoRetryMessage}`);

                        // æ ‡è®°å½“å‰çº¿è·¯ä¸ºä¸å¯ç”¨ï¼ˆè®¾ç½®é«˜å»¶è¿Ÿï¼‰
                        if (this.currentSource) {
                            this.currentSource.latency = 9998;  // æ ‡è®°ä¸ºç”¨æˆ·ç«¯ä¸å¯ç”¨
                        }

                        // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªçº¿è·¯
                        setTimeout(() => {
                            this.autoRetryMessage = '';  // æ¸…é™¤æç¤º
                            this.isAutoRetrying = false;
                            this.switchSource(nextSource);
                        }, 1500);  // æ˜¾ç¤ºæç¤º1.5ç§’ååˆ‡æ¢
                    } else {
                        // æ²¡æœ‰æ›´å¤šå¯ç”¨çº¿è·¯
                        this.autoRetryMessage = 'æ‰€æœ‰çº¿è·¯å‡æ— æ³•æ’­æ”¾';
                        setTimeout(() => {
                            this.autoRetryMessage = '';
                        }, 3000);
                    }
                },

                // æ’­æ”¾ä¸‹ä¸€é›†
                playNextEpisode(auto = false) {
                    if (!this.episodeList || this.episodeList.length === 0) return;

                    const currentIndex = this.episodeList.findIndex(ep => ep.url === this.currentUrl);
                    if (currentIndex < 0) return;

                    if (currentIndex < this.episodeList.length - 1) {
                        const nextEp = this.episodeList[currentIndex + 1];
                        console.log('æ’­æ”¾ä¸‹ä¸€é›†:', nextEp.name);

                        if (auto) {
                            if (typeof dp !== 'undefined' && dp.notice) dp.notice(`å³å°†æ’­æ”¾ä¸‹ä¸€é›†: ${nextEp.name}`, 3000);
                        }

                        this.play(nextEp.url);

                        this.$nextTick(() => {
                            const activeBtn = document.querySelector('.episode-btn.active');
                            if (activeBtn) activeBtn.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        });
                    } else {
                        if (typeof dp !== 'undefined' && dp.notice) dp.notice('å·²ç»æ˜¯æœ€åä¸€é›†äº†');
                    }
                }
            }
        }).mount('#app');
    </script>

    <!-- Register Service Worker with Auto-Update -->
    <script data-cfasync="false">
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => {
                        // ç«‹å³æ£€æŸ¥æ›´æ–°
                        reg.update();

                        // å®šæœŸæ£€æŸ¥æ›´æ–°ï¼ˆæ¯30åˆ†é’Ÿï¼‰
                        setInterval(() => reg.update(), 30 * 60 * 1000);

                        // ç›‘å¬æ–°ç‰ˆæœ¬å®‰è£…
                        reg.addEventListener('updatefound', () => {
                            const newWorker = reg.installing;
                            newWorker.addEventListener('statechange', () => {
                                // æ–°ç‰ˆæœ¬å·²å®‰è£…ï¼Œç­‰å¾…æ¿€æ´»
                            });
                        });
                    })
                    .catch(() => { });

                // å½“æ–° SW æ¿€æ´»æ—¶è‡ªåŠ¨åˆ·æ–°é¡µé¢ï¼ˆé˜²æ­¢æ— é™å¾ªç¯ï¼‰
                let swRefreshing = false;
                navigator.serviceWorker.addEventListener('controllerchange', () => {
                    if (swRefreshing) return;
                    swRefreshing = true;
                    window.location.reload();
                });
            });
        }
    </script>
</body>

</html>